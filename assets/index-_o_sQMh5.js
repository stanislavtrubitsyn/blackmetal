var yg=Object.defineProperty;var ku=c=>{throw TypeError(c)};var Ag=(c,e,t)=>e in c?yg(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var O=(c,e,t)=>Ag(c,typeof e!="symbol"?e+"":e,t),_c=(c,e,t)=>e.has(c)||ku("Cannot "+t);var a=(c,e,t)=>(_c(c,e,"read from private field"),t?t.call(c):e.get(c)),b=(c,e,t)=>e.has(c)?ku("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(c):e.set(c,t),m=(c,e,t,s)=>(_c(c,e,"write to private field"),s?s.call(c,t):e.set(c,t),t),y=(c,e,t)=>(_c(c,e,"access private method"),t);var he=(c,e,t,s)=>({set _(i){m(c,e,i,t)},get _(){return a(c,e,s)}});import{l as wg,n as Eg,r as Oi,m as Sg,ae as xg,j as ft,s as Ii,f as Tg,h as Si,i as Cg,y as Pc,D as Po,A as Rg,z as Ig,af as gu,ac as mu,c as vu,T as Sh,I as gh,B as Mc,v as _u}from"./index-FpWVLKsz.js";import{S as Pg}from"./Send-B6MK8YkJ.js";import{C as Mg}from"./Container-6o2cwXdf.js";function Lg(c){return wg("MuiLinearProgress",c)}Eg("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","bar1","bar2","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const Wc=4,Xc=mu`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`,Og=typeof Xc!="string"?gu`
        animation: ${Xc} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
      `:null,Yc=mu`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`,Dg=typeof Yc!="string"?gu`
        animation: ${Yc} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
      `:null,Kc=mu`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`,Ng=typeof Kc!="string"?gu`
        animation: ${Kc} 3s infinite linear;
      `:null,Fg=c=>{const{classes:e,variant:t,color:s}=c,i={root:["root",`color${Si(s)}`,t],dashed:["dashed",`dashedColor${Si(s)}`],bar1:["bar","bar1",`barColor${Si(s)}`,(t==="indeterminate"||t==="query")&&"bar1Indeterminate",t==="determinate"&&"bar1Determinate",t==="buffer"&&"bar1Buffer"],bar2:["bar","bar2",t!=="buffer"&&`barColor${Si(s)}`,t==="buffer"&&`color${Si(s)}`,(t==="indeterminate"||t==="query")&&"bar2Indeterminate",t==="buffer"&&"bar2Buffer"]};return Cg(i,Lg,e)},bu=(c,e)=>c.vars?c.vars.palette.LinearProgress[`${e}Bg`]:c.palette.mode==="light"?Rg(c.palette[e].main,.62):Ig(c.palette[e].main,.5),kg=Ii("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(c,e)=>{const{ownerState:t}=c;return[e.root,e[`color${Si(t.color)}`],e[t.variant]]}})(Pc(({theme:c})=>({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},variants:[...Object.entries(c.palette).filter(Po()).map(([e])=>({props:{color:e},style:{backgroundColor:bu(c,e)}})),{props:({ownerState:e})=>e.color==="inherit"&&e.variant!=="buffer",style:{"&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}}},{props:{variant:"buffer"},style:{backgroundColor:"transparent"}},{props:{variant:"query"},style:{transform:"rotate(180deg)"}}]}))),_g=Ii("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(c,e)=>{const{ownerState:t}=c;return[e.dashed,e[`dashedColor${Si(t.color)}`]]}})(Pc(({theme:c})=>({position:"absolute",marginTop:0,height:"100%",width:"100%",backgroundSize:"10px 10px",backgroundPosition:"0 -23px",variants:[{props:{color:"inherit"},style:{opacity:.3,backgroundImage:"radial-gradient(currentColor 0%, currentColor 16%, transparent 42%)"}},...Object.entries(c.palette).filter(Po()).map(([e])=>{const t=bu(c,e);return{props:{color:e},style:{backgroundImage:`radial-gradient(${t} 0%, ${t} 16%, transparent 42%)`}}})]})),Ng||{animation:`${Kc} 3s infinite linear`}),Bg=Ii("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(c,e)=>{const{ownerState:t}=c;return[e.bar,e.bar1,e[`barColor${Si(t.color)}`],(t.variant==="indeterminate"||t.variant==="query")&&e.bar1Indeterminate,t.variant==="determinate"&&e.bar1Determinate,t.variant==="buffer"&&e.bar1Buffer]}})(Pc(({theme:c})=>({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",variants:[{props:{color:"inherit"},style:{backgroundColor:"currentColor"}},...Object.entries(c.palette).filter(Po()).map(([e])=>({props:{color:e},style:{backgroundColor:(c.vars||c).palette[e].main}})),{props:{variant:"determinate"},style:{transition:`transform .${Wc}s linear`}},{props:{variant:"buffer"},style:{zIndex:1,transition:`transform .${Wc}s linear`}},{props:({ownerState:e})=>e.variant==="indeterminate"||e.variant==="query",style:{width:"auto"}},{props:({ownerState:e})=>e.variant==="indeterminate"||e.variant==="query",style:Og||{animation:`${Xc} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite`}}]}))),Hg=Ii("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(c,e)=>{const{ownerState:t}=c;return[e.bar,e.bar2,e[`barColor${Si(t.color)}`],(t.variant==="indeterminate"||t.variant==="query")&&e.bar2Indeterminate,t.variant==="buffer"&&e.bar2Buffer]}})(Pc(({theme:c})=>({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",variants:[...Object.entries(c.palette).filter(Po()).map(([e])=>({props:{color:e},style:{"--LinearProgressBar2-barColor":(c.vars||c).palette[e].main}})),{props:({ownerState:e})=>e.variant!=="buffer"&&e.color!=="inherit",style:{backgroundColor:"var(--LinearProgressBar2-barColor, currentColor)"}},{props:({ownerState:e})=>e.variant!=="buffer"&&e.color==="inherit",style:{backgroundColor:"currentColor"}},{props:{color:"inherit"},style:{opacity:.3}},...Object.entries(c.palette).filter(Po()).map(([e])=>({props:{color:e,variant:"buffer"},style:{backgroundColor:bu(c,e),transition:`transform .${Wc}s linear`}})),{props:({ownerState:e})=>e.variant==="indeterminate"||e.variant==="query",style:{width:"auto"}},{props:({ownerState:e})=>e.variant==="indeterminate"||e.variant==="query",style:Dg||{animation:`${Yc} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite`}}]}))),$g=Oi.forwardRef(function(e,t){const s=Sg({props:e,name:"MuiLinearProgress"}),{className:i,color:n="primary",value:r,valueBuffer:o,variant:l="indeterminate",...h}=s,d={...s,color:n,variant:l},u=Fg(d),f=xg(),p={},v={bar1:{},bar2:{}};if((l==="determinate"||l==="buffer")&&r!==void 0){p["aria-valuenow"]=Math.round(r),p["aria-valuemin"]=0,p["aria-valuemax"]=100;let g=r-100;f&&(g=-g),v.bar1.transform=`translateX(${g}%)`}if(l==="buffer"&&o!==void 0){let g=(o||0)-100;f&&(g=-g),v.bar2.transform=`translateX(${g}%)`}return ft.jsxs(kg,{className:Tg(u.root,i),ownerState:d,role:"progressbar",...p,ref:t,...h,children:[l==="buffer"?ft.jsx(_g,{className:u.dashed,ownerState:d}):null,ft.jsx(Bg,{className:u.bar1,ownerState:d,style:v.bar1}),l==="determinate"?null:ft.jsx(Hg,{className:u.bar2,ownerState:d,style:v.bar2})]})}),jg=vu(ft.jsx("path",{d:"M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z"}),"ArrowBackIosNew"),Ug=vu(ft.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos"),zg=vu(ft.jsx("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen");var Gg={34:(c,e,t)=>{var s=t(4901);c.exports=function(i){return typeof i=="object"?i!==null:s(i)}},81:(c,e,t)=>{var s=t(9565),i=t(9306),n=t(8551),r=t(6823),o=t(851),l=TypeError;c.exports=function(h,d){var u=arguments.length<2?o(h):d;if(i(u))return n(s(u,h));throw new l(r(h)+" is not iterable")}},283:(c,e,t)=>{var s=t(9504),i=t(9039),n=t(4901),r=t(9297),o=t(3724),l=t(350).CONFIGURABLE,h=t(3706),d=t(1181),u=d.enforce,f=d.get,p=String,v=Object.defineProperty,g=s("".slice),A=s("".replace),w=s([].join),S=o&&!i(function(){return v(function(){},"length",{value:8}).length!==8}),E=String(String).split("String"),T=c.exports=function(x,C,R){g(p(C),0,7)==="Symbol("&&(C="["+A(p(C),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),R&&R.getter&&(C="get "+C),R&&R.setter&&(C="set "+C),(!r(x,"name")||l&&x.name!==C)&&(o?v(x,"name",{value:C,configurable:!0}):x.name=C),S&&R&&r(R,"arity")&&x.length!==R.arity&&v(x,"length",{value:R.arity});try{R&&r(R,"constructor")&&R.constructor?o&&v(x,"prototype",{writable:!1}):x.prototype&&(x.prototype=void 0)}catch{}var I=u(x);return r(I,"source")||(I.source=w(E,typeof C=="string"?C:"")),x};Function.prototype.toString=T(function(){return n(this)&&f(this).source||h(this)},"toString")},350:(c,e,t)=>{var s=t(3724),i=t(9297),n=Function.prototype,r=s&&Object.getOwnPropertyDescriptor,o=i(n,"name"),l=o&&(function(){}).name==="something",h=o&&(!s||s&&r(n,"name").configurable);c.exports={EXISTS:o,PROPER:l,CONFIGURABLE:h}},397:(c,e,t)=>{var s=t(7751);c.exports=s("document","documentElement")},421:c=>{c.exports={}},507:(c,e,t)=>{var s=t(9565);c.exports=function(i,n,r){for(var o=r?i:i.iterator,l=i.next,h,d;!(h=s(l,o)).done;)if(d=n(h.value),d!==void 0)return d}},531:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(9306),r=t(8551),o=t(1767),l=t(8646),h=t(9462),d=t(9539),u=t(6395),f=t(4549),p=!u&&f("flatMap",TypeError),v=h(function(){for(var g=this.iterator,A=this.mapper,w,S;;){if(S=this.inner)try{if(w=r(i(S.next,S.iterator)),!w.done)return w.value;this.inner=null}catch(E){d(g,"throw",E)}if(w=r(i(this.next,g)),this.done=!!w.done)return;try{this.inner=l(A(w.value,this.counter++),!1)}catch(E){d(g,"throw",E)}}});s({target:"Iterator",proto:!0,real:!0,forced:u||p},{flatMap:function(A){r(this);try{n(A)}catch(w){d(this,"throw",w)}return p?i(p,this,A):new v(o(this),{mapper:A,inner:null})}})},616:(c,e,t)=>{var s=t(9039);c.exports=!s(function(){var i=(function(){}).bind();return typeof i!="function"||i.hasOwnProperty("prototype")})},655:(c,e,t)=>{var s=t(6955),i=String;c.exports=function(n){if(s(n)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return i(n)}},679:(c,e,t)=>{var s=t(1625),i=TypeError;c.exports=function(n,r){if(s(r,n))return n;throw new i("Incorrect invocation")}},741:c=>{var e=Math.ceil,t=Math.floor;c.exports=Math.trunc||function(i){var n=+i;return(n>0?t:e)(n)}},757:(c,e,t)=>{var s=t(7751),i=t(4901),n=t(1625),r=t(7040),o=Object;c.exports=r?function(l){return typeof l=="symbol"}:function(l){var h=s("Symbol");return i(h)&&n(h.prototype,o(l))}},851:(c,e,t)=>{var s=t(6955),i=t(5966),n=t(4117),r=t(6269),o=t(8227),l=o("iterator");c.exports=function(h){if(!n(h))return i(h,l)||i(h,"@@iterator")||r[s(h)]}},944:c=>{var e=TypeError;c.exports=function(t){var s=t&&t.alphabet;if(s===void 0||s==="base64"||s==="base64url")return s||"base64";throw new e("Incorrect `alphabet` option")}},1072:(c,e,t)=>{var s=t(1828),i=t(8727);c.exports=Object.keys||function(r){return s(r,i)}},1103:c=>{c.exports=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}}},1148:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(2652),r=t(9306),o=t(8551),l=t(1767),h=t(9539),d=t(4549),u=d("every",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:u},{every:function(p){o(this);try{r(p)}catch(A){h(this,"throw",A)}if(u)return i(u,this,p);var v=l(this),g=0;return!n(v,function(A,w){if(!p(A,g++))return w()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},1181:(c,e,t)=>{var s=t(8622),i=t(4576),n=t(34),r=t(6699),o=t(9297),l=t(7629),h=t(6119),d=t(421),u="Object already initialized",f=i.TypeError,p=i.WeakMap,v,g,A,w=function(x){return A(x)?g(x):v(x,{})},S=function(x){return function(C){var R;if(!n(C)||(R=g(C)).type!==x)throw new f("Incompatible receiver, "+x+" required");return R}};if(s||l.state){var E=l.state||(l.state=new p);E.get=E.get,E.has=E.has,E.set=E.set,v=function(x,C){if(E.has(x))throw new f(u);return C.facade=x,E.set(x,C),C},g=function(x){return E.get(x)||{}},A=function(x){return E.has(x)}}else{var T=h("state");d[T]=!0,v=function(x,C){if(o(x,T))throw new f(u);return C.facade=x,r(x,T,C),C},g=function(x){return o(x,T)?x[T]:{}},A=function(x){return o(x,T)}}c.exports={set:v,get:g,has:A,enforce:w,getterFor:S}},1291:(c,e,t)=>{var s=t(741);c.exports=function(i){var n=+i;return n!==n||n===0?0:s(n)}},1548:(c,e,t)=>{var s=t(4576),i=t(9039),n=t(9519),r=t(4215),o=s.structuredClone;c.exports=!!o&&!i(function(){if(r==="DENO"&&n>92||r==="NODE"&&n>94||r==="BROWSER"&&n>97)return!1;var l=new ArrayBuffer(8),h=o(l,{transfer:[l]});return l.byteLength!==0||h.byteLength!==8})},1549:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(9143),r=t(4154),o=i.Uint8Array,l=!o||!o.prototype.setFromBase64||!function(){var h=new o([255,255,255,255,255]);try{h.setFromBase64("MjYyZg===")}catch{return h[0]===50&&h[1]===54&&h[2]===50&&h[3]===255&&h[4]===255}}();o&&s({target:"Uint8Array",proto:!0,forced:l},{setFromBase64:function(d){r(this);var u=n(d,arguments.length>1?arguments[1]:void 0,this,this.length);return{read:u.read,written:u.written}}})},1625:(c,e,t)=>{var s=t(9504);c.exports=s({}.isPrototypeOf)},1689:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(8745),r=t(7680),o=t(6043),l=t(9306),h=t(1103),d=i.Promise,u=!1,f=!d||!d.try||h(function(){d.try(function(p){u=p===8},8)}).error||!u;s({target:"Promise",stat:!0,forced:f},{try:function(p){var v=arguments.length>1?r(arguments,1):[],g=o.f(this),A=h(function(){return n(l(p),void 0,v)});return(A.error?g.reject:g.resolve)(A.value),g.promise}})},1698:(c,e,t)=>{var s=t(6518),i=t(4204),n=t(4916);s({target:"Set",proto:!0,real:!0,forced:!n("union")},{union:i})},1701:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(9306),r=t(8551),o=t(1767),l=t(9462),h=t(6319),d=t(9539),u=t(4549),f=t(6395),p=!f&&u("map",TypeError),v=l(function(){var g=this.iterator,A=r(i(this.next,g)),w=this.done=!!A.done;if(!w)return h(g,this.mapper,[A.value,this.counter++],!0)});s({target:"Iterator",proto:!0,real:!0,forced:f||p},{map:function(A){r(this);try{n(A)}catch(w){d(this,"throw",w)}return p?i(p,this,A):new v(o(this),{mapper:A})}})},1767:c=>{c.exports=function(e){return{iterator:e,next:e.next,done:!1}}},1828:(c,e,t)=>{var s=t(9504),i=t(9297),n=t(5397),r=t(9617).indexOf,o=t(421),l=s([].push);c.exports=function(h,d){var u=n(h),f=0,p=[],v;for(v in u)!i(o,v)&&i(u,v)&&l(p,v);for(;d.length>f;)i(u,v=d[f++])&&(~r(p,v)||l(p,v));return p}},2106:(c,e,t)=>{var s=t(283),i=t(4913);c.exports=function(n,r,o){return o.get&&s(o.get,r,{getter:!0}),o.set&&s(o.set,r,{setter:!0}),i.f(n,r,o)}},2140:(c,e,t)=>{var s=t(8227),i=s("toStringTag"),n={};n[i]="z",c.exports=String(n)==="[object z]"},2195:(c,e,t)=>{var s=t(9504),i=s({}.toString),n=s("".slice);c.exports=function(r){return n(i(r),8,-1)}},2211:(c,e,t)=>{var s=t(9039);c.exports=!s(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype})},2303:(c,e,t)=>{var s=t(4576),i=t(9504),n=s.Uint8Array,r=s.SyntaxError,o=s.parseInt,l=Math.min,h=/[^\da-f]/i,d=i(h.exec),u=i("".slice);c.exports=function(f,p){var v=f.length;if(v%2!==0)throw new r("String should be an even number of characters");for(var g=p?l(p.length,v/2):v/2,A=p||new n(g),w=0,S=0;S<g;){var E=u(f,w,w+=2);if(d(h,E))throw new r("String should only contain hex characters");A[S++]=o(E,16)}return{bytes:A,read:w}}},2360:(c,e,t)=>{var s=t(8551),i=t(6801),n=t(8727),r=t(421),o=t(397),l=t(4055),h=t(6119),d=">",u="<",f="prototype",p="script",v=h("IE_PROTO"),g=function(){},A=function(x){return u+p+d+x+u+"/"+p+d},w=function(x){x.write(A("")),x.close();var C=x.parentWindow.Object;return x=null,C},S=function(){var x=l("iframe"),C="java"+p+":",R;return x.style.display="none",o.appendChild(x),x.src=String(C),R=x.contentWindow.document,R.open(),R.write(A("document.F=Object")),R.close(),R.F},E,T=function(){try{E=new ActiveXObject("htmlfile")}catch{}T=typeof document<"u"?document.domain&&E?w(E):S():w(E);for(var x=n.length;x--;)delete T[f][n[x]];return T()};r[v]=!0,c.exports=Object.create||function(C,R){var I;return C!==null?(g[f]=s(C),I=new g,g[f]=null,I[v]=C):I=T(),R===void 0?I:i.f(I,R)}},2475:(c,e,t)=>{var s=t(6518),i=t(8527),n=t(4916),r=!n("isSupersetOf",function(o){return!o});s({target:"Set",proto:!0,real:!0,forced:r},{isSupersetOf:i})},2489:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(9306),r=t(8551),o=t(1767),l=t(9462),h=t(6319),d=t(6395),u=t(9539),f=t(4549),p=!d&&f("filter",TypeError),v=l(function(){for(var g=this.iterator,A=this.predicate,w=this.next,S,E,T;;){if(S=r(i(w,g)),E=this.done=!!S.done,E)return;if(T=S.value,h(g,A,[T,this.counter++],!0))return T}});s({target:"Iterator",proto:!0,real:!0,forced:d||p},{filter:function(A){r(this);try{n(A)}catch(w){u(this,"throw",w)}return p?i(p,this,A):new v(o(this),{predicate:A})}})},2529:c=>{c.exports=function(e,t){return{value:e,done:t}}},2603:(c,e,t)=>{var s=t(655);c.exports=function(i,n){return i===void 0?arguments.length<2?"":n:s(i)}},2652:(c,e,t)=>{var s=t(6080),i=t(9565),n=t(8551),r=t(6823),o=t(4209),l=t(6198),h=t(1625),d=t(81),u=t(851),f=t(9539),p=TypeError,v=function(A,w){this.stopped=A,this.result=w},g=v.prototype;c.exports=function(A,w,S){var E=S&&S.that,T=!!(S&&S.AS_ENTRIES),x=!!(S&&S.IS_RECORD),C=!!(S&&S.IS_ITERATOR),R=!!(S&&S.INTERRUPTED),I=s(w,E),P,M,D,G,U,W,pt,F=function(at){return P&&f(P,"normal",at),new v(!0,at)},k=function(at){return T?(n(at),R?I(at[0],at[1],F):I(at[0],at[1])):R?I(at,F):I(at)};if(x)P=A.iterator;else if(C)P=A;else{if(M=u(A),!M)throw new p(r(A)+" is not iterable");if(o(M)){for(D=0,G=l(A);G>D;D++)if(U=k(A[D]),U&&h(g,U))return U;return new v(!1)}P=d(A,M)}for(W=x?A.next:P.next;!(pt=i(W,P)).done;){try{U=k(pt.value)}catch(at){f(P,"throw",at)}if(typeof U=="object"&&U&&h(g,U))return U}return new v(!1)}},2777:(c,e,t)=>{var s=t(9565),i=t(34),n=t(757),r=t(5966),o=t(4270),l=t(8227),h=TypeError,d=l("toPrimitive");c.exports=function(u,f){if(!i(u)||n(u))return u;var p=r(u,d),v;if(p){if(f===void 0&&(f="default"),v=s(p,u,f),!i(v)||n(v))return v;throw new h("Can't convert object to primitive value")}return f===void 0&&(f="number"),o(u,f)}},2787:(c,e,t)=>{var s=t(9297),i=t(4901),n=t(8981),r=t(6119),o=t(2211),l=r("IE_PROTO"),h=Object,d=h.prototype;c.exports=o?h.getPrototypeOf:function(u){var f=n(u);if(s(f,l))return f[l];var p=f.constructor;return i(p)&&f instanceof p?p.prototype:f instanceof h?d:null}},2796:(c,e,t)=>{var s=t(9039),i=t(4901),n=/#|\.prototype\./,r=function(u,f){var p=l[o(u)];return p===d?!0:p===h?!1:i(f)?s(f):!!f},o=r.normalize=function(u){return String(u).replace(n,".").toLowerCase()},l=r.data={},h=r.NATIVE="N",d=r.POLYFILL="P";c.exports=r},2804:c=>{var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=e+"+/",s=e+"-_",i=function(n){for(var r={},o=0;o<64;o++)r[n.charAt(o)]=o;return r};c.exports={i2c:t,c2i:i(t),i2cUrl:s,c2iUrl:i(s)}},2812:c=>{var e=TypeError;c.exports=function(t,s){if(t<s)throw new e("Not enough arguments");return t}},2839:(c,e,t)=>{var s=t(4576),i=s.navigator,n=i&&i.userAgent;c.exports=n?String(n):""},2967:(c,e,t)=>{var s=t(6706),i=t(34),n=t(7750),r=t(3506);c.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var o=!1,l={},h;try{h=s(Object.prototype,"__proto__","set"),h(l,[]),o=l instanceof Array}catch{}return function(u,f){return n(u),r(f),i(u)&&(o?h(u,f):u.__proto__=f),u}}():void 0)},3167:(c,e,t)=>{var s=t(4901),i=t(34),n=t(2967);c.exports=function(r,o,l){var h,d;return n&&s(h=o.constructor)&&h!==l&&i(d=h.prototype)&&d!==l.prototype&&n(r,d),r}},3238:(c,e,t)=>{var s=t(4576),i=t(7811),n=t(7394),r=s.DataView;c.exports=function(o){if(!i||n(o)!==0)return!1;try{return new r(o),!1}catch{return!0}}},3392:(c,e,t)=>{var s=t(9504),i=0,n=Math.random(),r=s(1 .toString);c.exports=function(o){return"Symbol("+(o===void 0?"":o)+")_"+r(++i+n,36)}},3440:(c,e,t)=>{var s=t(7080),i=t(4402),n=t(9286),r=t(5170),o=t(3789),l=t(8469),h=t(507),d=i.has,u=i.remove;c.exports=function(p){var v=s(this),g=o(p),A=n(v);return r(v)<=g.size?l(v,function(w){g.includes(w)&&u(A,w)}):h(g.getIterator(),function(w){d(v,w)&&u(A,w)}),A}},3463:c=>{var e=TypeError;c.exports=function(t){if(typeof t=="string")return t;throw new e("Argument is not a string")}},3506:(c,e,t)=>{var s=t(3925),i=String,n=TypeError;c.exports=function(r){if(s(r))return r;throw new n("Can't set "+i(r)+" as a prototype")}},3579:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(2652),r=t(9306),o=t(8551),l=t(1767),h=t(9539),d=t(4549),u=d("some",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:u},{some:function(p){o(this);try{r(p)}catch(A){h(this,"throw",A)}if(u)return i(u,this,p);var v=l(this),g=0;return n(v,function(A,w){if(p(A,g++))return w()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},3650:(c,e,t)=>{var s=t(7080),i=t(4402),n=t(9286),r=t(3789),o=t(507),l=i.add,h=i.has,d=i.remove;c.exports=function(f){var p=s(this),v=r(f).getIterator(),g=n(p);return o(v,function(A){h(p,A)?d(g,A):l(g,A)}),g}},3706:(c,e,t)=>{var s=t(9504),i=t(4901),n=t(7629),r=s(Function.toString);i(n.inspectSource)||(n.inspectSource=function(o){return r(o)}),c.exports=n.inspectSource},3717:(c,e)=>{e.f=Object.getOwnPropertySymbols},3724:(c,e,t)=>{var s=t(9039);c.exports=!s(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})},3789:(c,e,t)=>{var s=t(9306),i=t(8551),n=t(9565),r=t(1291),o=t(1767),l="Invalid size",h=RangeError,d=TypeError,u=Math.max,f=function(p,v){this.set=p,this.size=u(v,0),this.has=s(p.has),this.keys=s(p.keys)};f.prototype={getIterator:function(){return o(i(n(this.keys,this.set)))},includes:function(p){return n(this.has,this.set,p)}},c.exports=function(p){i(p);var v=+p.size;if(v!==v)throw new d(l);var g=r(v);if(g<0)throw new h(l);return new f(p,g)}},3838:(c,e,t)=>{var s=t(7080),i=t(5170),n=t(8469),r=t(3789);c.exports=function(l){var h=s(this),d=r(l);return i(h)>d.size?!1:n(h,function(u){if(!d.includes(u))return!1},!0)!==!1}},3853:(c,e,t)=>{var s=t(6518),i=t(4449),n=t(4916),r=!n("isDisjointFrom",function(o){return!o});s({target:"Set",proto:!0,real:!0,forced:r},{isDisjointFrom:i})},3925:(c,e,t)=>{var s=t(34);c.exports=function(i){return s(i)||i===null}},3972:(c,e,t)=>{var s=t(34),i=String,n=TypeError;c.exports=function(r){if(r===void 0||s(r))return r;throw new n(i(r)+" is not an object or undefined")}},4055:(c,e,t)=>{var s=t(4576),i=t(34),n=s.document,r=i(n)&&i(n.createElement);c.exports=function(o){return r?n.createElement(o):{}}},4114:(c,e,t)=>{var s=t(6518),i=t(8981),n=t(6198),r=t(4527),o=t(6837),l=t(9039),h=l(function(){return[].push.call({length:4294967296},1)!==4294967297}),d=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(f){return f instanceof TypeError}},u=h||!d();s({target:"Array",proto:!0,arity:1,forced:u},{push:function(p){var v=i(this),g=n(v),A=arguments.length;o(g+A);for(var w=0;w<A;w++)v[g]=arguments[w],g++;return r(v,g),g}})},4117:c=>{c.exports=function(e){return e==null}},4149:c=>{var e=RangeError;c.exports=function(t){if(t===t)return t;throw new e("NaN is not allowed")}},4154:(c,e,t)=>{var s=t(6955),i=TypeError;c.exports=function(n){if(s(n)==="Uint8Array")return n;throw new i("Argument is not an Uint8Array")}},4204:(c,e,t)=>{var s=t(7080),i=t(4402).add,n=t(9286),r=t(3789),o=t(507);c.exports=function(h){var d=s(this),u=r(h).getIterator(),f=n(d);return o(u,function(p){i(f,p)}),f}},4209:(c,e,t)=>{var s=t(8227),i=t(6269),n=s("iterator"),r=Array.prototype;c.exports=function(o){return o!==void 0&&(i.Array===o||r[n]===o)}},4215:(c,e,t)=>{var s=t(4576),i=t(2839),n=t(2195),r=function(o){return i.slice(0,o.length)===o};c.exports=function(){return r("Bun/")?"BUN":r("Cloudflare-Workers")?"CLOUDFLARE":r("Deno/")?"DENO":r("Node.js/")?"NODE":s.Bun&&typeof Bun.version=="string"?"BUN":s.Deno&&typeof Deno.version=="object"?"DENO":n(s.process)==="process"?"NODE":s.window&&s.document?"BROWSER":"REST"}()},4270:(c,e,t)=>{var s=t(9565),i=t(4901),n=t(34),r=TypeError;c.exports=function(o,l){var h,d;if(l==="string"&&i(h=o.toString)&&!n(d=s(h,o))||i(h=o.valueOf)&&!n(d=s(h,o))||l!=="string"&&i(h=o.toString)&&!n(d=s(h,o)))return d;throw new r("Can't convert object to primitive value")}},4376:(c,e,t)=>{var s=t(2195);c.exports=Array.isArray||function(n){return s(n)==="Array"}},4402:(c,e,t)=>{var s=t(9504),i=Set.prototype;c.exports={Set,add:s(i.add),has:s(i.has),remove:s(i.delete),proto:i}},4449:(c,e,t)=>{var s=t(7080),i=t(4402).has,n=t(5170),r=t(3789),o=t(8469),l=t(507),h=t(9539);c.exports=function(u){var f=s(this),p=r(u);if(n(f)<=p.size)return o(f,function(g){if(p.includes(g))return!1},!0)!==!1;var v=p.getIterator();return l(v,function(g){if(i(f,g))return h(v,"normal",!1)})!==!1}},4483:(c,e,t)=>{var s=t(4576),i=t(9429),n=t(1548),r=s.structuredClone,o=s.ArrayBuffer,l=s.MessageChannel,h=!1,d,u,f,p;if(n)h=function(v){r(v,{transfer:[v]})};else if(o)try{l||(d=i("worker_threads"),d&&(l=d.MessageChannel)),l&&(u=new l,f=new o(2),p=function(v){u.port1.postMessage(null,[v])},f.byteLength===2&&(p(f),f.byteLength===0&&(h=p)))}catch{}c.exports=h},4495:(c,e,t)=>{var s=t(9519),i=t(9039),n=t(4576),r=n.String;c.exports=!!Object.getOwnPropertySymbols&&!i(function(){var o=Symbol("symbol detection");return!r(o)||!(Object(o)instanceof Symbol)||!Symbol.sham&&s&&s<41})},4527:(c,e,t)=>{var s=t(3724),i=t(4376),n=TypeError,r=Object.getOwnPropertyDescriptor,o=s&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(l){return l instanceof TypeError}}();c.exports=o?function(l,h){if(i(l)&&!r(l,"length").writable)throw new n("Cannot set read only .length");return l.length=h}:function(l,h){return l.length=h}},4549:(c,e,t)=>{var s=t(4576);c.exports=function(i,n){var r=s.Iterator,o=r&&r.prototype,l=o&&o[i],h=!1;if(l)try{l.call({next:function(){return{done:!0}},return:function(){h=!0}},-1)}catch(d){d instanceof n||(h=!1)}if(!h)return l}},4576:function(c){var e=function(t){return t&&t.Math===Math&&t};c.exports=e(typeof globalThis=="object"&&globalThis)||e(typeof window=="object"&&window)||e(typeof self=="object"&&self)||e(typeof global=="object"&&global)||e(typeof this=="object"&&this)||function(){return this}()||Function("return this")()},4603:(c,e,t)=>{var s=t(6840),i=t(9504),n=t(655),r=t(2812),o=URLSearchParams,l=o.prototype,h=i(l.append),d=i(l.delete),u=i(l.forEach),f=i([].push),p=new o("a=1&a=2&b=3");p.delete("a",1),p.delete("b",void 0),p+""!="a=2"&&s(l,"delete",function(v){var g=arguments.length,A=g<2?void 0:arguments[1];if(g&&A===void 0)return d(this,v);var w=[];u(this,function(P,M){f(w,{key:M,value:P})}),r(g,1);for(var S=n(v),E=n(A),T=0,x=0,C=!1,R=w.length,I;T<R;)I=w[T++],C||I.key===S?(C=!0,d(this,I.key)):x++;for(;x<R;)I=w[x++],I.key===S&&I.value===E||h(this,I.key,I.value)},{enumerable:!0,unsafe:!0})},4628:(c,e,t)=>{var s=t(6518),i=t(6043);s({target:"Promise",stat:!0},{withResolvers:function(){var r=i.f(this);return{promise:r.promise,resolve:r.resolve,reject:r.reject}}})},4659:(c,e,t)=>{var s=t(3724),i=t(4913),n=t(6980);c.exports=function(r,o,l){s?i.f(r,o,n(0,l)):r[o]=l}},4901:c=>{var e=typeof document=="object"&&document.all;c.exports=typeof e>"u"&&e!==void 0?function(t){return typeof t=="function"||t===e}:function(t){return typeof t=="function"}},4913:(c,e,t)=>{var s=t(3724),i=t(5917),n=t(8686),r=t(8551),o=t(6969),l=TypeError,h=Object.defineProperty,d=Object.getOwnPropertyDescriptor,u="enumerable",f="configurable",p="writable";e.f=s?n?function(g,A,w){if(r(g),A=o(A),r(w),typeof g=="function"&&A==="prototype"&&"value"in w&&p in w&&!w[p]){var S=d(g,A);S&&S[p]&&(g[A]=w.value,w={configurable:f in w?w[f]:S[f],enumerable:u in w?w[u]:S[u],writable:!1})}return h(g,A,w)}:h:function(g,A,w){if(r(g),A=o(A),r(w),i)try{return h(g,A,w)}catch{}if("get"in w||"set"in w)throw new l("Accessors not supported");return"value"in w&&(g[A]=w.value),g}},4916:(c,e,t)=>{var s=t(7751),i=function(r){return{size:r,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},n=function(r){return{size:r,has:function(){return!0},keys:function(){throw new Error("e")}}};c.exports=function(r,o){var l=s("Set");try{new l()[r](i(0));try{return new l()[r](i(-1)),!1}catch{if(!o)return!0;try{return new l()[r](n(-1/0)),!1}catch{var h=new l;return h.add(1),h.add(2),o(h[r](n(1/0)))}}}catch{return!1}}},4979:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(7751),r=t(6980),o=t(4913).f,l=t(9297),h=t(679),d=t(3167),u=t(2603),f=t(5002),p=t(8574),v=t(3724),g=t(6395),A="DOMException",w=n("Error"),S=n(A),E=function(){h(this,T);var F=arguments.length,k=u(F<1?void 0:arguments[0]),at=u(F<2?void 0:arguments[1],"Error"),le=new S(k,at),ye=new w(k);return ye.name=A,o(le,"stack",r(1,p(ye.stack,1))),d(le,this,E),le},T=E.prototype=S.prototype,x="stack"in new w(A),C="stack"in new S(1,2),R=S&&v&&Object.getOwnPropertyDescriptor(i,A),I=!!R&&!(R.writable&&R.configurable),P=x&&!I&&!C;s({global:!0,constructor:!0,forced:g||P},{DOMException:P?E:S});var M=n(A),D=M.prototype;if(D.constructor!==M){g||o(D,"constructor",r(1,M));for(var G in f)if(l(f,G)){var U=f[G],W=U.s;l(M,W)||o(M,W,r(6,U.c))}}},5002:c=>{c.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5024:(c,e,t)=>{var s=t(6518),i=t(3650),n=t(4916);s({target:"Set",proto:!0,real:!0,forced:!n("symmetricDifference")},{symmetricDifference:i})},5031:(c,e,t)=>{var s=t(7751),i=t(9504),n=t(8480),r=t(3717),o=t(8551),l=i([].concat);c.exports=s("Reflect","ownKeys")||function(d){var u=n.f(o(d)),f=r.f;return f?l(u,f(d)):u}},5169:(c,e,t)=>{var s=t(3238),i=TypeError;c.exports=function(n){if(s(n))throw new i("ArrayBuffer is detached");return n}},5170:(c,e,t)=>{var s=t(6706),i=t(4402);c.exports=s(i.proto,"size","get")||function(n){return n.size}},5370:(c,e,t)=>{var s=t(6198);c.exports=function(i,n,r){for(var o=0,l=arguments.length>2?r:s(n),h=new i(l);l>o;)h[o]=n[o++];return h}},5397:(c,e,t)=>{var s=t(7055),i=t(7750);c.exports=function(n){return s(i(n))}},5610:(c,e,t)=>{var s=t(1291),i=Math.max,n=Math.min;c.exports=function(r,o){var l=s(r);return l<0?i(l+o,0):n(l,o)}},5623:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(9504),r=t(4154),o=t(5169),l=n(1 .toString);i.Uint8Array&&s({target:"Uint8Array",proto:!0},{toHex:function(){r(this),o(this.buffer);for(var d="",u=0,f=this.length;u<f;u++){var p=l(this[u],16);d+=p.length===1?"0"+p:p}return d}})},5636:(c,e,t)=>{var s=t(4576),i=t(9504),n=t(6706),r=t(7696),o=t(5169),l=t(7394),h=t(4483),d=t(1548),u=s.structuredClone,f=s.ArrayBuffer,p=s.DataView,v=Math.min,g=f.prototype,A=p.prototype,w=i(g.slice),S=n(g,"resizable","get"),E=n(g,"maxByteLength","get"),T=i(A.getInt8),x=i(A.setInt8);c.exports=(d||h)&&function(C,R,I){var P=l(C),M=R===void 0?P:r(R),D=!S||!S(C),G;if(o(C),d&&(C=u(C,{transfer:[C]}),P===M&&(I||D)))return C;if(P>=M&&(!I||D))G=w(C,0,M);else{var U=I&&!D&&E?{maxByteLength:E(C)}:void 0;G=new f(M,U);for(var W=new p(C),pt=new p(G),F=v(M,P),k=0;k<F;k++)x(pt,k,T(W,k))}return d||h(C),G}},5745:(c,e,t)=>{var s=t(7629);c.exports=function(i,n){return s[i]||(s[i]=n||{})}},5781:(c,e,t)=>{var s=t(6518),i=t(7751),n=t(2812),r=t(655),o=t(7416),l=i("URL");s({target:"URL",stat:!0,forced:!o},{parse:function(d){var u=n(arguments.length,1),f=r(d),p=u<2||arguments[1]===void 0?void 0:r(arguments[1]);try{return new l(f,p)}catch{return null}}})},5876:(c,e,t)=>{var s=t(6518),i=t(3838),n=t(4916),r=!n("isSubsetOf",function(o){return o});s({target:"Set",proto:!0,real:!0,forced:r},{isSubsetOf:i})},5917:(c,e,t)=>{var s=t(3724),i=t(9039),n=t(4055);c.exports=!s&&!i(function(){return Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a!==7})},5966:(c,e,t)=>{var s=t(9306),i=t(4117);c.exports=function(n,r){var o=n[r];return i(o)?void 0:s(o)}},6043:(c,e,t)=>{var s=t(9306),i=TypeError,n=function(r){var o,l;this.promise=new r(function(h,d){if(o!==void 0||l!==void 0)throw new i("Bad Promise constructor");o=h,l=d}),this.resolve=s(o),this.reject=s(l)};c.exports.f=function(r){return new n(r)}},6080:(c,e,t)=>{var s=t(7476),i=t(9306),n=t(616),r=s(s.bind);c.exports=function(o,l){return i(o),l===void 0?o:n?r(o,l):function(){return o.apply(l,arguments)}}},6119:(c,e,t)=>{var s=t(5745),i=t(3392),n=s("keys");c.exports=function(r){return n[r]||(n[r]=i(r))}},6193:(c,e,t)=>{var s=t(4215);c.exports=s==="NODE"},6198:(c,e,t)=>{var s=t(8014);c.exports=function(i){return s(i.length)}},6269:c=>{c.exports={}},6279:(c,e,t)=>{var s=t(6840);c.exports=function(i,n,r){for(var o in n)s(i,o,n[o],r);return i}},6319:(c,e,t)=>{var s=t(8551),i=t(9539);c.exports=function(n,r,o,l){try{return l?r(s(o)[0],o[1]):r(o)}catch(h){i(n,"throw",h)}}},6395:c=>{c.exports=!1},6518:(c,e,t)=>{var s=t(4576),i=t(7347).f,n=t(6699),r=t(6840),o=t(9433),l=t(7740),h=t(2796);c.exports=function(d,u){var f=d.target,p=d.global,v=d.stat,g,A,w,S,E,T;if(p?A=s:v?A=s[f]||o(f,{}):A=s[f]&&s[f].prototype,A)for(w in u){if(E=u[w],d.dontCallGetSet?(T=i(A,w),S=T&&T.value):S=A[w],g=h(p?w:f+(v?".":"#")+w,d.forced),!g&&S!==void 0){if(typeof E==typeof S)continue;l(E,S)}(d.sham||S&&S.sham)&&n(E,"sham",!0),r(A,w,E,d)}}},6573:(c,e,t)=>{var s=t(3724),i=t(2106),n=t(3238),r=ArrayBuffer.prototype;s&&!("detached"in r)&&i(r,"detached",{configurable:!0,get:function(){return n(this)}})},6699:(c,e,t)=>{var s=t(3724),i=t(4913),n=t(6980);c.exports=s?function(r,o,l){return i.f(r,o,n(1,l))}:function(r,o,l){return r[o]=l,r}},6706:(c,e,t)=>{var s=t(9504),i=t(9306);c.exports=function(n,r,o){try{return s(i(Object.getOwnPropertyDescriptor(n,r)[o]))}catch{}}},6801:(c,e,t)=>{var s=t(3724),i=t(8686),n=t(4913),r=t(8551),o=t(5397),l=t(1072);e.f=s&&!i?Object.defineProperties:function(d,u){r(d);for(var f=o(u),p=l(u),v=p.length,g=0,A;v>g;)n.f(d,A=p[g++],f[A]);return d}},6823:c=>{var e=String;c.exports=function(t){try{return e(t)}catch{return"Object"}}},6837:c=>{var e=TypeError,t=9007199254740991;c.exports=function(s){if(s>t)throw e("Maximum allowed index exceeded");return s}},6840:(c,e,t)=>{var s=t(4901),i=t(4913),n=t(283),r=t(9433);c.exports=function(o,l,h,d){d||(d={});var u=d.enumerable,f=d.name!==void 0?d.name:l;if(s(h)&&n(h,f,d),d.global)u?o[l]=h:r(l,h);else{try{d.unsafe?o[l]&&(u=!0):delete o[l]}catch{}u?o[l]=h:i.f(o,l,{value:h,enumerable:!1,configurable:!d.nonConfigurable,writable:!d.nonWritable})}return o}},6955:(c,e,t)=>{var s=t(2140),i=t(4901),n=t(2195),r=t(8227),o=r("toStringTag"),l=Object,h=n(function(){return arguments}())==="Arguments",d=function(u,f){try{return u[f]}catch{}};c.exports=s?n:function(u){var f,p,v;return u===void 0?"Undefined":u===null?"Null":typeof(p=d(f=l(u),o))=="string"?p:h?n(f):(v=n(f))==="Object"&&i(f.callee)?"Arguments":v}},6969:(c,e,t)=>{var s=t(2777),i=t(757);c.exports=function(n){var r=s(n,"string");return i(r)?r:r+""}},6980:c=>{c.exports=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}}},7040:(c,e,t)=>{var s=t(4495);c.exports=s&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},7055:(c,e,t)=>{var s=t(9504),i=t(9039),n=t(2195),r=Object,o=s("".split);c.exports=i(function(){return!r("z").propertyIsEnumerable(0)})?function(l){return n(l)==="String"?o(l,""):r(l)}:r},7080:(c,e,t)=>{var s=t(4402).has;c.exports=function(i){return s(i),i}},7347:(c,e,t)=>{var s=t(3724),i=t(9565),n=t(8773),r=t(6980),o=t(5397),l=t(6969),h=t(9297),d=t(5917),u=Object.getOwnPropertyDescriptor;e.f=s?u:function(p,v){if(p=o(p),v=l(v),d)try{return u(p,v)}catch{}if(h(p,v))return r(!i(n.f,p,v),p[v])}},7394:(c,e,t)=>{var s=t(4576),i=t(6706),n=t(2195),r=s.ArrayBuffer,o=s.TypeError;c.exports=r&&i(r.prototype,"byteLength","get")||function(l){if(n(l)!=="ArrayBuffer")throw new o("ArrayBuffer expected");return l.byteLength}},7416:(c,e,t)=>{var s=t(9039),i=t(8227),n=t(3724),r=t(6395),o=i("iterator");c.exports=!s(function(){var l=new URL("b?a=1&b=2&c=3","https://a"),h=l.searchParams,d=new URLSearchParams("a=1&a=2&b=3"),u="";return l.pathname="c%20d",h.forEach(function(f,p){h.delete("b"),u+=p+f}),d.delete("a",2),d.delete("b",void 0),r&&(!l.toJSON||!d.has("a",1)||d.has("a",2)||!d.has("a",void 0)||d.has("b"))||!h.size&&(r||!n)||!h.sort||l.href!=="https://a/c%20d?a=1&c=3"||h.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!h[o]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||u!=="a1c3"||new URL("https://x",void 0).host!=="x"})},7476:(c,e,t)=>{var s=t(2195),i=t(9504);c.exports=function(n){if(s(n)==="Function")return i(n)}},7566:(c,e,t)=>{var s=t(6840),i=t(9504),n=t(655),r=t(2812),o=URLSearchParams,l=o.prototype,h=i(l.getAll),d=i(l.has),u=new o("a=1");(u.has("a",2)||!u.has("a",void 0))&&s(l,"has",function(p){var v=arguments.length,g=v<2?void 0:arguments[1];if(v&&g===void 0)return d(this,p);var A=h(this,p);r(v,1);for(var w=n(g),S=0;S<A.length;)if(A[S++]===w)return!0;return!1},{enumerable:!0,unsafe:!0})},7629:(c,e,t)=>{var s=t(6395),i=t(4576),n=t(9433),r="__core-js_shared__",o=c.exports=i[r]||n(r,{});(o.versions||(o.versions=[])).push({version:"3.42.0",mode:s?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"})},7642:(c,e,t)=>{var s=t(6518),i=t(3440),n=t(4916),r=!n("difference",function(o){return o.size===0});s({target:"Set",proto:!0,real:!0,forced:r},{difference:i})},7657:(c,e,t)=>{var s=t(9039),i=t(4901),n=t(34),r=t(2360),o=t(2787),l=t(6840),h=t(8227),d=t(6395),u=h("iterator"),f=!1,p,v,g;[].keys&&(g=[].keys(),"next"in g?(v=o(o(g)),v!==Object.prototype&&(p=v)):f=!0);var A=!n(p)||s(function(){var w={};return p[u].call(w)!==w});A?p={}:d&&(p=r(p)),i(p[u])||l(p,u,function(){return this}),c.exports={IteratorPrototype:p,BUGGY_SAFARI_ITERATORS:f}},7680:(c,e,t)=>{var s=t(9504);c.exports=s([].slice)},7696:(c,e,t)=>{var s=t(1291),i=t(8014),n=RangeError;c.exports=function(r){if(r===void 0)return 0;var o=s(r),l=i(o);if(o!==l)throw new n("Wrong length or index");return l}},7740:(c,e,t)=>{var s=t(9297),i=t(5031),n=t(7347),r=t(4913);c.exports=function(o,l,h){for(var d=i(l),u=r.f,f=n.f,p=0;p<d.length;p++){var v=d[p];!s(o,v)&&!(h&&s(h,v))&&u(o,v,f(l,v))}}},7750:(c,e,t)=>{var s=t(4117),i=TypeError;c.exports=function(n){if(s(n))throw new i("Can't call method on "+n);return n}},7751:(c,e,t)=>{var s=t(4576),i=t(4901),n=function(r){return i(r)?r:void 0};c.exports=function(r,o){return arguments.length<2?n(s[r]):s[r]&&s[r][o]}},7811:c=>{c.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},7936:(c,e,t)=>{var s=t(6518),i=t(5636);i&&s({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return i(this,arguments.length?arguments[0]:void 0,!1)}})},8004:(c,e,t)=>{var s=t(6518),i=t(9039),n=t(8750),r=t(4916),o=!r("intersection",function(l){return l.size===2&&l.has(1)&&l.has(2)})||i(function(){return String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))!=="3,2"});s({target:"Set",proto:!0,real:!0,forced:o},{intersection:n})},8014:(c,e,t)=>{var s=t(1291),i=Math.min;c.exports=function(n){var r=s(n);return r>0?i(r,9007199254740991):0}},8100:(c,e,t)=>{var s=t(6518),i=t(5636);i&&s({target:"ArrayBuffer",proto:!0},{transfer:function(){return i(this,arguments.length?arguments[0]:void 0,!0)}})},8111:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(679),r=t(8551),o=t(4901),l=t(2787),h=t(2106),d=t(4659),u=t(9039),f=t(9297),p=t(8227),v=t(7657).IteratorPrototype,g=t(3724),A=t(6395),w="constructor",S="Iterator",E=p("toStringTag"),T=TypeError,x=i[S],C=A||!o(x)||x.prototype!==v||!u(function(){x({})}),R=function(){if(n(this,v),l(this)===v)throw new T("Abstract class Iterator not directly constructable")},I=function(P,M){g?h(v,P,{configurable:!0,get:function(){return M},set:function(D){if(r(this),this===v)throw new T("You can't redefine this property");f(this,P)?this[P]=D:d(this,P,D)}}):v[P]=M};f(v,E)||I(E,S),(C||!f(v,w)||v[w]===Object)&&I(w,R),R.prototype=v,s({global:!0,constructor:!0,forced:C},{Iterator:R})},8227:(c,e,t)=>{var s=t(4576),i=t(5745),n=t(9297),r=t(3392),o=t(4495),l=t(7040),h=s.Symbol,d=i("wks"),u=l?h.for||h:h&&h.withoutSetter||r;c.exports=function(f){return n(d,f)||(d[f]=o&&n(h,f)?h[f]:u("Symbol."+f)),d[f]}},8235:(c,e,t)=>{var s=t(9504),i=t(9297),n=SyntaxError,r=parseInt,o=String.fromCharCode,l=s("".charAt),h=s("".slice),d=s(/./.exec),u={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	"},f=/^[\da-f]{4}$/i,p=/^[\u0000-\u001F]$/;c.exports=function(v,g){for(var A=!0,w="";g<v.length;){var S=l(v,g);if(S==="\\"){var E=h(v,g,g+2);if(i(u,E))w+=u[E],g+=2;else if(E==="\\u"){g+=2;var T=h(v,g,g+4);if(!d(f,T))throw new n("Bad Unicode escape at: "+g);w+=o(r(T,16)),g+=4}else throw new n('Unknown escape sequence: "'+E+'"')}else if(S==='"'){A=!1,g++;break}else{if(d(p,S))throw new n("Bad control character in string literal at: "+g);w+=S,g++}}if(A)throw new n("Unterminated string at: "+g);return{value:w,end:g}}},8237:(c,e,t)=>{var s=t(6518),i=t(2652),n=t(9306),r=t(8551),o=t(1767),l=t(9539),h=t(4549),d=t(8745),u=t(9039),f=TypeError,p=u(function(){[].keys().reduce(function(){},void 0)}),v=!p&&h("reduce",f);s({target:"Iterator",proto:!0,real:!0,forced:p||v},{reduce:function(A){r(this);try{n(A)}catch(x){l(this,"throw",x)}var w=arguments.length<2,S=w?void 0:arguments[1];if(v)return d(v,this,w?[A]:[A,S]);var E=o(this),T=0;if(i(E,function(x){w?(w=!1,S=x):S=A(S,x,T),T++},{IS_RECORD:!0}),w)throw new f("Reduce of empty iterator with no initial value");return S}})},8335:(c,e,t)=>{var s=t(6518),i=t(3724),n=t(4576),r=t(7751),o=t(9504),l=t(9565),h=t(4901),d=t(34),u=t(4376),f=t(9297),p=t(655),v=t(6198),g=t(4659),A=t(9039),w=t(8235),S=t(4495),E=n.JSON,T=n.Number,x=n.SyntaxError,C=E&&E.parse,R=r("Object","keys"),I=Object.getOwnPropertyDescriptor,P=o("".charAt),M=o("".slice),D=o(/./.exec),G=o([].push),U=/^\d$/,W=/^[1-9]$/,pt=/^[\d-]$/,F=/^[\t\n\r ]$/,k=0,at=1,le=function(j,L){j=p(j);var _=new vt(j,0),Z=_.parse(),bt=Z.value,Ct=_.skip(F,Z.end);if(Ct<j.length)throw new x('Unexpected extra character: "'+P(j,Ct)+'" after the parsed data at: '+Ct);return h(L)?ye({"":bt},"",L,Z):bt},ye=function(j,L,_,Z){var bt=j[L],Ct=Z&&bt===Z.value,Mi=Ct&&typeof Z.source=="string"?{source:Z.source}:{},Li,io,fh,ss,no;if(d(bt)){var Fu=u(bt),ph=Ct?Z.nodes:Fu?[]:{};if(Fu)for(Li=ph.length,fh=v(bt),ss=0;ss<fh;ss++)Ge(bt,ss,ye(bt,""+ss,_,ss<Li?ph[ss]:void 0));else for(io=R(bt),fh=v(io),ss=0;ss<fh;ss++)no=io[ss],Ge(bt,no,ye(bt,no,_,f(ph,no)?ph[no]:void 0))}return l(_,j,L,bt,Mi)},Ge=function(j,L,_){if(i){var Z=I(j,L);if(Z&&!Z.configurable)return}_===void 0?delete j[L]:g(j,L,_)},Mt=function(j,L,_,Z){this.value=j,this.end=L,this.source=_,this.nodes=Z},vt=function(j,L){this.source=j,this.index=L};vt.prototype={fork:function(j){return new vt(this.source,j)},parse:function(){var j=this.source,L=this.skip(F,this.index),_=this.fork(L),Z=P(j,L);if(D(pt,Z))return _.number();switch(Z){case"{":return _.object();case"[":return _.array();case'"':return _.string();case"t":return _.keyword(!0);case"f":return _.keyword(!1);case"n":return _.keyword(null)}throw new x('Unexpected character: "'+Z+'" at: '+L)},node:function(j,L,_,Z,bt){return new Mt(L,Z,j?null:M(this.source,_,Z),bt)},object:function(){for(var j=this.source,L=this.index+1,_=!1,Z={},bt={};L<j.length;){if(L=this.until(['"',"}"],L),P(j,L)==="}"&&!_){L++;break}var Ct=this.fork(L).string(),Mi=Ct.value;L=Ct.end,L=this.until([":"],L)+1,L=this.skip(F,L),Ct=this.fork(L).parse(),g(bt,Mi,Ct),g(Z,Mi,Ct.value),L=this.until([",","}"],Ct.end);var Li=P(j,L);if(Li===",")_=!0,L++;else if(Li==="}"){L++;break}}return this.node(at,Z,this.index,L,bt)},array:function(){for(var j=this.source,L=this.index+1,_=!1,Z=[],bt=[];L<j.length;){if(L=this.skip(F,L),P(j,L)==="]"&&!_){L++;break}var Ct=this.fork(L).parse();if(G(bt,Ct),G(Z,Ct.value),L=this.until([",","]"],Ct.end),P(j,L)===",")_=!0,L++;else if(P(j,L)==="]"){L++;break}}return this.node(at,Z,this.index,L,bt)},string:function(){var j=this.index,L=w(this.source,this.index+1);return this.node(k,L.value,j,L.end)},number:function(){var j=this.source,L=this.index,_=L;if(P(j,_)==="-"&&_++,P(j,_)==="0")_++;else if(D(W,P(j,_)))_=this.skip(U,_+1);else throw new x("Failed to parse number at: "+_);if(P(j,_)==="."&&(_=this.skip(U,_+1)),P(j,_)==="e"||P(j,_)==="E"){_++,(P(j,_)==="+"||P(j,_)==="-")&&_++;var Z=_;if(_=this.skip(U,_),Z===_)throw new x("Failed to parse number's exponent value at: "+_)}return this.node(k,T(M(j,L,_)),L,_)},keyword:function(j){var L=""+j,_=this.index,Z=_+L.length;if(M(this.source,_,Z)!==L)throw new x("Failed to parse value at: "+_);return this.node(k,j,_,Z)},skip:function(j,L){for(var _=this.source;L<_.length&&D(j,P(_,L));L++);return L},until:function(j,L){L=this.skip(F,L);for(var _=P(this.source,L),Z=0;Z<j.length;Z++)if(j[Z]===_)return L;throw new x('Unexpected character: "'+_+'" at: '+L)}};var Pi=A(function(){var j="9007199254740993",L;return C(j,function(_,Z,bt){L=bt.source}),L!==j}),As=S&&!A(function(){return 1/C("-0 	")!==-1/0});s({target:"JSON",stat:!0,forced:Pi},{parse:function(L,_){return As&&!h(_)?C(L):le(L,_)}})},8469:(c,e,t)=>{var s=t(9504),i=t(507),n=t(4402),r=n.Set,o=n.proto,l=s(o.forEach),h=s(o.keys),d=h(new r).next;c.exports=function(u,f,p){return p?i({iterator:h(u),next:d},f):l(u,f)}},8480:(c,e,t)=>{var s=t(1828),i=t(8727),n=i.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(o){return s(o,n)}},8527:(c,e,t)=>{var s=t(7080),i=t(4402).has,n=t(5170),r=t(3789),o=t(507),l=t(9539);c.exports=function(d){var u=s(this),f=r(d);if(n(u)<f.size)return!1;var p=f.getIterator();return o(p,function(v){if(!i(u,v))return l(p,"normal",!1)})!==!1}},8551:(c,e,t)=>{var s=t(34),i=String,n=TypeError;c.exports=function(r){if(s(r))return r;throw new n(i(r)+" is not an object")}},8574:(c,e,t)=>{var s=t(9504),i=Error,n=s("".replace),r=function(h){return String(new i(h).stack)}("zxcasd"),o=/\n\s*at [^:]*:[^\n]*/,l=o.test(r);c.exports=function(h,d){if(l&&typeof h=="string"&&!i.prepareStackTrace)for(;d--;)h=n(h,o,"");return h}},8622:(c,e,t)=>{var s=t(4576),i=t(4901),n=s.WeakMap;c.exports=i(n)&&/native code/.test(String(n))},8646:(c,e,t)=>{var s=t(9565),i=t(8551),n=t(1767),r=t(851);c.exports=function(o,l){(!l||typeof o!="string")&&i(o);var h=r(o);return n(i(h!==void 0?s(h,o):o))}},8686:(c,e,t)=>{var s=t(3724),i=t(9039);c.exports=s&&i(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42})},8721:(c,e,t)=>{var s=t(3724),i=t(9504),n=t(2106),r=URLSearchParams.prototype,o=i(r.forEach);s&&!("size"in r)&&n(r,"size",{get:function(){var h=0;return o(this,function(){h++}),h},configurable:!0,enumerable:!0})},8727:c=>{c.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},8745:(c,e,t)=>{var s=t(616),i=Function.prototype,n=i.apply,r=i.call;c.exports=typeof Reflect=="object"&&Reflect.apply||(s?r.bind(n):function(){return r.apply(n,arguments)})},8750:(c,e,t)=>{var s=t(7080),i=t(4402),n=t(5170),r=t(3789),o=t(8469),l=t(507),h=i.Set,d=i.add,u=i.has;c.exports=function(p){var v=s(this),g=r(p),A=new h;return n(v)>g.size?l(g.getIterator(),function(w){u(v,w)&&d(A,w)}):o(v,function(w){g.includes(w)&&d(A,w)}),A}},8773:(c,e)=>{var t={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,i=s&&!t.call({1:2},1);e.f=i?function(r){var o=s(this,r);return!!o&&o.enumerable}:t},8981:(c,e,t)=>{var s=t(7750),i=Object;c.exports=function(n){return i(s(n))}},9039:c=>{c.exports=function(e){try{return!!e()}catch{return!0}}},9143:(c,e,t)=>{var s=t(4576),i=t(9504),n=t(3972),r=t(3463),o=t(9297),l=t(2804),h=t(944),d=t(5169),u=l.c2i,f=l.c2iUrl,p=s.SyntaxError,v=s.TypeError,g=i("".charAt),A=function(E,T){for(var x=E.length;T<x;T++){var C=g(E,T);if(C!==" "&&C!=="	"&&C!==`
`&&C!=="\f"&&C!=="\r")break}return T},w=function(E,T,x){var C=E.length;C<4&&(E+=C===2?"AA":"A");var R=(T[g(E,0)]<<18)+(T[g(E,1)]<<12)+(T[g(E,2)]<<6)+T[g(E,3)],I=[R>>16&255,R>>8&255,R&255];if(C===2){if(x&&I[1]!==0)throw new p("Extra bits");return[I[0]]}if(C===3){if(x&&I[2]!==0)throw new p("Extra bits");return[I[0],I[1]]}return I},S=function(E,T,x){for(var C=T.length,R=0;R<C;R++)E[x+R]=T[R];return x+C};c.exports=function(E,T,x,C){r(E),n(T);var R=h(T)==="base64"?u:f,I=T?T.lastChunkHandling:void 0;if(I===void 0&&(I="loose"),I!=="loose"&&I!=="strict"&&I!=="stop-before-partial")throw new v("Incorrect `lastChunkHandling` option");x&&d(x.buffer);var P=x||[],M=0,D=0,G="",U=0;if(C)for(;;){if(U=A(E,U),U===E.length){if(G.length>0){if(I==="stop-before-partial")break;if(I==="loose"){if(G.length===1)throw new p("Malformed padding: exactly one additional character");M=S(P,w(G,R,!1),M)}else throw new p("Missing padding")}D=E.length;break}var W=g(E,U);if(++U,W==="="){if(G.length<2)throw new p("Padding is too early");if(U=A(E,U),G.length===2){if(U===E.length){if(I==="stop-before-partial")break;throw new p("Malformed padding: only one =")}g(E,U)==="="&&(++U,U=A(E,U))}if(U<E.length)throw new p("Unexpected character after padding");M=S(P,w(G,R,I==="strict"),M),D=E.length;break}if(!o(R,W))throw new p("Unexpected character");var pt=C-M;if(pt===1&&G.length===2||pt===2&&G.length===3||(G+=W,G.length===4&&(M=S(P,w(G,R,!1),M),G="",D=U,M===C)))break}return{bytes:P,read:D,written:M}}},9286:(c,e,t)=>{var s=t(4402),i=t(8469),n=s.Set,r=s.add;c.exports=function(o){var l=new n;return i(o,function(h){r(l,h)}),l}},9297:(c,e,t)=>{var s=t(9504),i=t(8981),n=s({}.hasOwnProperty);c.exports=Object.hasOwn||function(o,l){return n(i(o),l)}},9306:(c,e,t)=>{var s=t(4901),i=t(6823),n=TypeError;c.exports=function(r){if(s(r))return r;throw new n(i(r)+" is not a function")}},9314:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(8551),r=t(1767),o=t(4149),l=t(9590),h=t(9539),d=t(9462),u=t(4549),f=t(6395),p=!f&&u("drop",RangeError),v=d(function(){for(var g=this.iterator,A=this.next,w,S;this.remaining;)if(this.remaining--,w=n(i(A,g)),S=this.done=!!w.done,S)return;if(w=n(i(A,g)),S=this.done=!!w.done,!S)return w.value});s({target:"Iterator",proto:!0,real:!0,forced:f||p},{drop:function(A){n(this);var w;try{w=l(o(+A))}catch(S){h(this,"throw",S)}return p?i(p,this,w):new v(r(this),{remaining:w})}})},9429:(c,e,t)=>{var s=t(4576),i=t(6193);c.exports=function(n){if(i){try{return s.process.getBuiltinModule(n)}catch{}try{return Function('return require("'+n+'")')()}catch{}}}},9432:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(5370),r=t(9143),o=i.Uint8Array;o&&s({target:"Uint8Array",stat:!0},{fromBase64:function(h){var d=r(h,arguments.length>1?arguments[1]:void 0,null,9007199254740991);return n(o,d.bytes)}})},9433:(c,e,t)=>{var s=t(4576),i=Object.defineProperty;c.exports=function(n,r){try{i(s,n,{value:r,configurable:!0,writable:!0})}catch{s[n]=r}return r}},9462:(c,e,t)=>{var s=t(9565),i=t(2360),n=t(6699),r=t(6279),o=t(8227),l=t(1181),h=t(5966),d=t(7657).IteratorPrototype,u=t(2529),f=t(9539),p=o("toStringTag"),v="IteratorHelper",g="WrapForValidIterator",A=l.set,w=function(T){var x=l.getterFor(T?g:v);return r(i(d),{next:function(){var R=x(this);if(T)return R.nextHandler();if(R.done)return u(void 0,!0);try{var I=R.nextHandler();return R.returnHandlerResult?I:u(I,R.done)}catch(P){throw R.done=!0,P}},return:function(){var C=x(this),R=C.iterator;if(C.done=!0,T){var I=h(R,"return");return I?s(I,R):u(void 0,!0)}if(C.inner)try{f(C.inner.iterator,"normal")}catch(P){return f(R,"throw",P)}return R&&f(R,"normal"),u(void 0,!0)}})},S=w(!0),E=w(!1);n(E,p,"Iterator Helper"),c.exports=function(T,x,C){var R=function(P,M){M?(M.iterator=P.iterator,M.next=P.next):M=P,M.type=x?g:v,M.returnHandlerResult=!!C,M.nextHandler=T,M.counter=0,M.done=!1,A(this,M)};return R.prototype=x?S:E,R}},9504:(c,e,t)=>{var s=t(616),i=Function.prototype,n=i.call,r=s&&i.bind.bind(n,n);c.exports=s?r:function(o){return function(){return n.apply(o,arguments)}}},9519:(c,e,t)=>{var s=t(4576),i=t(2839),n=s.process,r=s.Deno,o=n&&n.versions||r&&r.version,l=o&&o.v8,h,d;l&&(h=l.split("."),d=h[0]>0&&h[0]<4?1:+(h[0]+h[1])),!d&&i&&(h=i.match(/Edge\/(\d+)/),(!h||h[1]>=74)&&(h=i.match(/Chrome\/(\d+)/),h&&(d=+h[1]))),c.exports=d},9539:(c,e,t)=>{var s=t(9565),i=t(8551),n=t(5966);c.exports=function(r,o,l){var h,d;i(r);try{if(h=n(r,"return"),!h){if(o==="throw")throw l;return l}h=s(h,r)}catch(u){d=!0,h=u}if(o==="throw")throw l;if(d)throw h;return i(h),l}},9565:(c,e,t)=>{var s=t(616),i=Function.prototype.call;c.exports=s?i.bind(i):function(){return i.apply(i,arguments)}},9590:(c,e,t)=>{var s=t(1291),i=RangeError;c.exports=function(n){var r=s(n);if(r<0)throw new i("The argument can't be less than 0");return r}},9617:(c,e,t)=>{var s=t(5397),i=t(5610),n=t(6198),r=function(o){return function(l,h,d){var u=s(l),f=n(u);if(f===0)return!o&&-1;var p=i(d,f),v;if(o&&h!==h){for(;f>p;)if(v=u[p++],v!==v)return!0}else for(;f>p;p++)if((o||p in u)&&u[p]===h)return o||p||0;return!o&&-1}};c.exports={includes:r(!0),indexOf:r(!1)}},9631:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(9504),r=t(3972),o=t(4154),l=t(5169),h=t(2804),d=t(944),u=h.i2c,f=h.i2cUrl,p=n("".charAt);i.Uint8Array&&s({target:"Uint8Array",proto:!0},{toBase64:function(){var g=o(this),A=arguments.length?r(arguments[0]):void 0,w=d(A)==="base64"?u:f,S=!!A&&!!A.omitPadding;l(this.buffer);for(var E="",T=0,x=g.length,C,R=function(I){return p(w,C>>6*I&63)};T+2<x;T+=3)C=(g[T]<<16)+(g[T+1]<<8)+g[T+2],E+=R(3)+R(2)+R(1)+R(0);return T+2===x?(C=(g[T]<<16)+(g[T+1]<<8),E+=R(3)+R(2)+R(1)+(S?"":"=")):T+1===x&&(C=g[T]<<16,E+=R(3)+R(2)+(S?"":"==")),E}})},9797:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(3463),r=t(4154),o=t(5169),l=t(2303);i.Uint8Array&&s({target:"Uint8Array",proto:!0},{setFromHex:function(d){r(this),n(d),o(this.buffer);var u=l(d,this).read;return{read:u,written:u/2}}})}},Bu={};function nt(c){var e=Bu[c];if(e!==void 0)return e.exports;var t=Bu[c]={exports:{}};return Gg[c].call(t.exports,t,t.exports,nt),t.exports}nt(4114);nt(6573);nt(8100);nt(7936);nt(8111);nt(8237);nt(1689);nt(9432);nt(1549);nt(9797);nt(9631);nt(5623);nt(4979);nt(5781);const ge=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Qc=[.001,0,0,.001,0,0],Bc=1.35,$e={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ni={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Vg="pdfjs_internal_editor_",K={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101},et={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},Wg={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},se={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},xh={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Ot={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},$r={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Lc={ERRORS:0,WARNINGS:1,INFOS:5},ec={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},mh={moveTo:0,lineTo:1,curveTo:2,closePath:3},Xg={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Oc=Lc.WARNINGS;function Yg(c){Number.isInteger(c)&&(Oc=c)}function Kg(){return Oc}function Dc(c){Oc>=Lc.INFOS&&console.log(`Info: ${c}`)}function Y(c){Oc>=Lc.WARNINGS&&console.log(`Warning: ${c}`)}function dt(c){throw new Error(c)}function Nt(c,e){c||dt(e)}function Qg(c){switch(c==null?void 0:c.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function hf(c,e=null,t=null){if(!c)return null;if(t&&typeof c=="string"){if(t.addDefaultProtocol&&c.startsWith("www.")){const i=c.match(/\./g);(i==null?void 0:i.length)>=2&&(c=`http://${c}`)}if(t.tryConvertEncoding)try{c=em(c)}catch{}}const s=e?URL.parse(c,e):URL.parse(c);return Qg(s)?s:null}function cf(c,e,t=!1){const s=URL.parse(c);return s?(s.hash=e,s.href):t&&hf(c,"http://example.com")?c.split("#",1)[0]+`${e?`#${e}`:""}`:""}function tt(c,e,t,s=!1){return Object.defineProperty(c,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const Br=function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e}();class Hu extends Br{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Hc extends Br{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class Jc extends Br{constructor(e){super(e,"InvalidPDFException")}}class sc extends Br{constructor(e,t,s){super(e,"ResponseException"),this.status=t,this.missing=s}}class Jg extends Br{constructor(e){super(e,"FormatError")}}class yn extends Br{constructor(e){super(e,"AbortException")}}function df(c){(typeof c!="object"||(c==null?void 0:c.length)===void 0)&&dt("Invalid argument for bytesToString");const e=c.length,t=8192;if(e<t)return String.fromCharCode.apply(null,c);const s=[];for(let i=0;i<e;i+=t){const n=Math.min(i+t,e),r=c.subarray(i,n);s.push(String.fromCharCode.apply(null,r))}return s.join("")}function ah(c){typeof c!="string"&&dt("Invalid argument for stringToBytes");const e=c.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=c.charCodeAt(s)&255;return t}function Zg(c){return String.fromCharCode(c>>24&255,c>>16&255,c>>8&255,c&255)}function qg(){const c=new Uint8Array(4);return c[0]=1,new Uint32Array(c.buffer,0,1)[0]===1}function tm(){try{return new Function(""),!0}catch{return!1}}class ee{static get isLittleEndian(){return tt(this,"isLittleEndian",qg())}static get isEvalSupported(){return tt(this,"isEvalSupported",tm())}static get isOffscreenCanvasSupported(){return tt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return tt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return tt(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return tt(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const $c=Array.from(Array(256).keys(),c=>c.toString(16).padStart(2,"0"));var Ti,Th,Zc;class V{static makeHexColor(e,t,s){return`#${$c[e]}${$c[t]}${$c[s]}`}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t,s=0){const i=e[s],n=e[s+1];e[s]=i*t[0]+n*t[2]+t[4],e[s+1]=i*t[1]+n*t[3]+t[5]}static applyTransformToBezier(e,t,s=0){const i=t[0],n=t[1],r=t[2],o=t[3],l=t[4],h=t[5];for(let d=0;d<6;d+=2){const u=e[s+d],f=e[s+d+1];e[s+d]=u*i+f*r+l,e[s+d+1]=u*n+f*o+h}}static applyInverseTransform(e,t){const s=e[0],i=e[1],n=t[0]*t[3]-t[1]*t[2];e[0]=(s*t[3]-i*t[2]+t[2]*t[5]-t[4]*t[3])/n,e[1]=(-s*t[1]+i*t[0]+t[4]*t[1]-t[5]*t[0])/n}static axialAlignedBoundingBox(e,t,s){const i=t[0],n=t[1],r=t[2],o=t[3],l=t[4],h=t[5],d=e[0],u=e[1],f=e[2],p=e[3];let v=i*d+l,g=v,A=i*f+l,w=A,S=o*u+h,E=S,T=o*p+h,x=T;if(n!==0||r!==0){const C=n*d,R=n*f,I=r*u,P=r*p;v+=I,w+=I,A+=P,g+=P,S+=C,x+=C,T+=R,E+=R}s[0]=Math.min(s[0],v,A,g,w),s[1]=Math.min(s[1],S,T,E,x),s[2]=Math.max(s[2],v,A,g,w),s[3]=Math.max(s[3],S,T,E,x)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const s=e[0],i=e[1],n=e[2],r=e[3],o=s**2+i**2,l=s*n+i*r,h=n**2+r**2,d=(o+h)/2,u=Math.sqrt(d**2-(o*h-l**2));t[0]=Math.sqrt(d+u||1),t[1]=Math.sqrt(d-u||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>i)return null;const n=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),r=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return n>r?null:[s,n,i,r]}static pointBoundingBox(e,t,s){s[0]=Math.min(s[0],e),s[1]=Math.min(s[1],t),s[2]=Math.max(s[2],e),s[3]=Math.max(s[3],t)}static rectBoundingBox(e,t,s,i,n){n[0]=Math.min(n[0],e,s),n[1]=Math.min(n[1],t,i),n[2]=Math.max(n[2],e,s),n[3]=Math.max(n[3],t,i)}static bezierBoundingBox(e,t,s,i,n,r,o,l,h){h[0]=Math.min(h[0],e,o),h[1]=Math.min(h[1],t,l),h[2]=Math.max(h[2],e,o),h[3]=Math.max(h[3],t,l),y(this,Ti,Zc).call(this,e,s,n,o,t,i,r,l,3*(-e+3*(s-n)+o),6*(e-2*s+n),3*(s-e),h),y(this,Ti,Zc).call(this,e,s,n,o,t,i,r,l,3*(-t+3*(i-r)+l),6*(t-2*i+r),3*(i-t),h)}}Ti=new WeakSet,Th=function(e,t,s,i,n,r,o,l,h,d){if(h<=0||h>=1)return;const u=1-h,f=h*h,p=f*h,v=u*(u*(u*e+3*h*t)+3*f*s)+p*i,g=u*(u*(u*n+3*h*r)+3*f*o)+p*l;d[0]=Math.min(d[0],v),d[1]=Math.min(d[1],g),d[2]=Math.max(d[2],v),d[3]=Math.max(d[3],g)},Zc=function(e,t,s,i,n,r,o,l,h,d,u,f){if(Math.abs(h)<1e-12){Math.abs(d)>=1e-12&&y(this,Ti,Th).call(this,e,t,s,i,n,r,o,l,-u/d,f);return}const p=d**2-4*u*h;if(p<0)return;const v=Math.sqrt(p),g=2*h;y(this,Ti,Th).call(this,e,t,s,i,n,r,o,l,(-d+v)/g,f),y(this,Ti,Th).call(this,e,t,s,i,n,r,o,l,(-d-v)/g,f)},b(V,Ti);function em(c){return decodeURIComponent(escape(c))}let jc=null,$u=null;function sm(c){return jc||(jc=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,$u=new Map([["ﬅ","ſt"]])),c.replaceAll(jc,(e,t,s)=>t?t.normalize("NFKC"):$u.get(s))}function uf(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const c=new Uint8Array(32);return crypto.getRandomValues(c),df(c)}const yu="pdfjs_internal_id_";function im(c,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[s,i,...n]=t;if(!c(s)&&!Number.isInteger(s)||!e(i))return!1;const r=n.length;let o=!0;switch(i.name){case"XYZ":if(r<2||r>3)return!1;break;case"Fit":case"FitB":return r===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(r>1)return!1;break;case"FitR":if(r!==4)return!1;o=!1;break;default:return!1}for(const l of n)if(!(typeof l=="number"||o&&l===null))return!1;return!0}function me(c,e,t){return Math.min(Math.max(c,e),t)}function ff(c){return Uint8Array.prototype.toBase64?c.toBase64():btoa(df(c))}function nm(c){return Uint8Array.fromBase64?Uint8Array.fromBase64(c):ah(atob(c))}typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(c){return c.reduce((e,t)=>e+t,0)});typeof AbortSignal.any!="function"&&(AbortSignal.any=function(c){const e=new AbortController,{signal:t}=e;for(const s of c)if(s.aborted)return e.abort(s.reason),t;for(const s of c)s.addEventListener("abort",()=>{e.abort(s.reason)},{signal:t});return t});nt(1701);nt(4628);nt(7642);nt(8004);nt(3853);nt(5876);nt(2475);nt(5024);nt(1698);nt(4603);nt(7566);nt(8721);nt(9314);nt(1148);nt(3579);nt(8335);const zs="http://www.w3.org/2000/svg",Rn=class Rn{};O(Rn,"CSS",96),O(Rn,"PDF",72),O(Rn,"PDF_TO_CSS_UNITS",Rn.CSS/Rn.PDF);let An=Rn;async function oh(c,e="text"){if(ho(c,document.baseURI)){const t=await fetch(c);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("GET",c,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class lh{constructor({viewBox:e,userUnit:t,scale:s,rotation:i,offsetX:n=0,offsetY:r=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=i,this.offsetX=n,this.offsetY=r,s*=t;const l=(e[2]+e[0])/2,h=(e[3]+e[1])/2;let d,u,f,p;switch(i%=360,i<0&&(i+=360),i){case 180:d=-1,u=0,f=0,p=1;break;case 90:d=0,u=1,f=1,p=0;break;case 270:d=0,u=-1,f=-1,p=0;break;case 0:d=1,u=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(f=-f,p=-p);let v,g,A,w;d===0?(v=Math.abs(h-e[1])*s+n,g=Math.abs(l-e[0])*s+r,A=(e[3]-e[1])*s,w=(e[2]-e[0])*s):(v=Math.abs(l-e[0])*s+n,g=Math.abs(h-e[1])*s+r,A=(e[2]-e[0])*s,w=(e[3]-e[1])*s),this.transform=[d*s,u*s,f*s,p*s,v-d*s*l-f*s*h,g-u*s*l-p*s*h],this.width=A,this.height=w}get rawDims(){const e=this.viewBox;return tt(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=!1}={}){return new lh({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:n})}convertToViewportPoint(e,t){const s=[e,t];return V.applyTransform(s,this.transform),s}convertToViewportRectangle(e){const t=[e[0],e[1]];V.applyTransform(t,this.transform);const s=[e[2],e[3]];return V.applyTransform(s,this.transform),[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){const s=[e,t];return V.applyInverseTransform(s,this.transform),s}}class Au extends Br{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Nc(c){const e=c.length;let t=0;for(;t<e&&c[t].trim()==="";)t++;return c.substring(t,t+5).toLowerCase()==="data:"}function wu(c){return typeof c=="string"&&/\.pdf$/i.test(c)}function rm(c){return[c]=c.split(/[#?]/,1),c.substring(c.lastIndexOf("/")+1)}function am(c,e="document.pdf"){if(typeof c!="string")return e;if(Nc(c))return Y('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=t.exec(c);let n=s.exec(i[1])||s.exec(i[2])||s.exec(i[3]);if(n&&(n=n[0],n.includes("%")))try{n=s.exec(decodeURIComponent(n))[0]}catch{}return n||e}class ju{constructor(){O(this,"started",Object.create(null));O(this,"times",[])}time(e){e in this.started&&Y(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Y(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:i,end:n}of this.times)e.push(`${s.padEnd(t)} ${n-i}ms
`);return e.join("")}}function ho(c,e){const t=e?URL.parse(c,e):URL.parse(c);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function bs(c){c.preventDefault()}function Dt(c){c.preventDefault(),c.stopPropagation()}function om(c){console.log("Deprecated API usage: "+c)}var Do;class Eu{static toDateObject(e){if(!e||typeof e!="string")return null;a(this,Do)||m(this,Do,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=a(this,Do).exec(e);if(!t)return null;const s=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(t[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(t[4],10);r=r>=0&&r<=23?r:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const h=t[7]||"Z";let d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let u=parseInt(t[9],10)||0;return u=u>=0&&u<=59?u:0,h==="-"?(r+=d,o+=u):h==="+"&&(r-=d,o-=u),new Date(Date.UTC(s,i,n,r,o,l))}}Do=new WeakMap,b(Eu,Do);function lm(c,{scale:e=1,rotation:t=0}){const{width:s,height:i}=c.attributes.style,n=[0,0,parseInt(s),parseInt(i)];return new lh({viewBox:n,userUnit:1,scale:e,rotation:t})}function Su(c){if(c.startsWith("#")){const e=parseInt(c.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return c.startsWith("rgb(")?c.slice(4,-1).split(",").map(e=>parseInt(e)):c.startsWith("rgba(")?c.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Y(`Not a valid color format: "${c}"`),[0,0,0])}function hm(c){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of c.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;c.set(t,Su(s))}e.remove()}function xt(c){const{a:e,b:t,c:s,d:i,e:n,f:r}=c.getTransform();return[e,t,s,i,n,r]}function ws(c){const{a:e,b:t,c:s,d:i,e:n,f:r}=c.getTransform().invertSelf();return[e,t,s,i,n,r]}function Fr(c,e,t=!1,s=!0){if(e instanceof lh){const{pageWidth:i,pageHeight:n}=e.rawDims,{style:r}=c,o=ee.isCSSRoundSupported,l=`var(--total-scale-factor) * ${i}px`,h=`var(--total-scale-factor) * ${n}px`,d=o?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,u=o?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!t||e.rotation%180===0?(r.width=d,r.height=u):(r.width=u,r.height=d)}s&&c.setAttribute("data-main-rotation",e.rotation)}class js{constructor(){const{pixelRatio:e}=js;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,s,i,n=-1){let r=1/0,o=1/0,l=1/0;s=js.capPixels(s,n),s>0&&(r=Math.sqrt(s/(e*t))),i!==-1&&(o=i/e,l=i/t);const h=Math.min(r,o,l);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,s):s}return e}}const qc=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];var Fi,Pn,We,ki,No,Jr,Fo,cc,pf,te,gf,mf,co,vf,Ch;const Ws=class Ws{constructor(e){b(this,te);b(this,Fi,null);b(this,Pn,null);b(this,We);b(this,ki,null);b(this,No,null);b(this,Jr,null);m(this,We,e),a(Ws,Fo)||m(Ws,Fo,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=m(this,Fi,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=a(this,We)._uiManager._signal;e.addEventListener("contextmenu",bs,{signal:t}),e.addEventListener("pointerdown",y(Ws,cc,pf),{signal:t});const s=m(this,ki,document.createElement("div"));s.className="buttons",e.append(s);const i=a(this,We).toolbarPosition;if(i){const{style:n}=e,r=a(this,We)._uiManager.direction==="ltr"?1-i[0]:i[0];n.insetInlineEnd=`${100*r}%`,n.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return y(this,te,vf).call(this),e}get div(){return a(this,Fi)}hide(){var e;a(this,Fi).classList.add("hidden"),(e=a(this,Pn))==null||e.hideDropdown()}show(){var e;a(this,Fi).classList.remove("hidden"),(e=a(this,No))==null||e.shown()}async addAltText(e){const t=await e.render();y(this,te,co).call(this,t),a(this,ki).prepend(t,a(this,te,Ch)),m(this,No,e)}addColorPicker(e){m(this,Pn,e);const t=e.renderButton();y(this,te,co).call(this,t),a(this,ki).prepend(t,a(this,te,Ch))}async addEditSignatureButton(e){const t=m(this,Jr,await e.renderEditButton(a(this,We)));y(this,te,co).call(this,t),a(this,ki).prepend(t,a(this,te,Ch))}updateEditSignatureButton(e){a(this,Jr)&&(a(this,Jr).title=e)}remove(){var e;a(this,Fi).remove(),(e=a(this,Pn))==null||e.destroy(),m(this,Pn,null)}};Fi=new WeakMap,Pn=new WeakMap,We=new WeakMap,ki=new WeakMap,No=new WeakMap,Jr=new WeakMap,Fo=new WeakMap,cc=new WeakSet,pf=function(e){e.stopPropagation()},te=new WeakSet,gf=function(e){a(this,We)._focusEventsAllowed=!1,Dt(e)},mf=function(e){a(this,We)._focusEventsAllowed=!0,Dt(e)},co=function(e){const t=a(this,We)._uiManager._signal;e.addEventListener("focusin",y(this,te,gf).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",y(this,te,mf).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",bs,{signal:t})},vf=function(){const{editorType:e,_uiManager:t}=a(this,We),s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",a(Ws,Fo)[e]),y(this,te,co).call(this,s),s.addEventListener("click",i=>{t.delete()},{signal:t._signal}),a(this,ki).append(s)},Ch=function(){const e=document.createElement("div");return e.className="divider",e},b(Ws,cc),b(Ws,Fo,null);let td=Ws;var ko,Mn,Ln,wn,bf,yf,Af;class cm{constructor(e){b(this,wn);b(this,ko,null);b(this,Mn,null);b(this,Ln);m(this,Ln,e)}show(e,t,s){const[i,n]=y(this,wn,yf).call(this,t,s),{style:r}=a(this,Mn)||m(this,Mn,y(this,wn,bf).call(this));e.append(a(this,Mn)),r.insetInlineEnd=`${100*i}%`,r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){a(this,Mn).remove()}}ko=new WeakMap,Mn=new WeakMap,Ln=new WeakMap,wn=new WeakSet,bf=function(){const e=m(this,Mn,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",bs,{signal:a(this,Ln)._signal});const t=m(this,ko,document.createElement("div"));return t.className="buttons",e.append(t),y(this,wn,Af).call(this),e},yf=function(e,t){let s=0,i=0;for(const n of e){const r=n.y+n.height;if(r<s)continue;const o=n.x+(t?n.width:0);if(r>s){i=o,s=r;continue}t?o>i&&(i=o):o<i&&(i=o)}return[t?1-i:i,s]},Af=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=a(this,Ln)._signal;e.addEventListener("contextmenu",bs,{signal:s}),e.addEventListener("click",()=>{a(this,Ln).highlightSelection("floating_button")},{signal:s}),a(this,ko).append(e)};function wf(c,e,t){for(const s of t)e.addEventListener(s,c[s].bind(c))}var dc;class dm{constructor(){b(this,dc,0)}get id(){return`${Vg}${he(this,dc)._++}`}}dc=new WeakMap;var Zr,_o,ne,qr,Rh;const Mu=class Mu{constructor(){b(this,qr);b(this,Zr,uf());b(this,_o,0);b(this,ne,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const n=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return tt(this,"_isSVGFittingCanvas",n)}async getFromFile(e){const{lastModified:t,name:s,size:i,type:n}=e;return y(this,qr,Rh).call(this,`${t}_${s}_${i}_${n}`,e)}async getFromUrl(e){return y(this,qr,Rh).call(this,e,e)}async getFromBlob(e,t){const s=await t;return y(this,qr,Rh).call(this,e,s)}async getFromId(e){a(this,ne)||m(this,ne,new Map);const t=a(this,ne).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){a(this,ne)||m(this,ne,new Map);let s=a(this,ne).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${a(this,Zr)}_${he(this,_o)._++}`,refCounter:1,isSvg:!1},a(this,ne).set(e,s),a(this,ne).set(s.id,s),s}getSvgUrl(e){const t=a(this,ne).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;a(this,ne)||m(this,ne,new Map);const t=a(this,ne).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const n=new OffscreenCanvas(s.width,s.height);n.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=n.convertToBlob()}(i=s.close)==null||i.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${a(this,Zr)}_`)}};Zr=new WeakMap,_o=new WeakMap,ne=new WeakMap,qr=new WeakSet,Rh=async function(e,t){a(this,ne)||m(this,ne,new Map);let s=a(this,ne).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${a(this,Zr)}_${he(this,_o)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(s.url=t,i=await oh(t,"blob")):t instanceof File?i=s.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const n=Mu._isSVGFittingCanvas,r=new FileReader,o=new Image,l=new Promise((h,d)=>{o.onload=()=>{s.bitmap=o,s.isSvg=!0,h()},r.onload=async()=>{const u=s.svgUrl=r.result;o.src=await n?`${u}#svgView(preserveAspectRatio(none))`:u},o.onerror=r.onerror=d});r.readAsDataURL(i),await l}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){Y(i),s=null}return a(this,ne).set(e,s),s&&a(this,ne).set(s.id,s),s};let ed=Mu;var Rt,_i,Bo,St;class um{constructor(e=128){b(this,Rt,[]);b(this,_i,!1);b(this,Bo);b(this,St,-1);m(this,Bo,e)}add({cmd:e,undo:t,post:s,mustExec:i,type:n=NaN,overwriteIfSameType:r=!1,keepUndo:o=!1}){if(i&&e(),a(this,_i))return;const l={cmd:e,undo:t,post:s,type:n};if(a(this,St)===-1){a(this,Rt).length>0&&(a(this,Rt).length=0),m(this,St,0),a(this,Rt).push(l);return}if(r&&a(this,Rt)[a(this,St)].type===n){o&&(l.undo=a(this,Rt)[a(this,St)].undo),a(this,Rt)[a(this,St)]=l;return}const h=a(this,St)+1;h===a(this,Bo)?a(this,Rt).splice(0,1):(m(this,St,h),h<a(this,Rt).length&&a(this,Rt).splice(h)),a(this,Rt).push(l)}undo(){if(a(this,St)===-1)return;m(this,_i,!0);const{undo:e,post:t}=a(this,Rt)[a(this,St)];e(),t==null||t(),m(this,_i,!1),m(this,St,a(this,St)-1)}redo(){if(a(this,St)<a(this,Rt).length-1){m(this,St,a(this,St)+1),m(this,_i,!0);const{cmd:e,post:t}=a(this,Rt)[a(this,St)];e(),t==null||t(),m(this,_i,!1)}}hasSomethingToUndo(){return a(this,St)!==-1}hasSomethingToRedo(){return a(this,St)<a(this,Rt).length-1}cleanType(e){if(a(this,St)!==-1){for(let t=a(this,St);t>=0;t--)if(a(this,Rt)[t].type!==e){a(this,Rt).splice(t+1,a(this,St)-t),m(this,St,t);return}a(this,Rt).length=0,m(this,St,-1)}}destroy(){m(this,Rt,null)}}Rt=new WeakMap,_i=new WeakMap,Bo=new WeakMap,St=new WeakMap;var uc,Ef;class hh{constructor(e){b(this,uc);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=ee.platform;for(const[s,i,n={}]of e)for(const r of s){const o=r.startsWith("mac+");t&&o?(this.callbacks.set(r.slice(4),{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1))):!t&&!o&&(this.callbacks.set(r,{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(y(this,uc,Ef).call(this,t));if(!s)return;const{callback:i,options:{bubbles:n=!1,args:r=[],checker:o=null}}=s;o&&!o(e,t)||(i.bind(e,...r,t)(),n||Dt(t))}}uc=new WeakSet,Ef=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const fc=class fc{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return hm(e),tt(this,"_colors",e)}convert(e){const t=Su(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,i]of this._colors)if(i.every((n,r)=>n===t[r]))return fc._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?V.makeHexColor(...t):e}};O(fc,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let sd=fc;var ta,Re,Bt,Xt,ea,Ys,sa,Xe,Bi,Hi,ia,On,xs,ns,Dn,Ho,$o,na,jo,Ts,$i,ra,ji,Cs,pc,Ui,Uo,zi,Nn,Fn,Gi,zo,jt,lt,Ks,Vi,kn,Go,Vo,Wi,Rs,Qs,Wo,Ye,N,Ih,id,Sf,xf,Ph,Tf,Cf,Rf,nd,If,rd,ad,Pf,ce,Gs,Mf,Lf,od,Of,uo,ld;const Yr=class Yr{constructor(e,t,s,i,n,r,o,l,h,d,u,f,p,v){b(this,N);b(this,ta,new AbortController);b(this,Re,null);b(this,Bt,new Map);b(this,Xt,new Map);b(this,ea,null);b(this,Ys,null);b(this,sa,null);b(this,Xe,new um);b(this,Bi,null);b(this,Hi,null);b(this,ia,0);b(this,On,new Set);b(this,xs,null);b(this,ns,null);b(this,Dn,new Set);O(this,"_editorUndoBar",null);b(this,Ho,!1);b(this,$o,!1);b(this,na,!1);b(this,jo,null);b(this,Ts,null);b(this,$i,null);b(this,ra,null);b(this,ji,!1);b(this,Cs,null);b(this,pc,new dm);b(this,Ui,!1);b(this,Uo,!1);b(this,zi,null);b(this,Nn,null);b(this,Fn,null);b(this,Gi,null);b(this,zo,null);b(this,jt,K.NONE);b(this,lt,new Set);b(this,Ks,null);b(this,Vi,null);b(this,kn,null);b(this,Go,null);b(this,Vo,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});b(this,Wi,[0,0]);b(this,Rs,null);b(this,Qs,null);b(this,Wo,null);b(this,Ye,null);const g=this._signal=a(this,ta).signal;m(this,Qs,e),m(this,Wo,t),m(this,ea,s),m(this,Vi,i),this._eventBus=n,n._on("editingaction",this.onEditingAction.bind(this),{signal:g}),n._on("pagechanging",this.onPageChanging.bind(this),{signal:g}),n._on("scalechanging",this.onScaleChanging.bind(this),{signal:g}),n._on("rotationchanging",this.onRotationChanging.bind(this),{signal:g}),n._on("setpreference",this.onSetPreference.bind(this),{signal:g}),n._on("switchannotationeditorparams",A=>this.updateParams(A.type,A.value),{signal:g}),y(this,N,Tf).call(this),y(this,N,Pf).call(this),y(this,N,nd).call(this),m(this,Ys,r.annotationStorage),m(this,jo,r.filterFactory),m(this,kn,o),m(this,ra,l||null),m(this,Ho,h),m(this,$o,d),m(this,na,u),m(this,zo,f||null),this.viewParameters={realScale:An.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=p||null,this._supportsPinchToZoom=v!==!1}static get _keyboardManager(){const e=Yr.prototype,t=r=>a(r,Qs).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),s=(r,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return tt(this,"_keyboardManager",new hh([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(r,{target:o})=>!(o instanceof HTMLButtonElement)&&a(r,Qs).contains(o)&&!r.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(r,{target:o})=>!(o instanceof HTMLButtonElement)&&a(r,Qs).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-n,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[n,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-n],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,n],checker:t}]]))}destroy(){var e,t,s,i,n,r,o,l;(e=a(this,Ye))==null||e.resolve(),m(this,Ye,null),(t=a(this,ta))==null||t.abort(),m(this,ta,null),this._signal=null;for(const h of a(this,Xt).values())h.destroy();a(this,Xt).clear(),a(this,Bt).clear(),a(this,Dn).clear(),(s=a(this,Gi))==null||s.clear(),m(this,Re,null),a(this,lt).clear(),a(this,Xe).destroy(),(i=a(this,ea))==null||i.destroy(),(n=a(this,Vi))==null||n.destroy(),(r=a(this,Cs))==null||r.hide(),m(this,Cs,null),(o=a(this,Fn))==null||o.destroy(),m(this,Fn,null),a(this,Ts)&&(clearTimeout(a(this,Ts)),m(this,Ts,null)),a(this,Rs)&&(clearTimeout(a(this,Rs)),m(this,Rs,null)),(l=this._editorUndoBar)==null||l.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return a(this,zo)}get useNewAltTextFlow(){return a(this,$o)}get useNewAltTextWhenAddingImage(){return a(this,na)}get hcmFilter(){return tt(this,"hcmFilter",a(this,kn)?a(this,jo).addHCMFilter(a(this,kn).foreground,a(this,kn).background):"none")}get direction(){return tt(this,"direction",getComputedStyle(a(this,Qs)).direction)}get highlightColors(){return tt(this,"highlightColors",a(this,ra)?new Map(a(this,ra).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return tt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),m(this,Hi,e)}setMainHighlightColorPicker(e){m(this,Fn,e)}editAltText(e,t=!1){var s;(s=a(this,ea))==null||s.editAltText(this,e,t)}getSignature(e){var t;(t=a(this,Vi))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return a(this,Vi)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":m(this,na,t);break}}onPageChanging({pageNumber:e}){m(this,ia,e-1)}focusMainContainer(){a(this,Qs).focus()}findParent(e,t){for(const s of a(this,Xt).values()){const{x:i,y:n,width:r,height:o}=s.div.getBoundingClientRect();if(e>=i&&e<=i+r&&t>=n&&t<=n+o)return s}return null}disableUserSelect(e=!1){a(this,Wo).classList.toggle("noUserSelect",e)}addShouldRescale(e){a(this,Dn).add(e)}removeShouldRescale(e){a(this,Dn).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*An.PDF_TO_CSS_UNITS;for(const s of a(this,Dn))s.onScaleChanging();(t=a(this,Hi))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:s,anchorOffset:i,focusNode:n,focusOffset:r}=t,o=t.toString(),h=y(this,N,Ih).call(this,t).closest(".textLayer"),d=this.getSelectionBoxes(h);if(!d)return;t.empty();const u=y(this,N,id).call(this,h),f=a(this,jt)===K.NONE,p=()=>{u==null||u.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:s,anchorOffset:i,focusNode:n,focusOffset:r,text:o}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(K.HIGHLIGHT,p);return}p()}addToAnnotationStorage(e){!e.isEmpty()&&a(this,Ys)&&!a(this,Ys).has(e.id)&&a(this,Ys).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,a(this,ji)&&(m(this,ji,!1),y(this,N,Ph).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of a(this,lt))if(t.div.contains(e)){m(this,Nn,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!a(this,Nn))return;const[e,t]=a(this,Nn);m(this,Nn,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){y(this,N,nd).call(this),y(this,N,rd).call(this)}removeEditListeners(){y(this,N,If).call(this),y(this,N,ad).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of a(this,ns))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of a(this,ns))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=a(this,Re))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of a(this,lt)){const n=i.serialize(!0);n&&t.push(n)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const n of t.items)for(const r of a(this,ns))if(r.isHandlingMimeForPasting(n.type)){r.paste(n,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(n){Y(`paste: "${n.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const n=[];for(const l of s){const h=await i.deserialize(l);if(!h)return;n.push(h)}const r=()=>{for(const l of n)y(this,N,od).call(this,l);y(this,N,ld).call(this,n)},o=()=>{for(const l of n)l.remove()};this.addCommands({cmd:r,undo:o,mustExec:!0})}catch(n){Y(`paste: "${n.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),a(this,jt)!==K.NONE&&!this.isEditorHandlingKeyboard&&Yr._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,a(this,ji)&&(m(this,ji,!1),y(this,N,Ph).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(y(this,N,Cf).call(this),y(this,N,rd).call(this),y(this,N,ce).call(this,{isEditing:a(this,jt)!==K.NONE,isEmpty:y(this,N,uo).call(this),hasSomethingToUndo:a(this,Xe).hasSomethingToUndo(),hasSomethingToRedo:a(this,Xe).hasSomethingToRedo(),hasSelectedEditor:!1})):(y(this,N,Rf).call(this),y(this,N,ad).call(this),y(this,N,ce).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!a(this,ns)){m(this,ns,e);for(const t of a(this,ns))y(this,N,Gs).call(this,t.defaultPropertiesToUpdate)}}getId(){return a(this,pc).id}get currentLayer(){return a(this,Xt).get(a(this,ia))}getLayer(e){return a(this,Xt).get(e)}get currentPageIndex(){return a(this,ia)}addLayer(e){a(this,Xt).set(e.pageIndex,e),a(this,Ui)?e.enable():e.disable()}removeLayer(e){a(this,Xt).delete(e.pageIndex)}async updateMode(e,t=null,s=!1){var i,n,r;if(a(this,jt)!==e&&!(a(this,Ye)&&(await a(this,Ye).promise,!a(this,Ye)))){if(m(this,Ye,Promise.withResolvers()),(i=a(this,Hi))==null||i.commitOrRemove(),m(this,jt,e),e===K.NONE){this.setEditingState(!1),y(this,N,Lf).call(this),(n=this._editorUndoBar)==null||n.hide(),a(this,Ye).resolve();return}e===K.SIGNATURE&&await((r=a(this,Vi))==null?void 0:r.loadSignatures()),this.setEditingState(!0),await y(this,N,Mf).call(this),this.unselectAll();for(const o of a(this,Xt).values())o.updateMode(e);if(!t){s&&this.addNewEditorFromKeyboard(),a(this,Ye).resolve();return}for(const o of a(this,Bt).values())o.annotationElementId===t||o.id===t?(this.setSelected(o),o.enterInEditMode()):o.unselect();a(this,Ye).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==a(this,jt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){var s;if(a(this,ns)){switch(e){case et.CREATE:this.currentLayer.addNewEditor(t);return;case et.HIGHLIGHT_DEFAULT_COLOR:(s=a(this,Fn))==null||s.updateColor(t);break;case et.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(a(this,Go)||m(this,Go,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const i of a(this,lt))i.updateParams(e,t);for(const i of a(this,ns))i.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var n;for(const r of a(this,Bt).values())r.editorType===e&&r.show(t);(((n=a(this,Go))==null?void 0:n.get(et.HIGHLIGHT_SHOW_ALL))??!0)!==t&&y(this,N,Gs).call(this,[[et.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(a(this,Uo)!==e){m(this,Uo,e);for(const t of a(this,Xt).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const s of a(this,Bt).values())s.pageIndex===e&&t.push(s);return t}getEditor(e){return a(this,Bt).get(e)}addEditor(e){a(this,Bt).set(e.id,e)}removeEditor(e){var t,s;e.div.contains(document.activeElement)&&(a(this,Ts)&&clearTimeout(a(this,Ts)),m(this,Ts,setTimeout(()=>{this.focusMainContainer(),m(this,Ts,null)},0))),a(this,Bt).delete(e.id),e.annotationElementId&&((t=a(this,Gi))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!a(this,On).has(e.annotationElementId))&&((s=a(this,Ys))==null||s.remove(e.id))}addDeletedAnnotationElement(e){a(this,On).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return a(this,On).has(e)}removeDeletedAnnotationElement(e){a(this,On).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){a(this,Re)!==e&&(m(this,Re,e),e&&y(this,N,Gs).call(this,e.propertiesToUpdate))}updateUI(e){a(this,N,Of)===e&&y(this,N,Gs).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){y(this,N,Gs).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(a(this,lt).has(e)){a(this,lt).delete(e),e.unselect(),y(this,N,ce).call(this,{hasSelectedEditor:this.hasSelection});return}a(this,lt).add(e),e.select(),y(this,N,Gs).call(this,e.propertiesToUpdate),y(this,N,ce).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=a(this,Hi))==null||t.commitOrRemove();for(const s of a(this,lt))s!==e&&s.unselect();a(this,lt).clear(),a(this,lt).add(e),e.select(),y(this,N,Gs).call(this,e.propertiesToUpdate),y(this,N,ce).call(this,{hasSelectedEditor:!0})}isSelected(e){return a(this,lt).has(e)}get firstSelectedEditor(){return a(this,lt).values().next().value}unselect(e){e.unselect(),a(this,lt).delete(e),y(this,N,ce).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return a(this,lt).size!==0}get isEnterHandled(){return a(this,lt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;a(this,Xe).undo(),y(this,N,ce).call(this,{hasSomethingToUndo:a(this,Xe).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:y(this,N,uo).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){a(this,Xe).redo(),y(this,N,ce).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:a(this,Xe).hasSomethingToRedo(),isEmpty:y(this,N,uo).call(this)})}addCommands(e){a(this,Xe).add(e),y(this,N,ce).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:y(this,N,uo).call(this)})}cleanUndoStack(e){a(this,Xe).cleanType(e)}delete(){var n;this.commitOrRemove();const e=(n=this.currentLayer)==null?void 0:n.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...a(this,lt)],s=()=>{var r;(r=this._editorUndoBar)==null||r.show(i,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},i=()=>{for(const r of t)y(this,N,od).call(this,r)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=a(this,Re))==null||e.commitOrRemove()}hasSomethingToControl(){return a(this,Re)||this.hasSelection}selectAll(){for(const e of a(this,lt))e.commit();y(this,N,ld).call(this,a(this,Bt).values())}unselectAll(){var e;if(!(a(this,Re)&&(a(this,Re).commitOrRemove(),a(this,jt)!==K.NONE))&&!((e=a(this,Hi))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of a(this,lt))t.unselect();a(this,lt).clear(),y(this,N,ce).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;a(this,Wi)[0]+=e,a(this,Wi)[1]+=t;const[i,n]=a(this,Wi),r=[...a(this,lt)],o=1e3;a(this,Rs)&&clearTimeout(a(this,Rs)),m(this,Rs,setTimeout(()=>{m(this,Rs,null),a(this,Wi)[0]=a(this,Wi)[1]=0,this.addCommands({cmd:()=>{for(const l of r)a(this,Bt).has(l.id)&&(l.translateInPage(i,n),l.translationDone())},undo:()=>{for(const l of r)a(this,Bt).has(l.id)&&(l.translateInPage(-i,-n),l.translationDone())},mustExec:!1})},o));for(const l of r)l.translateInPage(e,t),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),m(this,xs,new Map);for(const e of a(this,lt))a(this,xs).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!a(this,xs))return!1;this.disableUserSelect(!1);const e=a(this,xs);m(this,xs,null);let t=!1;for(const[{x:i,y:n,pageIndex:r},o]of e)o.newX=i,o.newY=n,o.newPageIndex=r,t||(t=i!==o.savedX||n!==o.savedY||r!==o.savedPageIndex);if(!t)return!1;const s=(i,n,r,o)=>{if(a(this,Bt).has(i.id)){const l=a(this,Xt).get(o);l?i._setParentAndPosition(l,n,r):(i.pageIndex=o,i.x=n,i.y=r)}};return this.addCommands({cmd:()=>{for(const[i,{newX:n,newY:r,newPageIndex:o}]of e)s(i,n,r,o)},undo:()=>{for(const[i,{savedX:n,savedY:r,savedPageIndex:o}]of e)s(i,n,r,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(a(this,xs))for(const s of a(this,xs).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||a(this,lt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return a(this,Re)===e}getActive(){return a(this,Re)}getMode(){return a(this,jt)}get imageManager(){return tt(this,"imageManager",new ed)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let h=0,d=t.rangeCount;h<d;h++)if(!e.contains(t.getRangeAt(h).commonAncestorContainer))return null;const{x:s,y:i,width:n,height:r}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(h,d,u,f)=>({x:(d-i)/r,y:1-(h+u-s)/n,width:f/r,height:u/n});break;case"180":o=(h,d,u,f)=>({x:1-(h+u-s)/n,y:1-(d+f-i)/r,width:u/n,height:f/r});break;case"270":o=(h,d,u,f)=>({x:1-(d+f-i)/r,y:(h-s)/n,width:f/r,height:u/n});break;default:o=(h,d,u,f)=>({x:(h-s)/n,y:(d-i)/r,width:u/n,height:f/r});break}const l=[];for(let h=0,d=t.rangeCount;h<d;h++){const u=t.getRangeAt(h);if(!u.collapsed)for(const{x:f,y:p,width:v,height:g}of u.getClientRects())v===0||g===0||l.push(o(f,p,v,g))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(a(this,sa)||m(this,sa,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=a(this,sa))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=a(this,sa))==null?void 0:i.get(e.data.id);if(!t)return;const s=a(this,Ys).getRawValue(t);s&&(a(this,jt)===K.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}setMissingCanvas(e,t,s){var n;const i=(n=a(this,Gi))==null?void 0:n.get(e);i&&(i.setCanvas(t,s),a(this,Gi).delete(e))}addMissingCanvas(e,t){(a(this,Gi)||m(this,Gi,new Map)).set(e,t)}};ta=new WeakMap,Re=new WeakMap,Bt=new WeakMap,Xt=new WeakMap,ea=new WeakMap,Ys=new WeakMap,sa=new WeakMap,Xe=new WeakMap,Bi=new WeakMap,Hi=new WeakMap,ia=new WeakMap,On=new WeakMap,xs=new WeakMap,ns=new WeakMap,Dn=new WeakMap,Ho=new WeakMap,$o=new WeakMap,na=new WeakMap,jo=new WeakMap,Ts=new WeakMap,$i=new WeakMap,ra=new WeakMap,ji=new WeakMap,Cs=new WeakMap,pc=new WeakMap,Ui=new WeakMap,Uo=new WeakMap,zi=new WeakMap,Nn=new WeakMap,Fn=new WeakMap,Gi=new WeakMap,zo=new WeakMap,jt=new WeakMap,lt=new WeakMap,Ks=new WeakMap,Vi=new WeakMap,kn=new WeakMap,Go=new WeakMap,Vo=new WeakMap,Wi=new WeakMap,Rs=new WeakMap,Qs=new WeakMap,Wo=new WeakMap,Ye=new WeakMap,N=new WeakSet,Ih=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},id=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of a(this,Xt).values())if(s.hasTextLayer(e))return s;return null},Sf=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=y(this,N,Ih).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(a(this,Cs)||m(this,Cs,new cm(this)),a(this,Cs).show(s,i,this.direction==="ltr"))},xf=function(){var n,r,o;const e=document.getSelection();if(!e||e.isCollapsed){a(this,Ks)&&((n=a(this,Cs))==null||n.hide(),m(this,Ks,null),y(this,N,ce).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===a(this,Ks))return;const i=y(this,N,Ih).call(this,e).closest(".textLayer");if(!i){a(this,Ks)&&((r=a(this,Cs))==null||r.hide(),m(this,Ks,null),y(this,N,ce).call(this,{hasSelectedText:!1}));return}if((o=a(this,Cs))==null||o.hide(),m(this,Ks,t),y(this,N,ce).call(this,{hasSelectedText:!0}),!(a(this,jt)!==K.HIGHLIGHT&&a(this,jt)!==K.NONE)&&(a(this,jt)===K.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),m(this,ji,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=a(this,jt)===K.HIGHLIGHT?y(this,N,id).call(this,i):null;l==null||l.toggleDrawing();const h=new AbortController,d=this.combinedSignal(h),u=f=>{f.type==="pointerup"&&f.button!==0||(h.abort(),l==null||l.toggleDrawing(!0),f.type==="pointerup"&&y(this,N,Ph).call(this,"main_toolbar"))};window.addEventListener("pointerup",u,{signal:d}),window.addEventListener("blur",u,{signal:d})}},Ph=function(e=""){a(this,jt)===K.HIGHLIGHT?this.highlightSelection(e):a(this,Ho)&&y(this,N,Sf).call(this)},Tf=function(){document.addEventListener("selectionchange",y(this,N,xf).bind(this),{signal:this._signal})},Cf=function(){if(a(this,$i))return;m(this,$i,new AbortController);const e=this.combinedSignal(a(this,$i));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},Rf=function(){var e;(e=a(this,$i))==null||e.abort(),m(this,$i,null)},nd=function(){if(a(this,zi))return;m(this,zi,new AbortController);const e=this.combinedSignal(a(this,zi));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},If=function(){var e;(e=a(this,zi))==null||e.abort(),m(this,zi,null)},rd=function(){if(a(this,Bi))return;m(this,Bi,new AbortController);const e=this.combinedSignal(a(this,Bi));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},ad=function(){var e;(e=a(this,Bi))==null||e.abort(),m(this,Bi,null)},Pf=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},ce=function(e){Object.entries(e).some(([s,i])=>a(this,Vo)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(a(this,Vo),e)}),a(this,jt)===K.HIGHLIGHT&&e.hasSelectedEditor===!1&&y(this,N,Gs).call(this,[[et.HIGHLIGHT_FREE,!0]]))},Gs=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},Mf=async function(){if(!a(this,Ui)){m(this,Ui,!0);const e=[];for(const t of a(this,Xt).values())e.push(t.enable());await Promise.all(e);for(const t of a(this,Bt).values())t.enable()}},Lf=function(){if(this.unselectAll(),a(this,Ui)){m(this,Ui,!1);for(const e of a(this,Xt).values())e.disable();for(const e of a(this,Bt).values())e.disable()}},od=function(e){const t=a(this,Xt).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},Of=function(){let e=null;for(e of a(this,lt));return e},uo=function(){if(a(this,Bt).size===0)return!0;if(a(this,Bt).size===1)for(const e of a(this,Bt).values())return e.isEmpty();return!1},ld=function(e){for(const t of a(this,lt))t.unselect();a(this,lt).clear();for(const t of e)t.isEmpty()||(a(this,lt).add(t),t.select());y(this,N,ce).call(this,{hasSelectedEditor:this.hasSelection})},O(Yr,"TRANSLATE_SMALL",1),O(Yr,"TRANSLATE_BIG",10);let kr=Yr;var Ut,Is,rs,aa,Ps,Ie,oa,Ms,Ee,Js,_n,Ls,Xi,vs,fo,Mh;const de=class de{constructor(e){b(this,vs);b(this,Ut,null);b(this,Is,!1);b(this,rs,null);b(this,aa,null);b(this,Ps,null);b(this,Ie,null);b(this,oa,!1);b(this,Ms,null);b(this,Ee,null);b(this,Js,null);b(this,_n,null);b(this,Ls,!1);m(this,Ee,e),m(this,Ls,e._uiManager.useNewAltTextFlow),a(de,Xi)||m(de,Xi,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){de._l10n??(de._l10n=e)}async render(){const e=m(this,rs,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=m(this,aa,document.createElement("span"));e.append(t),a(this,Ls)?(e.classList.add("new"),e.setAttribute("data-l10n-id",a(de,Xi).missing),t.setAttribute("data-l10n-id",a(de,Xi)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=a(this,Ee)._uiManager._signal;e.addEventListener("contextmenu",bs,{signal:s}),e.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),a(this,Ee)._uiManager.editAltText(a(this,Ee)),a(this,Ls)&&a(this,Ee)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:a(this,vs,fo)}})};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",n=>{n.target===e&&n.key==="Enter"&&(m(this,oa,!0),i(n))},{signal:s}),await y(this,vs,Mh).call(this),e}finish(){a(this,rs)&&(a(this,rs).focus({focusVisible:a(this,oa)}),m(this,oa,!1))}isEmpty(){return a(this,Ls)?a(this,Ut)===null:!a(this,Ut)&&!a(this,Is)}hasData(){return a(this,Ls)?a(this,Ut)!==null||!!a(this,Js):this.isEmpty()}get guessedText(){return a(this,Js)}async setGuessedText(e){a(this,Ut)===null&&(m(this,Js,e),m(this,_n,await de._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),y(this,vs,Mh).call(this))}toggleAltTextBadge(e=!1){var t;if(!a(this,Ls)||a(this,Ut)){(t=a(this,Ms))==null||t.remove(),m(this,Ms,null);return}if(!a(this,Ms)){const s=m(this,Ms,document.createElement("div"));s.className="noAltTextBadge",a(this,Ee).div.append(s)}a(this,Ms).classList.toggle("hidden",!e)}serialize(e){let t=a(this,Ut);return!e&&a(this,Js)===t&&(t=a(this,_n)),{altText:t,decorative:a(this,Is),guessedText:a(this,Js),textWithDisclaimer:a(this,_n)}}get data(){return{altText:a(this,Ut),decorative:a(this,Is)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:i,cancel:n=!1}){s&&(m(this,Js,s),m(this,_n,i)),!(a(this,Ut)===e&&a(this,Is)===t)&&(n||(m(this,Ut,e),m(this,Is,t)),y(this,vs,Mh).call(this))}toggle(e=!1){a(this,rs)&&(!e&&a(this,Ie)&&(clearTimeout(a(this,Ie)),m(this,Ie,null)),a(this,rs).disabled=!e)}shown(){a(this,Ee)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:a(this,vs,fo)}})}destroy(){var e,t;(e=a(this,rs))==null||e.remove(),m(this,rs,null),m(this,aa,null),m(this,Ps,null),(t=a(this,Ms))==null||t.remove(),m(this,Ms,null)}};Ut=new WeakMap,Is=new WeakMap,rs=new WeakMap,aa=new WeakMap,Ps=new WeakMap,Ie=new WeakMap,oa=new WeakMap,Ms=new WeakMap,Ee=new WeakMap,Js=new WeakMap,_n=new WeakMap,Ls=new WeakMap,Xi=new WeakMap,vs=new WeakSet,fo=function(){return a(this,Ut)&&"added"||a(this,Ut)===null&&this.guessedText&&"review"||"missing"},Mh=async function(){var i,n,r;const e=a(this,rs);if(!e)return;if(a(this,Ls)){if(e.classList.toggle("done",!!a(this,Ut)),e.setAttribute("data-l10n-id",a(de,Xi)[a(this,vs,fo)]),(i=a(this,aa))==null||i.setAttribute("data-l10n-id",a(de,Xi)[`${a(this,vs,fo)}-label`]),!a(this,Ut)){(n=a(this,Ps))==null||n.remove();return}}else{if(!a(this,Ut)&&!a(this,Is)){e.classList.remove("done"),(r=a(this,Ps))==null||r.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=a(this,Ps);if(!t){m(this,Ps,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${a(this,Ee).id}`;const o=100,l=a(this,Ee)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(a(this,Ie)),m(this,Ie,null)},{once:!0}),e.addEventListener("mouseenter",()=>{m(this,Ie,setTimeout(()=>{m(this,Ie,null),a(this,Ps).classList.add("show"),a(this,Ee)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),e.addEventListener("mouseleave",()=>{var h;a(this,Ie)&&(clearTimeout(a(this,Ie)),m(this,Ie,null)),(h=a(this,Ps))==null||h.classList.remove("show")},{signal:l})}a(this,Is)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=a(this,Ut)),t.parentNode||e.append(t);const s=a(this,Ee).getElementForAltText();s==null||s.setAttribute("aria-describedby",t.id)},b(de,Xi,null),O(de,"_l10n",null);let ic=de;var la,Bn,Xo,Yo,Ko,Qo,Jo,Zs,Hn,qs,$n,ti,En,Df,Nf,Ff;const Lu=class Lu{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:n=null,onPinchEnd:r=null,signal:o}){b(this,En);b(this,la);b(this,Bn,!1);b(this,Xo,null);b(this,Yo);b(this,Ko);b(this,Qo);b(this,Jo);b(this,Zs,null);b(this,Hn);b(this,qs,null);b(this,$n);b(this,ti,null);m(this,la,e),m(this,Xo,s),m(this,Yo,t),m(this,Ko,i),m(this,Qo,n),m(this,Jo,r),m(this,$n,new AbortController),m(this,Hn,AbortSignal.any([o,a(this,$n).signal])),e.addEventListener("touchstart",y(this,En,Df).bind(this),{passive:!1,signal:a(this,Hn)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/js.pixelRatio}destroy(){var e,t;(e=a(this,$n))==null||e.abort(),m(this,$n,null),(t=a(this,Zs))==null||t.abort(),m(this,Zs,null)}};la=new WeakMap,Bn=new WeakMap,Xo=new WeakMap,Yo=new WeakMap,Ko=new WeakMap,Qo=new WeakMap,Jo=new WeakMap,Zs=new WeakMap,Hn=new WeakMap,qs=new WeakMap,$n=new WeakMap,ti=new WeakMap,En=new WeakSet,Df=function(e){var i,n,r;if((i=a(this,Yo))!=null&&i.call(this))return;if(e.touches.length===1){if(a(this,Zs))return;const o=m(this,Zs,new AbortController),l=AbortSignal.any([a(this,Hn),o.signal]),h=a(this,la),d={capture:!0,signal:l,passive:!1},u=f=>{var p;f.pointerType==="touch"&&((p=a(this,Zs))==null||p.abort(),m(this,Zs,null))};h.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(Dt(f),u(f))},d),h.addEventListener("pointerup",u,d),h.addEventListener("pointercancel",u,d);return}if(!a(this,ti)){m(this,ti,new AbortController);const o=AbortSignal.any([a(this,Hn),a(this,ti).signal]),l=a(this,la),h={signal:o,capture:!1,passive:!1};l.addEventListener("touchmove",y(this,En,Nf).bind(this),h);const d=y(this,En,Ff).bind(this);l.addEventListener("touchend",d,h),l.addEventListener("touchcancel",d,h),h.capture=!0,l.addEventListener("pointerdown",Dt,h),l.addEventListener("pointermove",Dt,h),l.addEventListener("pointercancel",Dt,h),l.addEventListener("pointerup",Dt,h),(n=a(this,Ko))==null||n.call(this)}if(Dt(e),e.touches.length!==2||(r=a(this,Xo))!=null&&r.call(this)){m(this,qs,null);return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),m(this,qs,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY})},Nf=function(e){var T;if(!a(this,qs)||e.touches.length!==2)return;Dt(e);let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:i,screenY:n}=t,{screenX:r,screenY:o}=s,l=a(this,qs),{touch0X:h,touch0Y:d,touch1X:u,touch1Y:f}=l,p=u-h,v=f-d,g=r-i,A=o-n,w=Math.hypot(g,A)||1,S=Math.hypot(p,v)||1;if(!a(this,Bn)&&Math.abs(S-w)<=Lu.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=n,l.touch1X=r,l.touch1Y=o,!a(this,Bn)){m(this,Bn,!0);return}const E=[(i+r)/2,(n+o)/2];(T=a(this,Qo))==null||T.call(this,E,S,w)},Ff=function(e){var t;e.touches.length>=2||(a(this,ti)&&(a(this,ti).abort(),m(this,ti,null),(t=a(this,Jo))==null||t.call(this)),a(this,qs)&&(Dt(e),m(this,qs,null),m(this,Bn,!1)))};let nc=Lu;var jn,as,yt,ha,Yi,Zo,Un,Yt,zn,ei,Ki,qo,Gn,Pe,tl,Vn,si,Os,ca,da,Ke,Wn,el,gc,X,hd,sl,cd,Lh,kf,_f,dd,Oh,ud,Bf,Hf,$f,fd,jf,pd,Uf,zf,Gf,gd,po;const J=class J{constructor(e){b(this,X);b(this,jn,null);b(this,as,null);b(this,yt,null);b(this,ha,!1);b(this,Yi,null);b(this,Zo,"");b(this,Un,!1);b(this,Yt,null);b(this,zn,null);b(this,ei,null);b(this,Ki,null);b(this,qo,"");b(this,Gn,!1);b(this,Pe,null);b(this,tl,!1);b(this,Vn,!1);b(this,si,!1);b(this,Os,null);b(this,ca,0);b(this,da,0);b(this,Ke,null);b(this,Wn,null);O(this,"isSelected",!1);O(this,"_isCopy",!1);O(this,"_editToolbar",null);O(this,"_initialOptions",Object.create(null));O(this,"_initialData",null);O(this,"_isVisible",!0);O(this,"_uiManager",null);O(this,"_focusEventsAllowed",!0);b(this,el,!1);b(this,gc,J._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[n,r];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=J.prototype._resizeWithKeyboard,t=kr.TRANSLATE_SMALL,s=kr.TRANSLATE_BIG;return tt(this,"_resizerKeyboardManager",new hh([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],J.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return tt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new fm({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(J._l10n??(J._l10n=e),J._l10nResizer||(J._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),J._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);J._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){dt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return a(this,el)}set _isDraggable(e){var t;m(this,el,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=a(this,gc)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):y(this,X,po).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(a(this,Gn)?m(this,Gn,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,i){const[n,r]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(e+s)/n,this.y=(t+i)/r,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[s,i]=this.parentDimensions;this.setAt(e*s,t*i,this.width*s,this.height*i),this._onTranslated()}translate(e,t){y(this,X,hd).call(this,this.parentDimensions,e,t)}translateInPage(e,t){a(this,Pe)||m(this,Pe,[this.x,this.y,this.width,this.height]),y(this,X,hd).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){a(this,Pe)||m(this,Pe,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,n]}=this;if(this.x+=e/i,this.y+=t/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:u,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:o}=this;const[l,h]=this.getBaseTranslation();r+=l,o+=h;const{style:d}=s;d.left=`${(100*r).toFixed(2)}%`,d.top=`${(100*o).toFixed(2)}%`,this._onTranslating(r,o),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!a(this,Pe)&&(a(this,Pe)[0]!==this.x||a(this,Pe)[1]!==this.y)}get _hasBeenResized(){return!!a(this,Pe)&&(a(this,Pe)[2]!==this.width||a(this,Pe)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=J,i=s/e,n=s/t;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,i]}=this;let{x:n,y:r,width:o,height:l}=this;if(o*=s,l*=i,n*=s,r*=i,this._mustFixPosition)switch(e){case 0:n=me(n,0,s-o),r=me(r,0,i-l);break;case 90:n=me(n,0,s-l),r=me(r,o,i);break;case 180:n=me(n,o,s),r=me(r,l,i);break;case 270:n=me(n,l,s),r=me(r,0,i-o);break}this.x=n/=s,this.y=r/=i;const[h,d]=this.getBaseTranslation();n+=h,r+=d,t.left=`${(100*n).toFixed(2)}%`,t.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return y(s=J,sl,cd).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return y(s=J,sl,cd).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(e,t){const[s,i]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*e/s).toFixed(2)}%`,a(this,Un)||(n.height=`${(100*t/i).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:s}=e,i=s.endsWith("%"),n=!a(this,Un)&&t.endsWith("%");if(i&&n)return;const[r,o]=this.parentDimensions;i||(e.width=`${(100*parseFloat(s)/r).toFixed(2)}%`),!a(this,Un)&&!n&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=a(this,yt))==null||e.finish()}async addEditToolbar(){return this._editToolbar||a(this,Vn)?this._editToolbar:(this._editToolbar=new td(this),this.div.append(this._editToolbar.render()),a(this,yt)&&await this._editToolbar.addAltText(a(this,yt)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=a(this,yt))==null||e.destroy())}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){a(this,yt)||(ic.initialize(J._l10n),m(this,yt,new ic(this)),a(this,jn)&&(a(this,yt).data=a(this,jn),m(this,jn,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=a(this,yt))==null?void 0:e.data}set altTextData(e){a(this,yt)&&(a(this,yt).data=e)}get guessedAltText(){var e;return(e=a(this,yt))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=a(this,yt))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=a(this,yt))==null?void 0:t.serialize(e)}hasAltText(){return!!a(this,yt)&&!a(this,yt).isEmpty()}hasAltTextData(){var e;return((e=a(this,yt))==null?void 0:e.hasData())??!1}render(){var r;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=a(this,ha)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),y(this,X,pd).call(this);const[t,s]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*s/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/s).toFixed(2)}%`);const[i,n]=this.getInitialTranslation();return this.translate(i,n),wf(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(a(this,Wn)||m(this,Wn,new nc({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:y(this,X,Bf).bind(this),onPinching:y(this,X,Hf).bind(this),onPinchEnd:y(this,X,$f).bind(this),signal:this._uiManager._signal}))),(r=this._uiManager._editorUndoBar)==null||r.hide(),e}pointerdown(e){const{isMac:t}=ee.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(m(this,Gn,!0),this._isDraggable){y(this,X,jf).call(this,e);return}y(this,X,fd).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){a(this,Os)&&clearTimeout(a(this,Os)),m(this,Os,setTimeout(()=>{var e;m(this,Os,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const i=this.parentScale,[n,r]=this.pageDimensions,[o,l]=this.pageTranslation,h=e/i,d=t/i,u=this.x*n,f=this.y*r,p=this.width*n,v=this.height*r;switch(s){case 0:return[u+h+o,r-f-d-v+l,u+h+p+o,r-f-d+l];case 90:return[u+d+o,r-f+h+l,u+d+v+o,r-f+h+p+l];case 180:return[u-h-p+o,r-f+d+l,u-h+o,r-f+d+v+l];case 270:return[u-d-v+o,r-f-h-p+l,u-d+o,r-f-h+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,i,n,r]=e,o=n-s,l=r-i;switch(this.rotation){case 0:return[s,t-r,o,l];case 90:return[s,t-i,l,o];case 180:return[n,t-i,o,l];case 270:return[n,t-r,l,o];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),m(this,Vn,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),m(this,Vn,!1),!0):!1}isInEditMode(){return a(this,Vn)}shouldGetKeyboardEvents(){return a(this,si)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:n,innerWidth:r}=window;return t<r&&i>0&&e<n&&s>0}rebuild(){y(this,X,pd).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){dt("An editor must be serializable")}static async deserialize(e,t,s){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s});i.rotation=e.rotation,m(i,jn,e.accessibilityData),i._isCopy=e.isCopy||!1;const[n,r]=i.pageDimensions,[o,l,h,d]=i.getRectInCurrentCoords(e.rect,r);return i.x=o/n,i.y=l/r,i.width=h/n,i.height=d/r,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=a(this,Ki))==null||e.abort(),m(this,Ki,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),a(this,Os)&&(clearTimeout(a(this,Os)),m(this,Os,null)),y(this,X,po).call(this),this.removeEditToolbar(),a(this,Ke)){for(const s of a(this,Ke).values())clearTimeout(s);m(this,Ke,null)}this.parent=null,(t=a(this,Wn))==null||t.destroy(),m(this,Wn,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(y(this,X,kf).call(this),a(this,Yt).classList.remove("hidden"))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),m(this,ei,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=a(this,Yt).children;if(!a(this,as)){m(this,as,Array.from(t));const r=y(this,X,Uf).bind(this),o=y(this,X,zf).bind(this),l=this._uiManager._signal;for(const h of a(this,as)){const d=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",r,{signal:l}),h.addEventListener("blur",o,{signal:l}),h.addEventListener("focus",y(this,X,Gf).bind(this,d),{signal:l}),h.setAttribute("data-l10n-id",J._l10nResizer[d])}}const s=a(this,as)[0];let i=0;for(const r of t){if(r===s)break;i++}const n=(360-this.rotation+this.parentRotation)%360/90*(a(this,as).length/4);if(n!==i){if(n<i)for(let o=0;o<i-n;o++)a(this,Yt).append(a(this,Yt).firstChild);else if(n>i)for(let o=0;o<n-i;o++)a(this,Yt).firstChild.before(a(this,Yt).lastChild);let r=0;for(const o of t){const h=a(this,as)[r++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",J._l10nResizer[h])}}y(this,X,gd).call(this,0),m(this,si,!0),a(this,Yt).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){a(this,si)&&y(this,X,ud).call(this,a(this,qo),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){y(this,X,po).call(this),this.div.focus()}select(){var e,t,s;if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,n;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((n=this._editToolbar)==null||n.show())});return}(t=this._editToolbar)==null||t.show(),(s=a(this,yt))==null||s.toggleAltTextBadge(!1)}}unselect(){var e,t,s,i,n;this.isSelected&&(this.isSelected=!1,(e=a(this,Yt))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(n=a(this,yt))==null||n.toggleAltTextBadge(!0))}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return a(this,tl)}set isEditing(e){m(this,tl,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){m(this,Un,!0);const s=e/t,{style:i}=this.div;i.aspectRatio=s,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){a(this,Ke)||m(this,Ke,new Map);const{action:s}=e;let i=a(this,Ke).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),a(this,Ke).delete(s),a(this,Ke).size===0&&m(this,Ke,null)},J._telemetryTimeout),a(this,Ke).set(s,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),m(this,ha,!1)}disable(){this.div&&(this.div.tabIndex=-1),m(this,ha,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};jn=new WeakMap,as=new WeakMap,yt=new WeakMap,ha=new WeakMap,Yi=new WeakMap,Zo=new WeakMap,Un=new WeakMap,Yt=new WeakMap,zn=new WeakMap,ei=new WeakMap,Ki=new WeakMap,qo=new WeakMap,Gn=new WeakMap,Pe=new WeakMap,tl=new WeakMap,Vn=new WeakMap,si=new WeakMap,Os=new WeakMap,ca=new WeakMap,da=new WeakMap,Ke=new WeakMap,Wn=new WeakMap,el=new WeakMap,gc=new WeakMap,X=new WeakSet,hd=function([e,t],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},sl=new WeakSet,cd=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},Lh=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},kf=function(){if(a(this,Yt))return;m(this,Yt,document.createElement("div")),a(this,Yt).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const i=document.createElement("div");a(this,Yt).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",y(this,X,_f).bind(this,s),{signal:t}),i.addEventListener("contextmenu",bs,{signal:t}),i.tabIndex=-1}this.div.prepend(a(this,Yt))},_f=function(e,t){var d;t.preventDefault();const{isMac:s}=ee.platform;if(t.button!==0||t.ctrlKey&&s)return;(d=a(this,yt))==null||d.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,m(this,zn,[t.screenX,t.screenY]);const n=new AbortController,r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",y(this,X,ud).bind(this,e),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",Dt,{passive:!1,signal:r}),window.addEventListener("contextmenu",bs,{signal:r}),m(this,ei,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const h=()=>{var u;n.abort(),this.parent.togglePointerEvents(!0),(u=a(this,yt))==null||u.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=o,this.div.style.cursor=l,y(this,X,Oh).call(this)};window.addEventListener("pointerup",h,{signal:r}),window.addEventListener("blur",h,{signal:r})},dd=function(e,t,s,i){this.width=s,this.height=i,this.x=e,this.y=t;const[n,r]=this.parentDimensions;this.setDims(n*s,r*i),this.fixAndSetPosition(),this._onResized()},Oh=function(){if(!a(this,ei))return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:i}=a(this,ei);m(this,ei,null);const n=this.x,r=this.y,o=this.width,l=this.height;n===e&&r===t&&o===s&&l===i||this.addCommands({cmd:y(this,X,dd).bind(this,n,r,o,l),undo:y(this,X,dd).bind(this,e,t,s,i),mustExec:!0})},ud=function(e,t){const[s,i]=this.parentDimensions,n=this.x,r=this.y,o=this.width,l=this.height,h=J.MIN_SIZE/s,d=J.MIN_SIZE/i,u=y(this,X,Lh).call(this,this.rotation),f=(F,k)=>[u[0]*F+u[2]*k,u[1]*F+u[3]*k],p=y(this,X,Lh).call(this,360-this.rotation),v=(F,k)=>[p[0]*F+p[2]*k,p[1]*F+p[3]*k];let g,A,w=!1,S=!1;switch(e){case"topLeft":w=!0,g=(F,k)=>[0,0],A=(F,k)=>[F,k];break;case"topMiddle":g=(F,k)=>[F/2,0],A=(F,k)=>[F/2,k];break;case"topRight":w=!0,g=(F,k)=>[F,0],A=(F,k)=>[0,k];break;case"middleRight":S=!0,g=(F,k)=>[F,k/2],A=(F,k)=>[0,k/2];break;case"bottomRight":w=!0,g=(F,k)=>[F,k],A=(F,k)=>[0,0];break;case"bottomMiddle":g=(F,k)=>[F/2,k],A=(F,k)=>[F/2,0];break;case"bottomLeft":w=!0,g=(F,k)=>[0,k],A=(F,k)=>[F,0];break;case"middleLeft":S=!0,g=(F,k)=>[0,k/2],A=(F,k)=>[F,k/2];break}const E=g(o,l),T=A(o,l);let x=f(...T);const C=J._round(n+x[0]),R=J._round(r+x[1]);let I=1,P=1,M,D;if(t.fromKeyboard)({deltaX:M,deltaY:D}=t);else{const{screenX:F,screenY:k}=t,[at,le]=a(this,zn);[M,D]=this.screenToPageTranslation(F-at,k-le),a(this,zn)[0]=F,a(this,zn)[1]=k}if([M,D]=v(M/s,D/i),w){const F=Math.hypot(o,l);I=P=Math.max(Math.min(Math.hypot(T[0]-E[0]-M,T[1]-E[1]-D)/F,1/o,1/l),h/o,d/l)}else S?I=me(Math.abs(T[0]-E[0]-M),h,1)/o:P=me(Math.abs(T[1]-E[1]-D),d,1)/l;const G=J._round(o*I),U=J._round(l*P);x=f(...A(G,U));const W=C-x[0],pt=R-x[1];a(this,Pe)||m(this,Pe,[this.x,this.y,this.width,this.height]),this.width=G,this.height=U,this.x=W,this.y=pt,this.setDims(s*G,i*U),this.fixAndSetPosition(),this._onResizing()},Bf=function(){var e;m(this,ei,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=a(this,yt))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},Hf=function(e,t,s){let n=.7*(s/t)+1-.7;if(n===1)return;const r=y(this,X,Lh).call(this,this.rotation),o=(C,R)=>[r[0]*C+r[2]*R,r[1]*C+r[3]*R],[l,h]=this.parentDimensions,d=this.x,u=this.y,f=this.width,p=this.height,v=J.MIN_SIZE/l,g=J.MIN_SIZE/h;n=Math.max(Math.min(n,1/f,1/p),v/f,g/p);const A=J._round(f*n),w=J._round(p*n);if(A===f&&w===p)return;a(this,Pe)||m(this,Pe,[d,u,f,p]);const S=o(f/2,p/2),E=J._round(d+S[0]),T=J._round(u+S[1]),x=o(A/2,w/2);this.x=E-x[0],this.y=T-x[1],this.width=A,this.height=w,this.setDims(l*A,h*w),this.fixAndSetPosition(),this._onResizing()},$f=function(){var e;(e=a(this,yt))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),y(this,X,Oh).call(this)},fd=function(e){const{isMac:t}=ee.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},jf=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,n=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:n},o=h=>{i.abort(),m(this,Yi,null),m(this,Gn,!1),this._uiManager.endDragSession()||y(this,X,fd).call(this,h),s&&this._onStopDragging()};t&&(m(this,ca,e.clientX),m(this,da,e.clientY),m(this,Yi,e.pointerId),m(this,Zo,e.pointerType),window.addEventListener("pointermove",h=>{s||(s=!0,this._onStartDragging());const{clientX:d,clientY:u,pointerId:f}=h;if(f!==a(this,Yi)){Dt(h);return}const[p,v]=this.screenToPageTranslation(d-a(this,ca),u-a(this,da));m(this,ca,d),m(this,da,u),this._uiManager.dragSelectedEditors(p,v)},r),window.addEventListener("touchmove",Dt,r),window.addEventListener("pointerdown",h=>{h.pointerType===a(this,Zo)&&(a(this,Wn)||h.isPrimary)&&o(h),Dt(h)},r));const l=h=>{if(!a(this,Yi)||a(this,Yi)===h.pointerId){o(h);return}Dt(h)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})},pd=function(){if(a(this,Ki)||!this.div)return;m(this,Ki,new AbortController);const e=this._uiManager.combinedSignal(a(this,Ki));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},Uf=function(e){J._resizerKeyboardManager.exec(this,e)},zf=function(e){var t;a(this,si)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==a(this,Yt)&&y(this,X,po).call(this)},Gf=function(e){m(this,qo,a(this,si)?e:"")},gd=function(e){if(a(this,as))for(const t of a(this,as))t.tabIndex=e},po=function(){m(this,si,!1),y(this,X,gd).call(this,-1),y(this,X,Oh).call(this)},b(J,sl),O(J,"_l10n",null),O(J,"_l10nResizer",null),O(J,"_borderLineWidth",-1),O(J,"_colorManager",new sd),O(J,"_zIndex",1),O(J,"_telemetryTimeout",1e3);let mt=J;class fm extends mt{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Uu=3285377520,Ve=4294901760,Es=65535;class Vf{constructor(e){this.h1=e?e&4294967295:Uu,this.h2=e?e&4294967295:Uu}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let g=0,A=e.length;g<A;g++){const w=e.charCodeAt(g);w<=255?t[s++]=w:(t[s++]=w>>>8,t[s++]=w&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,n=s-i*4,r=new Uint32Array(t.buffer,0,i);let o=0,l=0,h=this.h1,d=this.h2;const u=3432918353,f=461845907,p=u&Es,v=f&Es;for(let g=0;g<i;g++)g&1?(o=r[g],o=o*u&Ve|o*p&Es,o=o<<15|o>>>17,o=o*f&Ve|o*v&Es,h^=o,h=h<<13|h>>>19,h=h*5+3864292196):(l=r[g],l=l*u&Ve|l*p&Es,l=l<<15|l>>>17,l=l*f&Ve|l*v&Es,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(o=0,n){case 3:o^=t[i*4+2]<<16;case 2:o^=t[i*4+1]<<8;case 1:o^=t[i*4],o=o*u&Ve|o*p&Es,o=o<<15|o>>>17,o=o*f&Ve|o*v&Es,i&1?h^=o:d^=o}this.h1=h,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Ve|e*36045&Es,t=t*4283543511&Ve|((t<<16|e>>>16)*2950163797&Ve)>>>16,e^=t>>>1,e=e*444984403&Ve|e*60499&Es,t=t*3301882366&Ve|((t<<16|e>>>16)*3120437893&Ve)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const md=Object.freeze({map:null,hash:"",transfer:void 0});var Xn,Yn,Kt,mc,Wf;class xu{constructor(){b(this,mc);b(this,Xn,!1);b(this,Yn,null);b(this,Kt,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=a(this,Kt).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return a(this,Kt).get(e)}remove(e){if(a(this,Kt).delete(e),a(this,Kt).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of a(this,Kt).values())if(t instanceof mt)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=a(this,Kt).get(e);let i=!1;if(s!==void 0)for(const[n,r]of Object.entries(t))s[n]!==r&&(i=!0,s[n]=r);else i=!0,a(this,Kt).set(e,t);i&&y(this,mc,Wf).call(this),t instanceof mt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return a(this,Kt).has(e)}get size(){return a(this,Kt).size}resetModified(){a(this,Xn)&&(m(this,Xn,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Xf(this)}get serializable(){if(a(this,Kt).size===0)return md;const e=new Map,t=new Vf,s=[],i=Object.create(null);let n=!1;for(const[r,o]of a(this,Kt)){const l=o instanceof mt?o.serialize(!1,i):o;l&&(e.set(r,l),t.update(`${r}:${JSON.stringify(l)}`),n||(n=!!l.bitmap))}if(n)for(const r of e.values())r.bitmap&&s.push(r.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:md}get editorStats(){let e=null;const t=new Map;for(const s of a(this,Kt).values()){if(!(s instanceof mt))continue;const i=s.telemetryFinalData;if(!i)continue;const{type:n}=i;t.has(n)||t.set(n,Object.getPrototypeOf(s).constructor),e||(e=Object.create(null));const r=e[n]||(e[n]=new Map);for(const[o,l]of Object.entries(i)){if(o==="type")continue;let h=r.get(o);h||(h=new Map,r.set(o,h));const d=h.get(l)??0;h.set(l,d+1)}}for(const[s,i]of t)e[s]=i.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){m(this,Yn,null)}get modifiedIds(){if(a(this,Yn))return a(this,Yn);const e=[];for(const t of a(this,Kt).values())!(t instanceof mt)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return m(this,Yn,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return a(this,Kt).entries()}}Xn=new WeakMap,Yn=new WeakMap,Kt=new WeakMap,mc=new WeakSet,Wf=function(){a(this,Xn)||(m(this,Xn,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var il;class Xf extends xu{constructor(t){super();b(this,il);const{map:s,hash:i,transfer:n}=t.serializable,r=structuredClone(s,n?{transfer:n}:null);m(this,il,{map:r,hash:i,transfer:n})}get print(){dt("Should not call PrintAnnotationStorage.print")}get serializable(){return a(this,il)}get modifiedIds(){return tt(this,"modifiedIds",{ids:new Set,hash:""})}}il=new WeakMap;var ua;class pm{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){b(this,ua,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),a(this,ua).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:s}){if(!(!e||a(this,ua).has(e.loadedName))){if(Nt(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:n,style:r}=e,o=new FontFace(i,n,r);this.addNativeFontFace(o);try{await o.load(),a(this,ua).add(i),s==null||s(e)}catch{Y(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}dt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw Y(`Failed to load font '${s.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return tt(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return tt(this,"isSyncFontLoadingSupported",ge||ee.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(Nt(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const n=s.shift();setTimeout(n.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:t,callback:e};return s.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return tt(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(T,x){return T.charCodeAt(x)<<24|T.charCodeAt(x+1)<<16|T.charCodeAt(x+2)<<8|T.charCodeAt(x+3)&255}function i(T,x,C,R){const I=T.substring(0,x),P=T.substring(x+C);return I+R+P}let n,r;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let h=0;function d(T,x){if(++h>30){Y("Load test font never loaded."),x();return}if(l.font="30px "+T,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){x();return}setTimeout(d.bind(null,T,x))}const u=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,u.length,u);const v=16,g=1482184792;let A=s(f,v);for(n=0,r=u.length-3;n<r;n+=4)A=A-g+s(u,n)|0;n<u.length&&(A=A-g+s(u+"XXX",n)|0),f=i(f,v,4,Zg(A));const w=`url(data:font/opentype;base64,${btoa(f)});`,S=`@font-face {font-family:"${u}";src:${w}}`;this.insertRule(S);const E=this._document.createElement("div");E.style.visibility="hidden",E.style.width=E.style.height="10px",E.style.position="absolute",E.style.top=E.style.left="0px";for(const T of[e.loadedName,u]){const x=this._document.createElement("span");x.textContent="Hi",x.style.fontFamily=T,E.append(x)}this._document.body.append(E),d(u,()=>{E.remove(),t.complete()})}}ua=new WeakMap;class gm{constructor(e,t=null){this.compiledGlyphs=Object.create(null);for(const s in e)this[s]=e[s];this._inspectFont=t}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${ff(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let i;try{i=e.get(s)}catch(r){Y(`getPathGenerator - ignoring character: "${r}".`)}const n=new Path2D(i||"");return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=n}}function mm(c){if(c instanceof URL)return c.href;if(typeof c=="string"){if(ge)return c;const e=URL.parse(c,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function vm(c){if(ge&&typeof Buffer<"u"&&c instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(c instanceof Uint8Array&&c.byteLength===c.buffer.byteLength)return c;if(typeof c=="string")return ah(c);if(c instanceof ArrayBuffer||ArrayBuffer.isView(c)||typeof c=="object"&&!isNaN(c==null?void 0:c.length))return new Uint8Array(c);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function vh(c){if(typeof c!="string")return null;if(c.endsWith("/"))return c;throw new Error(`Invalid factory url: "${c}" must include trailing slash.`)}const vd=c=>typeof c=="object"&&Number.isInteger(c==null?void 0:c.num)&&c.num>=0&&Number.isInteger(c==null?void 0:c.gen)&&c.gen>=0,bm=c=>typeof c=="object"&&typeof(c==null?void 0:c.name)=="string",ym=im.bind(null,vd,bm);var ii,vc;class Am{constructor(){b(this,ii,new Map);b(this,vc,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};a(this,vc).then(()=>{for(const[i]of a(this,ii))i.call(this,s)})}addEventListener(e,t,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:n}=s;if(n.aborted){Y("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(e,t);i=()=>n.removeEventListener("abort",r),n.addEventListener("abort",r)}a(this,ii).set(t,i)}removeEventListener(e,t){const s=a(this,ii).get(t);s==null||s(),a(this,ii).delete(t)}terminate(){for(const[,e]of a(this,ii))e==null||e();a(this,ii).clear()}}ii=new WeakMap,vc=new WeakMap;const bh={DATA:1,ERROR:2},Lt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function zu(){}function Ae(c){if(c instanceof yn||c instanceof Jc||c instanceof Hu||c instanceof sc||c instanceof Hc)return c;switch(c instanceof Error||typeof c=="object"&&c!==null||dt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),c.name){case"AbortException":return new yn(c.message);case"InvalidPDFException":return new Jc(c.message);case"PasswordException":return new Hu(c.message,c.code);case"ResponseException":return new sc(c.message,c.status,c.missing);case"UnknownErrorException":return new Hc(c.message,c.details)}return new Hc(c.message,c.toString())}var fa,es,Yf,Kf,Qf,Dh;class go{constructor(e,t,s){b(this,es);b(this,fa,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",y(this,es,Yf).bind(this),{signal:a(this,fa).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const i=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},s)}catch(r){n.reject(r)}return n.promise}sendWithStream(e,t,s,i){const n=this.streamId++,r=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:h=>{const d=Promise.withResolvers();return this.streamControllers[n]={controller:h,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:o,action:e,streamId:n,data:t,desiredSize:h.desiredSize},i),d.promise},pull:h=>{const d=Promise.withResolvers();return this.streamControllers[n].pullCall=d,l.postMessage({sourceName:r,targetName:o,stream:Lt.PULL,streamId:n,desiredSize:h.desiredSize}),d.promise},cancel:h=>{Nt(h instanceof Error,"cancel must have a valid reason");const d=Promise.withResolvers();return this.streamControllers[n].cancelCall=d,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:r,targetName:o,stream:Lt.CANCEL,streamId:n,reason:Ae(h)}),d.promise}},s)}destroy(){var e;(e=a(this,fa))==null||e.abort(),m(this,fa,null)}}fa=new WeakMap,es=new WeakSet,Yf=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){y(this,es,Qf).call(this,e);return}if(e.callback){const s=e.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===bh.DATA)i.resolve(e.data);else if(e.callback===bh.ERROR)i.reject(Ae(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,i=e.sourceName,n=this.comObj;Promise.try(t,e.data).then(function(r){n.postMessage({sourceName:s,targetName:i,callback:bh.DATA,callbackId:e.callbackId,data:r})},function(r){n.postMessage({sourceName:s,targetName:i,callback:bh.ERROR,callbackId:e.callbackId,reason:Ae(r)})});return}if(e.streamId){y(this,es,Kf).call(this,e);return}t(e.data)},Kf=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,n=this.comObj,r=this,o=this.actionHandler[e.action],l={enqueue(h,d=1,u){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=d,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:s,targetName:i,stream:Lt.ENQUEUE,streamId:t,chunk:h},u)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:Lt.CLOSE,streamId:t}),delete r.streamSinks[t])},error(h){Nt(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:Lt.ERROR,streamId:t,reason:Ae(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,e.data,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Lt.START_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:Lt.START_COMPLETE,streamId:t,reason:Ae(h)})})},Qf=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,n=this.comObj,r=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case Lt.START_COMPLETE:e.success?r.startCall.resolve():r.startCall.reject(Ae(e.reason));break;case Lt.PULL_COMPLETE:e.success?r.pullCall.resolve():r.pullCall.reject(Ae(e.reason));break;case Lt.PULL:if(!o){n.postMessage({sourceName:s,targetName:i,stream:Lt.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||zu).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Lt.PULL_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:Lt.PULL_COMPLETE,streamId:t,reason:Ae(h)})});break;case Lt.ENQUEUE:if(Nt(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(e.chunk);break;case Lt.CLOSE:if(Nt(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),y(this,es,Dh).call(this,r,t);break;case Lt.ERROR:Nt(r,"error should have stream controller"),r.controller.error(Ae(e.reason)),y(this,es,Dh).call(this,r,t);break;case Lt.CANCEL_COMPLETE:e.success?r.cancelCall.resolve():r.cancelCall.reject(Ae(e.reason)),y(this,es,Dh).call(this,r,t);break;case Lt.CANCEL:if(!o)break;const l=Ae(e.reason);Promise.try(o.onCancel||zu,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Lt.CANCEL_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:Lt.CANCEL_COMPLETE,streamId:t,reason:Ae(h)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Dh=async function(e,t){var s,i,n;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(i=e.pullCall)==null?void 0:i.promise,(n=e.cancelCall)==null?void 0:n.promise]),delete this.streamControllers[t]};var nl;class Jf{constructor({enableHWA:e=!1}){b(this,nl,!1);m(this,nl,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!a(this,nl)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){dt("Abstract method `_createCanvas` called.")}}nl=new WeakMap;class wm extends Jf{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class Zf{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){dt("Abstract method `_fetch` called.")}}class Gu extends Zf{async _fetch(e){const t=await oh(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):ah(t)}}nt(2489);class qf{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,i,n){return"none"}destroy(e=!1){}}var Kn,pa,ni,ri,re,Qn,Jn,B,ie,mo,jr,Nh,Ur,tp,bd,zr,vo,bo,yd,yo;class Em extends qf{constructor({docId:t,ownerDocument:s=globalThis.document}){super();b(this,B);b(this,Kn);b(this,pa);b(this,ni);b(this,ri);b(this,re);b(this,Qn);b(this,Jn,0);m(this,ri,t),m(this,re,s)}addFilter(t){if(!t)return"none";let s=a(this,B,ie).get(t);if(s)return s;const[i,n,r]=y(this,B,Nh).call(this,t),o=t.length===1?i:`${i}${n}${r}`;if(s=a(this,B,ie).get(o),s)return a(this,B,ie).set(t,s),s;const l=`g_${a(this,ri)}_transfer_map_${he(this,Jn)._++}`,h=y(this,B,Ur).call(this,l);a(this,B,ie).set(t,h),a(this,B,ie).set(o,h);const d=y(this,B,zr).call(this,l);return y(this,B,bo).call(this,i,n,r,d),h}addHCMFilter(t,s){var v;const i=`${t}-${s}`,n="base";let r=a(this,B,mo).get(n);if((r==null?void 0:r.key)===i||(r?((v=r.filter)==null||v.remove(),r.key=i,r.url="none",r.filter=null):(r={key:i,url:"none",filter:null},a(this,B,mo).set(n,r)),!t||!s))return r.url;const o=y(this,B,yo).call(this,t);t=V.makeHexColor(...o);const l=y(this,B,yo).call(this,s);if(s=V.makeHexColor(...l),a(this,B,jr).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return r.url;const h=new Array(256);for(let g=0;g<=255;g++){const A=g/255;h[g]=A<=.03928?A/12.92:((A+.055)/1.055)**2.4}const d=h.join(","),u=`g_${a(this,ri)}_hcm_filter`,f=r.filter=y(this,B,zr).call(this,u);y(this,B,bo).call(this,d,d,d,f),y(this,B,bd).call(this,f);const p=(g,A)=>{const w=o[g]/255,S=l[g]/255,E=new Array(A+1);for(let T=0;T<=A;T++)E[T]=w+T/A*(S-w);return E.join(",")};return y(this,B,bo).call(this,p(0,5),p(1,5),p(2,5),f),r.url=y(this,B,Ur).call(this,u),r.url}addAlphaFilter(t){let s=a(this,B,ie).get(t);if(s)return s;const[i]=y(this,B,Nh).call(this,[t]),n=`alpha_${i}`;if(s=a(this,B,ie).get(n),s)return a(this,B,ie).set(t,s),s;const r=`g_${a(this,ri)}_alpha_map_${he(this,Jn)._++}`,o=y(this,B,Ur).call(this,r);a(this,B,ie).set(t,o),a(this,B,ie).set(n,o);const l=y(this,B,zr).call(this,r);return y(this,B,yd).call(this,i,l),o}addLuminosityFilter(t){let s=a(this,B,ie).get(t||"luminosity");if(s)return s;let i,n;if(t?([i]=y(this,B,Nh).call(this,[t]),n=`luminosity_${i}`):n="luminosity",s=a(this,B,ie).get(n),s)return a(this,B,ie).set(t,s),s;const r=`g_${a(this,ri)}_luminosity_map_${he(this,Jn)._++}`,o=y(this,B,Ur).call(this,r);a(this,B,ie).set(t,o),a(this,B,ie).set(n,o);const l=y(this,B,zr).call(this,r);return y(this,B,tp).call(this,l),t&&y(this,B,yd).call(this,i,l),o}addHighlightHCMFilter(t,s,i,n,r){var S;const o=`${s}-${i}-${n}-${r}`;let l=a(this,B,mo).get(t);if((l==null?void 0:l.key)===o||(l?((S=l.filter)==null||S.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},a(this,B,mo).set(t,l)),!s||!i))return l.url;const[h,d]=[s,i].map(y(this,B,yo).bind(this));let u=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),f=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[p,v]=[n,r].map(y(this,B,yo).bind(this));f<u&&([u,f,p,v]=[f,u,v,p]),a(this,B,jr).style.color="";const g=(E,T,x)=>{const C=new Array(256),R=(f-u)/x,I=E/255,P=(T-E)/(255*x);let M=0;for(let D=0;D<=x;D++){const G=Math.round(u+D*R),U=I+D*P;for(let W=M;W<=G;W++)C[W]=U;M=G+1}for(let D=M;D<256;D++)C[D]=C[M-1];return C.join(",")},A=`g_${a(this,ri)}_hcm_${t}_filter`,w=l.filter=y(this,B,zr).call(this,A);return y(this,B,bd).call(this,w),y(this,B,bo).call(this,g(p[0],v[0],5),g(p[1],v[1],5),g(p[2],v[2],5),w),l.url=y(this,B,Ur).call(this,A),l.url}destroy(t=!1){var s,i,n,r;t&&((s=a(this,Qn))!=null&&s.size)||((i=a(this,ni))==null||i.parentNode.parentNode.remove(),m(this,ni,null),(n=a(this,pa))==null||n.clear(),m(this,pa,null),(r=a(this,Qn))==null||r.clear(),m(this,Qn,null),m(this,Jn,0))}}Kn=new WeakMap,pa=new WeakMap,ni=new WeakMap,ri=new WeakMap,re=new WeakMap,Qn=new WeakMap,Jn=new WeakMap,B=new WeakSet,ie=function(){return a(this,pa)||m(this,pa,new Map)},mo=function(){return a(this,Qn)||m(this,Qn,new Map)},jr=function(){if(!a(this,ni)){const t=a(this,re).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=a(this,re).createElementNS(zs,"svg");i.setAttribute("width",0),i.setAttribute("height",0),m(this,ni,a(this,re).createElementNS(zs,"defs")),t.append(i),i.append(a(this,ni)),a(this,re).body.append(t)}return a(this,ni)},Nh=function(t){if(t.length===1){const h=t[0],d=new Array(256);for(let f=0;f<256;f++)d[f]=h[f]/255;const u=d.join(",");return[u,u,u]}const[s,i,n]=t,r=new Array(256),o=new Array(256),l=new Array(256);for(let h=0;h<256;h++)r[h]=s[h]/255,o[h]=i[h]/255,l[h]=n[h]/255;return[r.join(","),o.join(","),l.join(",")]},Ur=function(t){if(a(this,Kn)===void 0){m(this,Kn,"");const s=a(this,re).URL;s!==a(this,re).baseURI&&(Nc(s)?Y('#createUrl: ignore "data:"-URL for performance reasons.'):m(this,Kn,cf(s,"")))}return`url(${a(this,Kn)}#${t})`},tp=function(t){const s=a(this,re).createElementNS(zs,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},bd=function(t){const s=a(this,re).createElementNS(zs,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},zr=function(t){const s=a(this,re).createElementNS(zs,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),a(this,B,jr).append(s),s},vo=function(t,s,i){const n=a(this,re).createElementNS(zs,s);n.setAttribute("type","discrete"),n.setAttribute("tableValues",i),t.append(n)},bo=function(t,s,i,n){const r=a(this,re).createElementNS(zs,"feComponentTransfer");n.append(r),y(this,B,vo).call(this,r,"feFuncR",t),y(this,B,vo).call(this,r,"feFuncG",s),y(this,B,vo).call(this,r,"feFuncB",i)},yd=function(t,s){const i=a(this,re).createElementNS(zs,"feComponentTransfer");s.append(i),y(this,B,vo).call(this,i,"feFuncA",t)},yo=function(t){return a(this,B,jr).style.color=t,Su(getComputedStyle(a(this,B,jr)).getPropertyValue("color"))};class ep{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){dt("Abstract method `_fetch` called.")}}class Vu extends ep{async _fetch(e){const t=await oh(e,"arraybuffer");return new Uint8Array(t)}}class sp{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){dt("Abstract method `_fetch` called.")}}class Wu extends sp{async _fetch(e){const t=await oh(e,"arraybuffer");return new Uint8Array(t)}}var of;if(ge){let c;try{const e=process.getBuiltinModule("module").createRequire(import.meta.url);try{c=e("@napi-rs/canvas")}catch(t){Y(`Cannot load "@napi-rs/canvas" package: "${t}".`)}}catch(e){Y(`Cannot access the \`require\` function: "${e}".`)}globalThis.DOMMatrix||(c!=null&&c.DOMMatrix?globalThis.DOMMatrix=c.DOMMatrix:Y("Cannot polyfill `DOMMatrix`, rendering may be broken.")),globalThis.ImageData||(c!=null&&c.ImageData?globalThis.ImageData=c.ImageData:Y("Cannot polyfill `ImageData`, rendering may be broken.")),globalThis.Path2D||(c!=null&&c.Path2D?globalThis.Path2D=c.Path2D:Y("Cannot polyfill `Path2D`, rendering may be broken.")),(of=globalThis.navigator)!=null&&of.language||(globalThis.navigator={language:"en-US",platform:"",userAgent:""})}async function Tu(c){const t=await process.getBuiltinModule("fs").promises.readFile(c);return new Uint8Array(t)}class Sm extends qf{}class xm extends Jf{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class Tm extends Zf{async _fetch(e){return Tu(e)}}class Cm extends ep{async _fetch(e){return Tu(e)}}class Rm extends sp{async _fetch(e){return Tu(e)}}const Zt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Ad(c,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,s),c.clip(i)}class Cu{isModifyingCurrentTransform(){return!1}getPattern(){dt("Abstract method `getPattern` called.")}}class Im extends Cu{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)t.addColorStop(s[0],s[1]);return t}getPattern(e,t,s,i){let n;if(i===Zt.STROKE||i===Zt.FILL){const r=t.current.getClippedPathBoundingBox(i,xt(e))||[0,0,0,0],o=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,h=t.cachedCanvases.getCanvas("pattern",o,l),d=h.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-r[0],-r[1]),s=V.transform(s,[1,0,0,1,r[0],r[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),Ad(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),n=e.createPattern(h.canvas,"no-repeat");const u=new DOMMatrix(s);n.setTransform(u)}else Ad(e,this._bbox),n=this._createGradient(e);return n}}function Uc(c,e,t,s,i,n,r,o){const l=e.coords,h=e.colors,d=c.data,u=c.width*4;let f;l[t+1]>l[s+1]&&(f=t,t=s,s=f,f=n,n=r,r=f),l[s+1]>l[i+1]&&(f=s,s=i,i=f,f=r,r=o,o=f),l[t+1]>l[s+1]&&(f=t,t=s,s=f,f=n,n=r,r=f);const p=(l[t]+e.offsetX)*e.scaleX,v=(l[t+1]+e.offsetY)*e.scaleY,g=(l[s]+e.offsetX)*e.scaleX,A=(l[s+1]+e.offsetY)*e.scaleY,w=(l[i]+e.offsetX)*e.scaleX,S=(l[i+1]+e.offsetY)*e.scaleY;if(v>=S)return;const E=h[n],T=h[n+1],x=h[n+2],C=h[r],R=h[r+1],I=h[r+2],P=h[o],M=h[o+1],D=h[o+2],G=Math.round(v),U=Math.round(S);let W,pt,F,k,at,le,ye,Ge;for(let Mt=G;Mt<=U;Mt++){if(Mt<A){const L=Mt<v?0:(v-Mt)/(v-A);W=p-(p-g)*L,pt=E-(E-C)*L,F=T-(T-R)*L,k=x-(x-I)*L}else{let L;Mt>S?L=1:A===S?L=0:L=(A-Mt)/(A-S),W=g-(g-w)*L,pt=C-(C-P)*L,F=R-(R-M)*L,k=I-(I-D)*L}let vt;Mt<v?vt=0:Mt>S?vt=1:vt=(v-Mt)/(v-S),at=p-(p-w)*vt,le=E-(E-P)*vt,ye=T-(T-M)*vt,Ge=x-(x-D)*vt;const Pi=Math.round(Math.min(W,at)),As=Math.round(Math.max(W,at));let j=u*Mt+Pi*4;for(let L=Pi;L<=As;L++)vt=(W-L)/(W-at),vt<0?vt=0:vt>1&&(vt=1),d[j++]=pt-(pt-le)*vt|0,d[j++]=F-(F-ye)*vt|0,d[j++]=k-(k-Ge)*vt|0,d[j++]=255}}function Pm(c,e,t){const s=e.coords,i=e.colors;let n,r;switch(e.type){case"lattice":const o=e.verticesPerRow,l=Math.floor(s.length/o)-1,h=o-1;for(n=0;n<l;n++){let d=n*o;for(let u=0;u<h;u++,d++)Uc(c,t,s[d],s[d+1],s[d+o],i[d],i[d+1],i[d+o]),Uc(c,t,s[d+o+1],s[d+1],s[d+o],i[d+o+1],i[d+1],i[d+o])}break;case"triangles":for(n=0,r=s.length;n<r;n+=3)Uc(c,t,s[n],s[n+1],s[n+2],i[n],i[n+1],i[n+2]);break;default:throw new Error("illegal figure")}}class Mm extends Cu{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,s){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-o,d=Math.ceil(this._bounds[3])-l,u=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),p=h/u,v=d/f,g={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/p,scaleY:1/v},A=u+2*2,w=f+2*2,S=s.getCanvas("mesh",A,w),E=S.context,T=E.createImageData(u,f);if(t){const C=T.data;for(let R=0,I=C.length;R<I;R+=4)C[R]=t[0],C[R+1]=t[1],C[R+2]=t[2],C[R+3]=255}for(const C of this._figures)Pm(T,C,g);return E.putImageData(T,2,2),{canvas:S.canvas,offsetX:o-2*p,offsetY:l-2*v,scaleX:p,scaleY:v}}isModifyingCurrentTransform(){return!0}getPattern(e,t,s,i){Ad(e,this._bbox);const n=new Float32Array(2);if(i===Zt.SHADING)V.singularValueDecompose2dScale(xt(e),n);else if(this.matrix){V.singularValueDecompose2dScale(this.matrix,n);const[o,l]=n;V.singularValueDecompose2dScale(t.baseTransform,n),n[0]*=o,n[1]*=l}else V.singularValueDecompose2dScale(t.baseTransform,n);const r=this._createMeshCanvas(n,i===Zt.SHADING?null:this._background,t.cachedCanvases);return i!==Zt.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(r.offsetX,r.offsetY),e.scale(r.scaleX,r.scaleY),e.createPattern(r.canvas,"no-repeat")}}class Lm extends Cu{getPattern(){return"hotpink"}}function Om(c){switch(c[0]){case"RadialAxial":return new Im(c);case"Mesh":return new Mm(c);case"Dummy":return new Lm}throw new Error(`Unknown IR type: ${c[0]}`)}const Xu={COLORED:1,UNCOLORED:2},bc=class bc{constructor(e,t,s,i){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(e){const{bbox:t,operatorList:s,paintType:i,tilingType:n,color:r,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:h}=this;l=Math.abs(l),h=Math.abs(h),Dc("TilingType: "+n);const d=t[0],u=t[1],f=t[2],p=t[3],v=f-d,g=p-u,A=new Float32Array(2);V.singularValueDecompose2dScale(this.matrix,A);const[w,S]=A;V.singularValueDecompose2dScale(this.baseTransform,A);const E=w*A[0],T=S*A[1];let x=v,C=g,R=!1,I=!1;const P=Math.ceil(l*E),M=Math.ceil(h*T),D=Math.ceil(v*E),G=Math.ceil(g*T);P>=D?x=l:R=!0,M>=G?C=h:I=!0;const U=this.getSizeAndScale(x,this.ctx.canvas.width,E),W=this.getSizeAndScale(C,this.ctx.canvas.height,T),pt=e.cachedCanvases.getCanvas("pattern",U.size,W.size),F=pt.context,k=o.createCanvasGraphics(F);if(k.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(k,i,r),F.translate(-U.scale*d,-W.scale*u),k.transform(U.scale,0,0,W.scale,0,0),F.save(),this.clipBbox(k,d,u,f,p),k.baseTransform=xt(k.ctx),k.executeOperatorList(s),k.endDrawing(),F.restore(),R||I){const at=pt.canvas;R&&(x=l),I&&(C=h);const le=this.getSizeAndScale(x,this.ctx.canvas.width,E),ye=this.getSizeAndScale(C,this.ctx.canvas.height,T),Ge=le.size,Mt=ye.size,vt=e.cachedCanvases.getCanvas("pattern-workaround",Ge,Mt),Pi=vt.context,As=R?Math.floor(v/l):0,j=I?Math.floor(g/h):0;for(let L=0;L<=As;L++)for(let _=0;_<=j;_++)Pi.drawImage(at,Ge*L,Mt*_,Ge,Mt,0,0,Ge,Mt);return{canvas:vt.canvas,scaleX:le.scale,scaleY:ye.scale,offsetX:d,offsetY:u}}return{canvas:pt.canvas,scaleX:U.scale,scaleY:W.scale,offsetX:d,offsetY:u}}getSizeAndScale(e,t,s){const i=Math.max(bc.MAX_PATTERN_SIZE,t);let n=Math.ceil(e*s);return n>=i?n=i:s=n/e,{scale:s,size:n}}clipBbox(e,t,s,i,n){const r=i-t,o=n-s;e.ctx.rect(t,s,r,o),V.axialAlignedBoundingBox([t,s,i,n],xt(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const i=e.ctx,n=e.current;switch(t){case Xu.COLORED:const{fillStyle:r,strokeStyle:o}=this.ctx;i.fillStyle=n.fillColor=r,i.strokeStyle=n.strokeColor=o;break;case Xu.UNCOLORED:i.fillStyle=i.strokeStyle=s,n.fillColor=n.strokeColor=s;break;default:throw new Jg(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,s,i){let n=s;i!==Zt.SHADING&&(n=V.transform(n,t.baseTransform),this.matrix&&(n=V.transform(n,this.matrix)));const r=this.createPatternCanvas(t);let o=new DOMMatrix(n);o=o.translate(r.offsetX,r.offsetY),o=o.scale(1/r.scaleX,1/r.scaleY);const l=e.createPattern(r.canvas,"repeat");return l.setTransform(o),l}};O(bc,"MAX_PATTERN_SIZE",3e3);let wd=bc;function Dm({src:c,srcPos:e=0,dest:t,width:s,height:i,nonBlackColor:n=4294967295,inverseDecode:r=!1}){const o=ee.isLittleEndian?4278190080:255,[l,h]=r?[n,o]:[o,n],d=s>>3,u=s&7,f=c.length;t=new Uint32Array(t.buffer);let p=0;for(let v=0;v<i;v++){for(const A=e+d;e<A;e++){const w=e<f?c[e]:255;t[p++]=w&128?h:l,t[p++]=w&64?h:l,t[p++]=w&32?h:l,t[p++]=w&16?h:l,t[p++]=w&8?h:l,t[p++]=w&4?h:l,t[p++]=w&2?h:l,t[p++]=w&1?h:l}if(u===0)continue;const g=e<f?c[e++]:255;for(let A=0;A<u;A++)t[p++]=g&1<<7-A?h:l}return{srcPos:e,destPos:p}}const Yu=16,Ku=100,Nm=15,Qu=10,Te=16,zc=new DOMMatrix,je=new Float32Array(2),Xr=new Float32Array([1/0,1/0,-1/0,-1/0]);function Fm(c,e){if(c._removeMirroring)throw new Error("Context is already forwarding operations.");c.__originalSave=c.save,c.__originalRestore=c.restore,c.__originalRotate=c.rotate,c.__originalScale=c.scale,c.__originalTranslate=c.translate,c.__originalTransform=c.transform,c.__originalSetTransform=c.setTransform,c.__originalResetTransform=c.resetTransform,c.__originalClip=c.clip,c.__originalMoveTo=c.moveTo,c.__originalLineTo=c.lineTo,c.__originalBezierCurveTo=c.bezierCurveTo,c.__originalRect=c.rect,c.__originalClosePath=c.closePath,c.__originalBeginPath=c.beginPath,c._removeMirroring=()=>{c.save=c.__originalSave,c.restore=c.__originalRestore,c.rotate=c.__originalRotate,c.scale=c.__originalScale,c.translate=c.__originalTranslate,c.transform=c.__originalTransform,c.setTransform=c.__originalSetTransform,c.resetTransform=c.__originalResetTransform,c.clip=c.__originalClip,c.moveTo=c.__originalMoveTo,c.lineTo=c.__originalLineTo,c.bezierCurveTo=c.__originalBezierCurveTo,c.rect=c.__originalRect,c.closePath=c.__originalClosePath,c.beginPath=c.__originalBeginPath,delete c._removeMirroring},c.save=function(){e.save(),this.__originalSave()},c.restore=function(){e.restore(),this.__originalRestore()},c.translate=function(t,s){e.translate(t,s),this.__originalTranslate(t,s)},c.scale=function(t,s){e.scale(t,s),this.__originalScale(t,s)},c.transform=function(t,s,i,n,r,o){e.transform(t,s,i,n,r,o),this.__originalTransform(t,s,i,n,r,o)},c.setTransform=function(t,s,i,n,r,o){e.setTransform(t,s,i,n,r,o),this.__originalSetTransform(t,s,i,n,r,o)},c.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},c.rotate=function(t){e.rotate(t),this.__originalRotate(t)},c.clip=function(t){e.clip(t),this.__originalClip(t)},c.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},c.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},c.bezierCurveTo=function(t,s,i,n,r,o){e.bezierCurveTo(t,s,i,n,r,o),this.__originalBezierCurveTo(t,s,i,n,r,o)},c.rect=function(t,s,i,n){e.rect(t,s,i,n),this.__originalRect(t,s,i,n)},c.closePath=function(){e.closePath(),this.__originalClosePath()},c.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class km{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,s)):(i=this.canvasFactory.create(t,s),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function yh(c,e,t,s,i,n,r,o,l,h){const[d,u,f,p,v,g]=xt(c);if(u===0&&f===0){const S=r*d+v,E=Math.round(S),T=o*p+g,x=Math.round(T),C=(r+l)*d+v,R=Math.abs(Math.round(C)-E)||1,I=(o+h)*p+g,P=Math.abs(Math.round(I)-x)||1;return c.setTransform(Math.sign(d),0,0,Math.sign(p),E,x),c.drawImage(e,t,s,i,n,0,0,R,P),c.setTransform(d,u,f,p,v,g),[R,P]}if(d===0&&p===0){const S=o*f+v,E=Math.round(S),T=r*u+g,x=Math.round(T),C=(o+h)*f+v,R=Math.abs(Math.round(C)-E)||1,I=(r+l)*u+g,P=Math.abs(Math.round(I)-x)||1;return c.setTransform(0,Math.sign(u),Math.sign(f),0,E,x),c.drawImage(e,t,s,i,n,0,0,P,R),c.setTransform(d,u,f,p,v,g),[P,R]}c.drawImage(e,t,s,i,n,r,o,l,h);const A=Math.hypot(d,u),w=Math.hypot(f,p);return[A*l,w*h]}class Ju{constructor(e,t){O(this,"alphaIsShape",!1);O(this,"fontSize",0);O(this,"fontSizeScale",1);O(this,"textMatrix",null);O(this,"textMatrixScale",1);O(this,"fontMatrix",Qc);O(this,"leading",0);O(this,"x",0);O(this,"y",0);O(this,"lineX",0);O(this,"lineY",0);O(this,"charSpacing",0);O(this,"wordSpacing",0);O(this,"textHScale",1);O(this,"textRenderingMode",se.FILL);O(this,"textRise",0);O(this,"fillColor","#000000");O(this,"strokeColor","#000000");O(this,"patternFill",!1);O(this,"patternStroke",!1);O(this,"fillAlpha",1);O(this,"strokeAlpha",1);O(this,"lineWidth",1);O(this,"activeSMask",null);O(this,"transferMaps","none");this.clipBox=new Float32Array([0,0,e,t]),this.minMax=Xr.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=Zt.FILL,t=null){const s=this.minMax.slice();if(e===Zt.STROKE){t||dt("Stroke bounding box must include transform."),V.singularValueDecompose2dScale(t,je);const i=je[0]*this.lineWidth/2,n=je[1]*this.lineWidth/2;s[0]-=i,s[1]-=n,s[2]+=i,s[3]+=n}return s}updateClipFromPath(){const e=V.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(Xr,0)}getClippedPathBoundingBox(e=Zt.FILL,t=null){return V.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function Zu(c,e){if(e instanceof ImageData){c.putImageData(e,0,0);return}const t=e.height,s=e.width,i=t%Te,n=(t-i)/Te,r=i===0?n:n+1,o=c.createImageData(s,Te);let l=0,h;const d=e.data,u=o.data;let f,p,v,g;if(e.kind===xh.GRAYSCALE_1BPP){const A=d.byteLength,w=new Uint32Array(u.buffer,0,u.byteLength>>2),S=w.length,E=s+7>>3,T=4294967295,x=ee.isLittleEndian?4278190080:255;for(f=0;f<r;f++){for(v=f<n?Te:i,h=0,p=0;p<v;p++){const C=A-l;let R=0;const I=C>E?s:C*8-7,P=I&-8;let M=0,D=0;for(;R<P;R+=8)D=d[l++],w[h++]=D&128?T:x,w[h++]=D&64?T:x,w[h++]=D&32?T:x,w[h++]=D&16?T:x,w[h++]=D&8?T:x,w[h++]=D&4?T:x,w[h++]=D&2?T:x,w[h++]=D&1?T:x;for(;R<I;R++)M===0&&(D=d[l++],M=128),w[h++]=D&M?T:x,M>>=1}for(;h<S;)w[h++]=0;c.putImageData(o,0,f*Te)}}else if(e.kind===xh.RGBA_32BPP){for(p=0,g=s*Te*4,f=0;f<n;f++)u.set(d.subarray(l,l+g)),l+=g,c.putImageData(o,0,p),p+=Te;f<r&&(g=s*i*4,u.set(d.subarray(l,l+g)),c.putImageData(o,0,p))}else if(e.kind===xh.RGB_24BPP)for(v=Te,g=s*v,f=0;f<r;f++){for(f>=n&&(v=i,g=s*v),h=0,p=g;p--;)u[h++]=d[l++],u[h++]=d[l++],u[h++]=d[l++],u[h++]=255;c.putImageData(o,0,f*Te)}else throw new Error(`bad image kind: ${e.kind}`)}function qu(c,e){if(e.bitmap){c.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,i=t%Te,n=(t-i)/Te,r=i===0?n:n+1,o=c.createImageData(s,Te);let l=0;const h=e.data,d=o.data;for(let u=0;u<r;u++){const f=u<n?Te:i;({srcPos:l}=Dm({src:h,srcPos:l,dest:d,width:s,height:f,nonBlackColor:0})),c.putImageData(o,0,u*Te)}}function ro(c,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)c[s]!==void 0&&(e[s]=c[s]);c.setLineDash!==void 0&&(e.setLineDash(c.getLineDash()),e.lineDashOffset=c.lineDashOffset)}function Ah(c){c.strokeStyle=c.fillStyle="#000000",c.fillRule="nonzero",c.globalAlpha=1,c.lineWidth=1,c.lineCap="butt",c.lineJoin="miter",c.miterLimit=10,c.globalCompositeOperation="source-over",c.font="10px sans-serif",c.setLineDash!==void 0&&(c.setLineDash([]),c.lineDashOffset=0);const{filter:e}=c;e!=="none"&&e!==""&&(c.filter="none")}function tf(c,e){if(e)return!0;V.singularValueDecompose2dScale(c,je);const t=Math.fround(js.pixelRatio*An.PDF_TO_CSS_UNITS);return je[0]<=t&&je[1]<=t}const _m=["butt","round","square"],Bm=["miter","round","bevel"],Hm={},ef={};var ys,Ed,Sd,xd;const Ou=class Ou{constructor(e,t,s,i,n,{optionalContentConfig:r,markedContentStack:o=null},l,h){b(this,ys);this.ctx=e,this.current=new Ju(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=i,this.filterFactory=n,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=r,this.cachedCanvases=new km(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:i=null}){const n=this.ctx.canvas.width,r=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,n,r),this.ctx.fillStyle=o,s){const l=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...xt(this.compositeCtx))}this.ctx.save(),Ah(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=xt(this.ctx)}executeOperatorList(e,t,s,i){const n=e.argsArray,r=e.fnArray;let o=t||0;const l=n.length;if(l===o)return o;const h=l-o>Qu&&typeof s=="function",d=h?Date.now()+Nm:0;let u=0;const f=this.commonObjs,p=this.objs;let v;for(;;){if(i!==void 0&&o===i.nextBreakPoint)return i.breakIt(o,s),o;if(v=r[o],v!==ec.dependency)this[v].apply(this,n[o]);else for(const g of n[o]){const A=g.startsWith("g_")?f:p;if(!A.has(g))return A.get(g,s),o}if(o++,o===l)return o;if(h&&++u>Qu){if(Date.now()>d)return s(),o;u=0}}}endDrawing(){y(this,ys,Ed).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),y(this,ys,Sd).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,i=e.height??e.displayHeight;let n=Math.max(Math.hypot(t[0],t[1]),1),r=Math.max(Math.hypot(t[2],t[3]),1),o=s,l=i,h="prescale1",d,u;for(;n>2&&o>1||r>2&&l>1;){let f=o,p=l;n>2&&o>1&&(f=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),n/=o/f),r>2&&l>1&&(p=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/p),d=this.cachedCanvases.getCanvas(h,f,p),u=d.context,u.clearRect(0,0,f,p),u.drawImage(e,0,0,o,l,0,0,f,p),e=d.canvas,o=f,l=p,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:s,height:i}=e,n=this.current.fillColor,r=this.current.patternFill,o=xt(t);let l,h,d,u;if((e.bitmap||e.data)&&e.count>1){const P=e.bitmap||e.data.buffer;h=JSON.stringify(r?o:[o.slice(0,4),n]),l=this._cachedBitmapsMap.get(P),l||(l=new Map,this._cachedBitmapsMap.set(P,l));const M=l.get(h);if(M&&!r){const D=Math.round(Math.min(o[0],o[2])+o[4]),G=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:M,offsetX:D,offsetY:G}}d=M}d||(u=this.cachedCanvases.getCanvas("maskCanvas",s,i),qu(u.context,e));let f=V.transform(o,[1/s,0,0,-1/i,0,0]);f=V.transform(f,[1,0,0,1,0,-i]);const p=Xr.slice();V.axialAlignedBoundingBox([0,0,s,i],f,p);const[v,g,A,w]=p,S=Math.round(A-v)||1,E=Math.round(w-g)||1,T=this.cachedCanvases.getCanvas("fillCanvas",S,E),x=T.context,C=v,R=g;x.translate(-C,-R),x.transform(...f),d||(d=this._scaleImage(u.canvas,ws(x)),d=d.img,l&&r&&l.set(h,d)),x.imageSmoothingEnabled=tf(xt(x),e.interpolate),yh(x,d,0,0,d.width,d.height,0,0,s,i),x.globalCompositeOperation="source-in";const I=V.transform(ws(x),[1,0,0,1,-C,-R]);return x.fillStyle=r?n.getPattern(t,this,I,Zt.FILL):n,x.fillRect(0,0,s,i),l&&!r&&(this.cachedCanvases.delete("fillCanvas"),l.set(h,T.canvas)),{canvas:T.canvas,offsetX:Math.round(C),offsetY:Math.round(R)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=_m[e]}setLineJoin(e){this.ctx.lineJoin=Bm[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,s]of e)switch(t){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(s,e,t);this.suspendedCtx=this.ctx;const n=this.ctx=i.context;n.setTransform(this.suspendedCtx.getTransform()),ro(this.suspendedCtx,n),Fm(n,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ro(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,i){const n=i[0],r=i[1],o=i[2]-n,l=i[3]-r;o===0||l===0||(this.genericComposeSMask(t.context,s,o,l,t.subtype,t.backdrop,t.transferMap,n,r,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,i,n,r,o,l,h,d,u){let f=e.canvas,p=l-d,v=h-u;if(r)if(p<0||v<0||p+s>f.width||v+i>f.height){const A=this.cachedCanvases.getCanvas("maskExtension",s,i),w=A.context;w.drawImage(f,-p,-v),w.globalCompositeOperation="destination-atop",w.fillStyle=r,w.fillRect(0,0,s,i),w.globalCompositeOperation="source-over",f=A.canvas,p=v=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const A=new Path2D;A.rect(p,v,s,i),e.clip(A),e.globalCompositeOperation="destination-atop",e.fillStyle=r,e.fillRect(p,v,s,i),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),n==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):n==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const g=new Path2D;g.rect(l,h,s,i),t.clip(g),t.globalCompositeOperation="destination-in",t.drawImage(f,p,v,s,i,l,h,s,i),t.restore()}save(){this.inSMaskMode&&ro(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&ro(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,s,i,n,r){this.ctx.transform(e,t,s,i,n,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s){let[i]=t;if(!s){i||(i=t[0]=new Path2D),this[e](i);return}if(!(i instanceof Path2D)){const n=t[0]=new Path2D;for(let r=0,o=i.length;r<o;)switch(i[r++]){case mh.moveTo:n.moveTo(i[r++],i[r++]);break;case mh.lineTo:n.lineTo(i[r++],i[r++]);break;case mh.curveTo:n.bezierCurveTo(i[r++],i[r++],i[r++],i[r++],i[r++],i[r++]);break;case mh.closePath:n.closePath();break;default:Y(`Unrecognized drawing path operator: ${i[r-1]}`);break}i=n}V.axialAlignedBoundingBox(s,xt(this.ctx),this.current.minMax),this[e](i)}closePath(){this.ctx.closePath()}stroke(e,t=!0){const s=this.ctx,i=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof i=="object"&&(i!=null&&i.getPattern)){const n=i.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=i.getPattern(s,this,ws(s),Zt.STROKE),n){const r=new Path2D;r.addPath(e,s.getTransform().invertSelf().multiplySelf(n)),e=r}this.rescaleAndStroke(e,!1),s.restore()}else this.rescaleAndStroke(e,!0);t&&this.consumePath(e,this.current.getClippedPathBoundingBox(Zt.STROKE,xt(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(e){this.stroke(e)}fill(e,t=!0){const s=this.ctx,i=this.current.fillColor,n=this.current.patternFill;let r=!1;if(n){const l=i.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.fillStyle=i.getPattern(s,this,ws(s),Zt.FILL),l){const h=new Path2D;h.addPath(e,s.getTransform().invertSelf().multiplySelf(l)),e=h}r=!0}const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(s.fill(e,"evenodd"),this.pendingEOFill=!1):s.fill(e)),r&&s.restore(),t&&this.consumePath(e,o)}eoFill(e){this.pendingEOFill=!0,this.fill(e)}fillStroke(e){this.fill(e,!1),this.stroke(e,!1),this.consumePath(e)}eoFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}closeFillStroke(e){this.fillStroke(e)}closeEOFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}endPath(e){this.consumePath(e)}rawFillPath(e){this.ctx.fill(e)}clip(){this.pendingClip=Hm}eoClip(){this.pendingClip=ef}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0)return;const s=new Path2D,i=t.getTransform().invertSelf();for(const{transform:n,x:r,y:o,fontSize:l,path:h}of e)s.addPath(h,new DOMMatrix(n).preMultiplySelf(i).translate(r,o).scale(l,-l));t.clip(s),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var d;const s=this.commonObjs.get(e),i=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=s.fontMatrix||Qc,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&Y("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=s,this.current.fontSize=t,s.isType3Font)return;const n=s.loadedName||"sans-serif",r=((d=s.systemFontInfo)==null?void 0:d.css)||`"${n}", ${s.fallbackName}`;let o="normal";s.black?o="900":s.bold&&(o="bold");const l=s.italic?"italic":"normal";let h=t;t<Yu?h=Yu:t>Ku&&(h=Ku),this.current.fontSizeScale=t/h,this.ctx.font=`${l} ${o} ${h}px ${r}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e){const{current:t}=this;t.textMatrix=e,t.textMatrixScale=Math.hypot(e[0],e[1]),t.x=t.lineX=0,t.y=t.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,s,i,n){const r=this.ctx,o=this.current,l=o.font,h=o.textRenderingMode,d=o.fontSize/o.fontSizeScale,u=h&se.FILL_STROKE_MASK,f=!!(h&se.ADD_TO_PATH_FLAG),p=o.patternFill&&!l.missingFile,v=o.patternStroke&&!l.missingFile;let g;if((l.disableFontFace||f||p||v)&&(g=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||p||v){r.save(),r.translate(t,s),r.scale(d,-d);let A;if((u===se.FILL||u===se.FILL_STROKE)&&(i?(A=r.getTransform(),r.setTransform(...i),r.fill(y(this,ys,xd).call(this,g,A,i))):r.fill(g)),u===se.STROKE||u===se.FILL_STROKE)if(n){A||(A=r.getTransform()),r.setTransform(...n);const{a:w,b:S,c:E,d:T}=A,x=V.inverseTransform(n),C=V.transform([w,S,E,T,0,0],x);V.singularValueDecompose2dScale(C,je),r.lineWidth*=Math.max(je[0],je[1])/d,r.stroke(y(this,ys,xd).call(this,g,A,n))}else r.lineWidth/=d,r.stroke(g);r.restore()}else(u===se.FILL||u===se.FILL_STROKE)&&r.fillText(e,t,s),(u===se.STROKE||u===se.FILL_STROKE)&&r.strokeText(e,t,s);f&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:xt(r),x:t,y:s,fontSize:d,path:g})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){s=!0;break}return tt(this,"isFontSubpixelAAEnabled",s)}showText(e){const t=this.current,s=t.font;if(s.isType3Font)return this.showType3Text(e);const i=t.fontSize;if(i===0)return;const n=this.ctx,r=t.fontSizeScale,o=t.charSpacing,l=t.wordSpacing,h=t.fontDirection,d=t.textHScale*h,u=e.length,f=s.vertical,p=f?1:-1,v=s.defaultVMetrics,g=i*t.fontMatrix[0],A=t.textRenderingMode===se.FILL&&!s.disableFontFace&&!t.patternFill;n.save(),t.textMatrix&&n.transform(...t.textMatrix),n.translate(t.x,t.y+t.textRise),h>0?n.scale(d,-1):n.scale(d,1);let w,S;if(t.patternFill){n.save();const R=t.fillColor.getPattern(n,this,ws(n),Zt.FILL);w=xt(n),n.restore(),n.fillStyle=R}if(t.patternStroke){n.save();const R=t.strokeColor.getPattern(n,this,ws(n),Zt.STROKE);S=xt(n),n.restore(),n.strokeStyle=R}let E=t.lineWidth;const T=t.textMatrixScale;if(T===0||E===0){const R=t.textRenderingMode&se.FILL_STROKE_MASK;(R===se.STROKE||R===se.FILL_STROKE)&&(E=this.getSinglePixelWidth())}else E/=T;if(r!==1&&(n.scale(r,r),E/=r),n.lineWidth=E,s.isInvalidPDFjsFont){const R=[];let I=0;for(const P of e)R.push(P.unicode),I+=P.width;n.fillText(R.join(""),0,0),t.x+=I*g*d,n.restore(),this.compose();return}let x=0,C;for(C=0;C<u;++C){const R=e[C];if(typeof R=="number"){x+=p*R*i/1e3;continue}let I=!1;const P=(R.isSpace?l:0)+o,M=R.fontChar,D=R.accent;let G,U,W=R.width;if(f){const F=R.vmetric||v,k=-(R.vmetric?F[1]:W*.5)*g,at=F[2]*g;W=F?-F[0]:W,G=k/r,U=(x+at)/r}else G=x/r,U=0;if(s.remeasure&&W>0){const F=n.measureText(M).width*1e3/i*r;if(W<F&&this.isFontSubpixelAAEnabled){const k=W/F;I=!0,n.save(),n.scale(k,1),G/=k}else W!==F&&(G+=(W-F)/2e3*i/r)}if(this.contentVisible&&(R.isInFont||s.missingFile)){if(A&&!D)n.fillText(M,G,U);else if(this.paintChar(M,G,U,w,S),D){const F=G+i*D.offset.x/r,k=U-i*D.offset.y/r;this.paintChar(D.fontChar,F,k,w,S)}}const pt=f?W*g-P*h:W*g+P*h;x+=pt,I&&n.restore()}f?t.y-=x:t.x+=x*d,n.restore(),this.compose()}showType3Text(e){const t=this.ctx,s=this.current,i=s.font,n=s.fontSize,r=s.fontDirection,o=i.vertical?1:-1,l=s.charSpacing,h=s.wordSpacing,d=s.textHScale*r,u=s.fontMatrix||Qc,f=e.length,p=s.textRenderingMode===se.INVISIBLE;let v,g,A,w;if(!(p||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),s.textMatrix&&t.transform(...s.textMatrix),t.translate(s.x,s.y+s.textRise),t.scale(d,r),v=0;v<f;++v){if(g=e[v],typeof g=="number"){w=o*g*n/1e3,this.ctx.translate(w,0),s.x+=w*d;continue}const S=(g.isSpace?h:0)+l,E=i.charProcOperatorList[g.operatorListId];E?this.contentVisible&&(this.save(),t.scale(n,n),t.transform(...u),this.executeOperatorList(E),this.restore()):Y(`Type3 character "${g.operatorListId}" is not available.`);const T=[g.width,0];V.applyTransform(T,u),A=T[0]*n+S,t.translate(A,0),s.x+=A*d}t.restore()}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,s,i,n,r){const o=new Path2D;o.rect(s,i,n-s,r-i),this.ctx.clip(o),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const s=this.baseTransform||xt(this.ctx),i={createCanvasGraphics:n=>new Ou(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new wd(e,this.ctx,i,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e){this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e){this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=Om(this.getObject(e)),this.cachedPatterns.set(e,s)),t&&(s.matrix=t),s}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const s=this._getPattern(e);t.fillStyle=s.getPattern(t,this,ws(t),Zt.SHADING);const i=ws(t);if(i){const{width:n,height:r}=t.canvas,o=Xr.slice();V.axialAlignedBoundingBox([0,0,n,r],i,o);const[l,h,d,u]=o;this.ctx.fillRect(l,h,d-l,u-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){dt("Should not call beginInlineImage")}beginImageData(){dt("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=xt(this.ctx),t)){V.axialAlignedBoundingBox(t,this.baseTransform,this.current.minMax);const[s,i,n,r]=t,o=new Path2D;o.rect(s,i,n-s,r-i),this.ctx.clip(o),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||Dc("TODO: Support non-isolated groups."),e.knockout&&Y("Knockout groups not supported.");const s=xt(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=Xr.slice();V.axialAlignedBoundingBox(e.bbox,xt(t),i);const n=[0,0,t.canvas.width,t.canvas.height];i=V.intersect(i,n)||[0,0,0,0];const r=Math.floor(i[0]),o=Math.floor(i[1]),l=Math.max(Math.ceil(i[2])-r,1),h=Math.max(Math.ceil(i[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,h]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(d,l,h),f=u.context;f.translate(-r,-o),f.transform(...s);let p=new Path2D;const[v,g,A,w]=e.bbox;if(p.rect(v,g,A-v,w-g),e.matrix){const S=new Path2D;S.addPath(p,new DOMMatrix(e.matrix)),p=S}f.clip(p),e.smask?this.smaskStack.push({canvas:u.canvas,context:f,offsetX:r,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(r,o),t.save()),ro(t,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const i=xt(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);const n=Xr.slice();V.axialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],i,n),this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(e,t,s,i,n){if(y(this,ys,Ed).call(this),Ah(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const r=t[2]-t[0],o=t[3]-t[1];if(n&&this.annotationCanvasMap){s=s.slice(),s[4]-=t[0],s[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=r,t[3]=o,V.singularValueDecompose2dScale(xt(this.ctx),je);const{viewportScale:l}=this,h=Math.ceil(r*this.outputScaleX*l),d=Math.ceil(o*this.outputScaleY*l);this.annotationCanvas=this.canvasFactory.create(h,d);const{canvas:u,context:f}=this.annotationCanvas;this.annotationCanvasMap.set(e,u),this.annotationCanvas.savedCtx=this.ctx,this.ctx=f,this.ctx.save(),this.ctx.setTransform(je[0],0,0,-je[1],0,o*je[1]),Ah(this.ctx)}else{Ah(this.ctx),this.endPath();const l=new Path2D;l.rect(t[0],t[1],r,o),this.ctx.clip(l)}}this.current=new Ju(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),y(this,ys,Sd).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const s=this.ctx,i=this._createMaskCanvas(e),n=i.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(n,i.offsetX,i.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s=0,i=0,n,r){if(!this.contentVisible)return;e=this.getObject(e.data,e);const o=this.ctx;o.save();const l=xt(o);o.transform(t,s,i,n,0,0);const h=this._createMaskCanvas(e);o.setTransform(1,0,0,1,h.offsetX-l[4],h.offsetY-l[5]);for(let d=0,u=r.length;d<u;d+=2){const f=V.transform(l,[t,s,i,n,r[d],r[d+1]]);o.drawImage(h.canvas,f[4],f[5])}o.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,s=this.current.fillColor,i=this.current.patternFill;for(const n of e){const{data:r,width:o,height:l,transform:h}=n,d=this.cachedCanvases.getCanvas("maskCanvas",o,l),u=d.context;u.save();const f=this.getObject(r,n);qu(u,f),u.globalCompositeOperation="source-in",u.fillStyle=i?s.getPattern(u,this,ws(t),Zt.FILL):s,u.fillRect(0,0,o,l),u.restore(),t.save(),t.transform(...h),t.scale(1,-1),yh(t,d.canvas,0,0,o,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){Y("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,s,i){if(!this.contentVisible)return;const n=this.getObject(e);if(!n){Y("Dependent image isn't ready yet");return}const r=n.width,o=n.height,l=[];for(let h=0,d=i.length;h<d;h+=2)l.push({transform:[t,0,0,s,i[h],i[h+1]],x:0,y:0,w:r,h:o});this.paintInlineImageXObjectGroup(n,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:i}=e,n=this.cachedCanvases.getCanvas("inlineImage",s,i),r=n.context;return r.filter=this.current.transferMaps,r.drawImage(t,0,0),r.filter="none",n.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,s=e.height,i=this.ctx;this.save();const{filter:n}=i;n!=="none"&&n!==""&&(i.filter="none"),i.scale(1/t,-1/s);let r;if(e.bitmap)r=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)r=e;else{const h=this.cachedCanvases.getCanvas("inlineImage",t,s).context;Zu(h,e),r=this.applyTransferMapsToCanvas(h)}const o=this._scaleImage(r,ws(i));i.imageSmoothingEnabled=tf(xt(i),e.interpolate),yh(i,o.img,0,0,o.paintWidth,o.paintHeight,0,-s,t,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const s=this.ctx;let i;if(e.bitmap)i=e.bitmap;else{const n=e.width,r=e.height,l=this.cachedCanvases.getCanvas("inlineImage",n,r).context;Zu(l,e),i=this.applyTransferMapsToCanvas(l)}for(const n of t)s.save(),s.transform(...n.transform),s.scale(1,-1),yh(s,i,n.x,n.y,n.w,n.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e,t){const s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);const i=this.ctx;this.pendingClip&&(s||(this.pendingClip===ef?i.clip(e,"evenodd"):i.clip(e)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=xt(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:i,d:n}=this.ctx.getTransform();let r,o;if(s===0&&i===0){const l=Math.abs(t),h=Math.abs(n);if(l===h)if(e===0)r=o=1/l;else{const d=l*e;r=o=d<1?1/d:1}else if(e===0)r=1/l,o=1/h;else{const d=l*e,u=h*e;r=d<1?1/d:1,o=u<1?1/u:1}}else{const l=Math.abs(t*n-s*i),h=Math.hypot(t,s),d=Math.hypot(i,n);if(e===0)r=d/l,o=h/l;else{const u=e*l;r=d>u?d/u:1,o=h>u?h/u:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:s,current:{lineWidth:i}}=this,[n,r]=this.getScaleForStroking();if(n===r){s.lineWidth=(i||1)*n,s.stroke(e);return}const o=s.getLineDash();t&&s.save(),s.scale(n,r),zc.a=1/n,zc.d=1/r;const l=new Path2D;if(l.addPath(e,zc),o.length>0){const h=Math.max(n,r);s.setLineDash(o.map(d=>d/h)),s.lineDashOffset/=h}s.lineWidth=i||1,s.stroke(l),t&&s.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};ys=new WeakSet,Ed=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Sd=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},xd=function(e,t,s){const i=new Path2D;return i.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),i};let Qr=Ou;for(const c in ec)Qr.prototype[c]!==void 0&&(Qr.prototype[ec[c]]=Qr.prototype[c]);var rl,al;class $s{static get workerPort(){return a(this,rl)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");m(this,rl,e)}static get workerSrc(){return a(this,al)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");m(this,al,e)}}rl=new WeakMap,al=new WeakMap,b($s,rl,null),b($s,al,"");var ga,ol;class $m{constructor({parsedData:e,rawData:t}){b(this,ga);b(this,ol);m(this,ga,e),m(this,ol,t)}getRaw(){return a(this,ol)}get(e){return a(this,ga).get(e)??null}[Symbol.iterator](){return a(this,ga).entries()}}ga=new WeakMap,ol=new WeakMap;const Gr=Symbol("INTERNAL");var ll,hl,cl,ma;class jm{constructor(e,{name:t,intent:s,usage:i,rbGroups:n}){b(this,ll,!1);b(this,hl,!1);b(this,cl,!1);b(this,ma,!0);m(this,ll,!!(e&$e.DISPLAY)),m(this,hl,!!(e&$e.PRINT)),this.name=t,this.intent=s,this.usage=i,this.rbGroups=n}get visible(){if(a(this,cl))return a(this,ma);if(!a(this,ma))return!1;const{print:e,view:t}=this.usage;return a(this,ll)?(t==null?void 0:t.viewState)!=="OFF":a(this,hl)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==Gr&&dt("Internal method `_setVisible` called."),m(this,cl,s),m(this,ma,t)}}ll=new WeakMap,hl=new WeakMap,cl=new WeakMap,ma=new WeakMap;var Qi,ht,va,ba,dl,Td;class Um{constructor(e,t=$e.DISPLAY){b(this,dl);b(this,Qi,null);b(this,ht,new Map);b(this,va,null);b(this,ba,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,m(this,ba,e.order);for(const s of e.groups)a(this,ht).set(s.id,new jm(t,s));if(e.baseState==="OFF")for(const s of a(this,ht).values())s._setVisible(Gr,!1);for(const s of e.on)a(this,ht).get(s)._setVisible(Gr,!0);for(const s of e.off)a(this,ht).get(s)._setVisible(Gr,!1);m(this,va,this.getHash())}}isVisible(e){if(a(this,ht).size===0)return!0;if(!e)return Dc("Optional content group not defined."),!0;if(e.type==="OCG")return a(this,ht).has(e.id)?a(this,ht).get(e.id).visible:(Y(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return y(this,dl,Td).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!a(this,ht).has(t))return Y(`Optional content group not found: ${t}`),!0;if(a(this,ht).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!a(this,ht).has(t))return Y(`Optional content group not found: ${t}`),!0;if(!a(this,ht).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!a(this,ht).has(t))return Y(`Optional content group not found: ${t}`),!0;if(!a(this,ht).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!a(this,ht).has(t))return Y(`Optional content group not found: ${t}`),!0;if(a(this,ht).get(t).visible)return!1}return!0}return Y(`Unknown optional content policy ${e.policy}.`),!0}return Y(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var n;const i=a(this,ht).get(e);if(!i){Y(`Optional content group not found: ${e}`);return}if(s&&t&&i.rbGroups.length)for(const r of i.rbGroups)for(const o of r)o!==e&&((n=a(this,ht).get(o))==null||n._setVisible(Gr,!1,!0));i._setVisible(Gr,!!t,!0),m(this,Qi,null)}setOCGState({state:e,preserveRB:t}){let s;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const n=a(this,ht).get(i);if(n)switch(s){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!n.visible,t);break}}m(this,Qi,null)}get hasInitialVisibility(){return a(this,va)===null||this.getHash()===a(this,va)}getOrder(){return a(this,ht).size?a(this,ba)?a(this,ba).slice():[...a(this,ht).keys()]:null}getGroup(e){return a(this,ht).get(e)||null}getHash(){if(a(this,Qi)!==null)return a(this,Qi);const e=new Vf;for(const[t,s]of a(this,ht))e.update(`${t}:${s.visible}`);return m(this,Qi,e.hexdigest())}[Symbol.iterator](){return a(this,ht).entries()}}Qi=new WeakMap,ht=new WeakMap,va=new WeakMap,ba=new WeakMap,dl=new WeakSet,Td=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let i=1;i<t;i++){const n=e[i];let r;if(Array.isArray(n))r=y(this,dl,Td).call(this,n);else if(a(this,ht).has(n))r=a(this,ht).get(n).visible;else return Y(`Optional content group not found: ${n}`),!0;switch(s){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return s==="And"};class zm{constructor(e,{disableRange:t=!1,disableStream:s=!1}){Nt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:n,progressiveDone:r,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=o,(n==null?void 0:n.length)>0){const l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,h)=>{this._onReceiveData({begin:l,chunk:h})}),e.addProgressListener((l,h)=>{this._onProgress({loaded:l,total:h})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(n){return n._begin!==e?!1:(n._enqueue(s),!0)});Nt(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,s,i,n;e.total===void 0?(s=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||s.call(t,{loaded:e.loaded}):(n=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||n.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Nt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new Gm(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Vm(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeReaders.slice(0))s.cancel(e);this._pdfDataRangeTransport.abort()}}class Gm{constructor(e,t,s=!1,i=null){this._stream=e,this._done=s||!1,this._filename=wu(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Vm{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Wm(c){let e=!0,t=s("filename\\*","i").exec(c);if(t){t=t[1];let d=o(t);return d=unescape(d),d=l(d),d=h(d),n(d)}if(t=r(c),t){const d=h(t);return n(d)}if(t=s("filename","i").exec(c),t){t=t[1];let d=o(t);return d=h(d),n(d)}function s(d,u){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function i(d,u){if(d){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const f=new TextDecoder(d,{fatal:!0}),p=ah(u);u=f.decode(p),e=!1}catch{}}return u}function n(d){return e&&/[\x80-\xff]/.test(d)&&(d=i("utf-8",d),e&&(d=i("iso-8859-1",d))),d}function r(d){const u=[];let f;const p=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(d))!==null;){let[,g,A,w]=f;if(g=parseInt(g,10),g in u){if(g===0)break;continue}u[g]=[A,w]}const v=[];for(let g=0;g<u.length&&g in u;++g){let[A,w]=u[g];w=o(w),A&&(w=unescape(w),g===0&&(w=l(w))),v.push(w)}return v.join("")}function o(d){if(d.startsWith('"')){const u=d.slice(1).split('\\"');for(let f=0;f<u.length;++f){const p=u[f].indexOf('"');p!==-1&&(u[f]=u[f].slice(0,p),u.length=f+1),u[f]=u[f].replaceAll(/\\(.)/g,"$1")}d=u.join('"')}return d}function l(d){const u=d.indexOf("'");if(u===-1)return d;const f=d.slice(0,u),v=d.slice(u+1).replace(/^[^']*'/,"");return i(f,v)}function h(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,f,p,v){if(p==="q"||p==="Q")return v=v.replaceAll("_"," "),v=v.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,A){return String.fromCharCode(parseInt(A,16))}),i(f,v);try{v=atob(v)}catch{}return i(f,v)})}return""}function ip(c,e){const t=new Headers;if(!c||!e||typeof e!="object")return t;for(const s in e){const i=e[s];i!==void 0&&t.append(s,i)}return t}function Fc(c){var e;return((e=URL.parse(c))==null?void 0:e.origin)??null}function np({responseHeaders:c,isHttp:e,rangeChunkSize:t,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(c.get("Content-Length"),10);return!Number.isInteger(n)||(i.suggestedLength=n,n<=2*t)||s||!e||c.get("Accept-Ranges")!=="bytes"||(c.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function rp(c){const e=c.get("Content-Disposition");if(e){let t=Wm(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(wu(t))return t}return null}function ch(c,e){return new sc(`Unexpected server response (${c}) while retrieving PDF "${e}".`,c,c===404||c===0&&e.startsWith("file:"))}function ap(c){return c===200||c===206}function op(c,e,t){return{method:"GET",headers:c,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function lp(c){return c instanceof Uint8Array?c.buffer:c instanceof ArrayBuffer?c:(Y(`getArrayBuffer - unexpected data format: ${c}`),new Uint8Array(c).buffer)}class Xm{constructor(e){O(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=ip(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Nt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Ym(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Km(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class Ym{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),i=t.url;fetch(i,op(s,this._withCredentials,this._abortController)).then(n=>{if(e._responseOrigin=Fc(n.url),!ap(n.status))throw ch(n.status,i);this._reader=n.body.getReader(),this._headersCapability.resolve();const r=n.headers,{allowRangeRequests:o,suggestedLength:l}=np({responseHeaders:r,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=rp(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new yn("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:lp(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class Km{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const n=new Headers(e.headers);n.append("Range",`bytes=${t}-${s-1}`);const r=i.url;fetch(r,op(n,this._withCredentials,this._abortController)).then(o=>{const l=Fc(o.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!ap(o.status))throw ch(o.status,r);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:lp(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const Gc=200,Vc=206;function Qm(c){const e=c.response;return typeof e!="string"?e:ah(e).buffer}class Jm{constructor({url:e,httpHeaders:t,withCredentials:s}){O(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=ip(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[n,r]of this.headers)t.setRequestHeader(n,r);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=Vc):i.expectedStatus=Gc,t.responseType="arraybuffer",Nt(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){var i;const s=this.pendingRequests[e];s&&((i=s.onProgress)==null||i.call(s,t))}onStateChange(e,t){const s=this.pendingRequests[e];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){s.onError(i.status);return}const n=i.status||Gc;if(!(n===Gc&&s.expectedStatus===Vc)&&n!==s.expectedStatus){s.onError(i.status);return}const o=Qm(i);if(n===Vc){const l=i.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);h?s.onDone({begin:parseInt(h[1],10),chunk:o}):(Y('Missing or invalid "Content-Range" header.'),s.onError(0))}else o?s.onDone({begin:0,chunk:o}):s.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class Zm{constructor(e){this._source=e,this._manager=new Jm(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Nt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new qm(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new tv(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class qm{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=Fc(t.responseURL);const s=t.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...h]=o.split(": ");return[l,h.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:r}=np({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=rp(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=ch(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class tv{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=Fc((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=ch(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const ev=/^[a-z][a-z0-9\-+.]+:/i;function sv(c){if(ev.test(c))return new URL(c);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(c))}class iv{constructor(e){this.source=e,this.url=sv(e.url),Nt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Nt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new nv(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new rv(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class nv{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=ch(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new yn("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class rv{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const ao=Symbol("INITIAL_DATA");var Me,ul,Cd;class hp{constructor(){b(this,ul);b(this,Me,Object.create(null))}get(e,t=null){if(t){const i=y(this,ul,Cd).call(this,e);return i.promise.then(()=>t(i.data)),null}const s=a(this,Me)[e];if(!s||s.data===ao)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=a(this,Me)[e];return!!t&&t.data!==ao}delete(e){const t=a(this,Me)[e];return!t||t.data===ao?!1:(delete a(this,Me)[e],!0)}resolve(e,t=null){const s=y(this,ul,Cd).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in a(this,Me)){const{data:s}=a(this,Me)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}m(this,Me,Object.create(null))}*[Symbol.iterator](){for(const e in a(this,Me)){const{data:t}=a(this,Me)[e];t!==ao&&(yield[e,t])}}}Me=new WeakMap,ul=new WeakSet,Cd=function(e){var t;return(t=a(this,Me))[e]||(t[e]={...Promise.withResolvers(),data:ao})};const av=1e5,sf=30;var lf,Ji,Se,fl,pl,Zn,ai,gl,ml,qn,ya,Aa,Zi,wa,vl,Ea,tr,bl,yl,Sa,er,Al,qi,xa,Ri,cp,dp,Rd,ze,Fh,Id,up,fp;const kt=class kt{constructor({textContentSource:e,container:t,viewport:s}){b(this,Ri);b(this,Ji,Promise.withResolvers());b(this,Se,null);b(this,fl,!1);b(this,pl,!!((lf=globalThis.FontInspector)!=null&&lf.enabled));b(this,Zn,null);b(this,ai,null);b(this,gl,0);b(this,ml,0);b(this,qn,null);b(this,ya,null);b(this,Aa,0);b(this,Zi,0);b(this,wa,Object.create(null));b(this,vl,[]);b(this,Ea,null);b(this,tr,[]);b(this,bl,new WeakMap);b(this,yl,null);var l;if(e instanceof ReadableStream)m(this,Ea,e);else if(typeof e=="object")m(this,Ea,new ReadableStream({start(h){h.enqueue(e),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');m(this,Se,m(this,ya,t)),m(this,Zi,s.scale*js.pixelRatio),m(this,Aa,s.rotation),m(this,ai,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:n,pageX:r,pageY:o}=s.rawDims;m(this,yl,[1,0,0,-1,-r,o+n]),m(this,ml,i),m(this,gl,n),y(l=kt,ze,up).call(l),Fr(t,s),a(this,Ji).promise.finally(()=>{a(kt,xa).delete(this),m(this,ai,null),m(this,wa,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=ee.platform;return tt(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{a(this,qn).read().then(({value:t,done:s})=>{if(s){a(this,Ji).resolve();return}a(this,Zn)??m(this,Zn,t.lang),Object.assign(a(this,wa),t.styles),y(this,Ri,cp).call(this,t.items),e()},a(this,Ji).reject)};return m(this,qn,a(this,Ea).getReader()),a(kt,xa).add(this),e(),a(this,Ji).promise}update({viewport:e,onBefore:t=null}){var n;const s=e.scale*js.pixelRatio,i=e.rotation;if(i!==a(this,Aa)&&(t==null||t(),m(this,Aa,i),Fr(a(this,ya),{rotation:i})),s!==a(this,Zi)){t==null||t(),m(this,Zi,s);const r={div:null,properties:null,ctx:y(n=kt,ze,Fh).call(n,a(this,Zn))};for(const o of a(this,tr))r.properties=a(this,bl).get(o),r.div=o,y(this,Ri,Rd).call(this,r)}}cancel(){var t;const e=new yn("TextLayer task cancelled.");(t=a(this,qn))==null||t.cancel(e).catch(()=>{}),m(this,qn,null),a(this,Ji).reject(e)}get textDivs(){return a(this,tr)}get textContentItemsStr(){return a(this,vl)}static cleanup(){if(!(a(this,xa).size>0)){a(this,Sa).clear();for(const{canvas:e}of a(this,er).values())e.remove();a(this,er).clear()}}};Ji=new WeakMap,Se=new WeakMap,fl=new WeakMap,pl=new WeakMap,Zn=new WeakMap,ai=new WeakMap,gl=new WeakMap,ml=new WeakMap,qn=new WeakMap,ya=new WeakMap,Aa=new WeakMap,Zi=new WeakMap,wa=new WeakMap,vl=new WeakMap,Ea=new WeakMap,tr=new WeakMap,bl=new WeakMap,yl=new WeakMap,Sa=new WeakMap,er=new WeakMap,Al=new WeakMap,qi=new WeakMap,xa=new WeakMap,Ri=new WeakSet,cp=function(e){var i,n;if(a(this,fl))return;(n=a(this,ai)).ctx??(n.ctx=y(i=kt,ze,Fh).call(i,a(this,Zn)));const t=a(this,tr),s=a(this,vl);for(const r of e){if(t.length>av){Y("Ignoring additional textDivs for performance reasons."),m(this,fl,!0);return}if(r.str===void 0){if(r.type==="beginMarkedContentProps"||r.type==="beginMarkedContent"){const o=a(this,Se);m(this,Se,document.createElement("span")),a(this,Se).classList.add("markedContent"),r.id!==null&&a(this,Se).setAttribute("id",`${r.id}`),o.append(a(this,Se))}else r.type==="endMarkedContent"&&m(this,Se,a(this,Se).parentNode);continue}s.push(r.str),y(this,Ri,dp).call(this,r)}},dp=function(e){var g;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};a(this,tr).push(t);const i=V.transform(a(this,yl),e.transform);let n=Math.atan2(i[1],i[0]);const r=a(this,wa)[e.fontName];r.vertical&&(n+=Math.PI/2);let o=a(this,pl)&&r.fontSubstitution||r.fontFamily;o=kt.fontFamilyMap.get(o)||o;const l=Math.hypot(i[2],i[3]),h=l*y(g=kt,ze,fp).call(g,o,r,a(this,Zn));let d,u;n===0?(d=i[4],u=i[5]-h):(d=i[4]+h*Math.sin(n),u=i[5]-h*Math.cos(n));const f="calc(var(--total-scale-factor) *",p=t.style;a(this,Se)===a(this,ya)?(p.left=`${(100*d/a(this,ml)).toFixed(2)}%`,p.top=`${(100*u/a(this,gl)).toFixed(2)}%`):(p.left=`${f}${d.toFixed(2)}px)`,p.top=`${f}${u.toFixed(2)}px)`),p.fontSize=`${f}${(a(kt,qi)*l).toFixed(2)}px)`,p.fontFamily=o,s.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,a(this,pl)&&(t.dataset.fontName=r.fontSubstitutionLoadedName||e.fontName),n!==0&&(s.angle=n*(180/Math.PI));let v=!1;if(e.str.length>1)v=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const A=Math.abs(e.transform[0]),w=Math.abs(e.transform[3]);A!==w&&Math.max(A,w)/Math.min(A,w)>1.5&&(v=!0)}if(v&&(s.canvasWidth=r.vertical?e.height:e.width),a(this,bl).set(t,s),a(this,ai).div=t,a(this,ai).properties=s,y(this,Ri,Rd).call(this,a(this,ai)),s.hasText&&a(this,Se).append(t),s.hasEOL){const A=document.createElement("br");A.setAttribute("role","presentation"),a(this,Se).append(A)}},Rd=function(e){var o;const{div:t,properties:s,ctx:i}=e,{style:n}=t;let r="";if(a(kt,qi)>1&&(r=`scale(${1/a(kt,qi)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:l}=n,{canvasWidth:h,fontSize:d}=s;y(o=kt,ze,Id).call(o,i,d*a(this,Zi),l);const{width:u}=i.measureText(t.textContent);u>0&&(r=`scaleX(${h*a(this,Zi)/u}) ${r}`)}s.angle!==0&&(r=`rotate(${s.angle}deg) ${r}`),r.length>0&&(n.transform=r)},ze=new WeakSet,Fh=function(e=null){let t=a(this,er).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),a(this,er).set(e,t),a(this,Al).set(t,{size:0,family:""})}return t},Id=function(e,t,s){const i=a(this,Al).get(e);t===i.size&&s===i.family||(e.font=`${t}px ${s}`,i.size=t,i.family=s)},up=function(){if(a(this,qi)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),m(this,qi,e.getBoundingClientRect().height),e.remove()},fp=function(e,t,s){const i=a(this,Sa).get(e);if(i)return i;const n=y(this,ze,Fh).call(this,s);n.canvas.width=n.canvas.height=sf,y(this,ze,Id).call(this,n,sf,e);const r=n.measureText(""),o=r.fontBoundingBoxAscent,l=Math.abs(r.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let h=.8;return o?h=o/(o+l):(ee.platform.isFirefox&&Y("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?h=t.ascent:t.descent&&(h=1+t.descent)),a(this,Sa).set(e,h),h},b(kt,ze),b(kt,Sa,new Map),b(kt,er,new Map),b(kt,Al,new WeakMap),b(kt,qi,null),b(kt,xa,new Set);let Mo=kt;class Lo{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function i(n){var l;if(!n)return;let r=null;const o=n.name;if(o==="#text")r=n.value;else if(Lo.shouldBuildText(o))(l=n==null?void 0:n.attributes)!=null&&l.textContent?r=n.attributes.textContent:n.value&&(r=n.value);else return;if(r!==null&&t.push({str:r}),!!n.children)for(const h of n.children)i(h)}return i(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const ov=100;function Pd(c={}){typeof c=="string"||c instanceof URL?c={url:c}:(c instanceof ArrayBuffer||ArrayBuffer.isView(c))&&(c={data:c});const e=new Md,{docId:t}=e,s=c.url?mm(c.url):null,i=c.data?vm(c.data):null,n=c.httpHeaders||null,r=c.withCredentials===!0,o=c.password??null,l=c.range instanceof pp?c.range:null,h=Number.isInteger(c.rangeChunkSize)&&c.rangeChunkSize>0?c.rangeChunkSize:2**16;let d=c.worker instanceof Oo?c.worker:null;const u=c.verbosity,f=typeof c.docBaseUrl=="string"&&!Nc(c.docBaseUrl)?c.docBaseUrl:null,p=vh(c.cMapUrl),v=c.cMapPacked!==!1,g=c.CMapReaderFactory||(ge?Tm:Gu),A=vh(c.iccUrl),w=vh(c.standardFontDataUrl),S=c.StandardFontDataFactory||(ge?Cm:Vu),E=vh(c.wasmUrl),T=c.WasmFactory||(ge?Rm:Wu),x=c.stopAtErrors!==!0,C=Number.isInteger(c.maxImageSize)&&c.maxImageSize>-1?c.maxImageSize:-1,R=c.isEvalSupported!==!1,I=typeof c.isOffscreenCanvasSupported=="boolean"?c.isOffscreenCanvasSupported:!ge,P=typeof c.isImageDecoderSupported=="boolean"?c.isImageDecoderSupported:!ge&&(ee.platform.isFirefox||!globalThis.chrome),M=Number.isInteger(c.canvasMaxAreaInBytes)?c.canvasMaxAreaInBytes:-1,D=typeof c.disableFontFace=="boolean"?c.disableFontFace:ge,G=c.fontExtraProperties===!0,U=c.enableXfa===!0,W=c.ownerDocument||globalThis.document,pt=c.disableRange===!0,F=c.disableStream===!0,k=c.disableAutoFetch===!0,at=c.pdfBug===!0,le=c.CanvasFactory||(ge?xm:wm),ye=c.FilterFactory||(ge?Sm:Em),Ge=c.enableHWA===!0,Mt=c.useWasm!==!1,vt=l?l.length:c.length??NaN,Pi=typeof c.useSystemFonts=="boolean"?c.useSystemFonts:!ge&&!D,As=typeof c.useWorkerFetch=="boolean"?c.useWorkerFetch:!!(g===Gu&&S===Vu&&T===Wu&&p&&w&&E&&ho(p,document.baseURI)&&ho(w,document.baseURI)&&ho(E,document.baseURI)),j=null;Yg(u);const L={canvasFactory:new le({ownerDocument:W,enableHWA:Ge}),filterFactory:new ye({docId:t,ownerDocument:W}),cMapReaderFactory:As?null:new g({baseUrl:p,isCompressed:v}),standardFontDataFactory:As?null:new S({baseUrl:w}),wasmFactory:As?null:new T({baseUrl:E})};d||(d=Oo.create({verbosity:u,port:$s.workerPort}),e._worker=d);const _={docId:t,apiVersion:"5.3.31",data:i,password:o,disableAutoFetch:k,rangeChunkSize:h,length:vt,docBaseUrl:f,enableXfa:U,evaluatorOptions:{maxImageSize:C,disableFontFace:D,ignoreErrors:x,isEvalSupported:R,isOffscreenCanvasSupported:I,isImageDecoderSupported:P,canvasMaxAreaInBytes:M,fontExtraProperties:G,useSystemFonts:Pi,useWasm:Mt,useWorkerFetch:As,cMapUrl:p,iccUrl:A,standardFontDataUrl:w,wasmUrl:E}},Z={ownerDocument:W,pdfBug:at,styleElement:j,loadingParams:{disableAutoFetch:k,enableXfa:U}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const bt=d.messageHandler.sendWithPromise("GetDocRequest",_,i?[i.buffer]:null);let Ct;if(l)Ct=new zm(l,{disableRange:pt,disableStream:F});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const Mi=ho(s)?Xm:ge?iv:Zm;Ct=new Mi({url:s,length:vt,httpHeaders:n,withCredentials:r,rangeChunkSize:h,disableRange:pt,disableStream:F})}return bt.then(Mi=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const Li=new go(t,Mi,d.port),io=new cv(Li,e,Ct,Z,L);e._transport=io,Li.send("Ready",null)})}).catch(e._capability.reject),e}var yc;const Ac=class Ac{constructor(){O(this,"_capability",Promise.withResolvers());O(this,"_transport",null);O(this,"_worker",null);O(this,"docId",`d${he(Ac,yc)._++}`);O(this,"destroyed",!1);O(this,"onPassword",null);O(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,s,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(n){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,n}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}async getData(){return this._transport.getData()}};yc=new WeakMap,b(Ac,yc,0);let Md=Ac;var sr,wl,El,Sl,xl;class pp{constructor(e,t,s=!1,i=null){b(this,sr,Promise.withResolvers());b(this,wl,[]);b(this,El,[]);b(this,Sl,[]);b(this,xl,[]);this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(e){a(this,xl).push(e)}addProgressListener(e){a(this,Sl).push(e)}addProgressiveReadListener(e){a(this,El).push(e)}addProgressiveDoneListener(e){a(this,wl).push(e)}onDataRange(e,t){for(const s of a(this,xl))s(e,t)}onDataProgress(e,t){a(this,sr).promise.then(()=>{for(const s of a(this,Sl))s(e,t)})}onDataProgressiveRead(e){a(this,sr).promise.then(()=>{for(const t of a(this,El))t(e)})}onDataProgressiveDone(){a(this,sr).promise.then(()=>{for(const e of a(this,wl))e()})}transportReady(){a(this,sr).resolve()}requestDataRange(e,t){dt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}sr=new WeakMap,wl=new WeakMap,El=new WeakMap,Sl=new WeakMap,xl=new WeakMap;class lv{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return tt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var oi,ir,Ao;class hv{constructor(e,t,s,i=!1){b(this,ir);b(this,oi,!1);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=i?new ju:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new hp,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:n=!1}={}){return new lh({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:n})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return tt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:s="display",annotationMode:i=Ni.ENABLE,transform:n=null,background:r=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:h=null,printAnnotationStorage:d=null,isEditing:u=!1}){var T,x;(T=this._stats)==null||T.time("Overall");const f=this._transport.getRenderingIntent(s,i,d,u),{renderingIntent:p,cacheKey:v}=f;m(this,oi,!1),o||(o=this._transport.getOptionalContentConfig(p));let g=this._intentStates.get(v);g||(g=Object.create(null),this._intentStates.set(v,g)),g.streamReaderCancelTimeout&&(clearTimeout(g.streamReaderCancelTimeout),g.streamReaderCancelTimeout=null);const A=!!(p&$e.PRINT);g.displayReadyCapability||(g.displayReadyCapability=Promise.withResolvers(),g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(x=this._stats)==null||x.time("Page Request"),this._pumpOperatorList(f));const w=C=>{var R;g.renderTasks.delete(S),A&&m(this,oi,!0),y(this,ir,Ao).call(this),C?(S.capability.reject(C),this._abortOperatorList({intentState:g,reason:C instanceof Error?C:new Error(C)})):S.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(R=globalThis.Stats)!=null&&R.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},S=new Ld({callback:w,params:{canvasContext:e,viewport:t,transform:n,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:g.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!A,pdfBug:this._pdfBug,pageColors:h});(g.renderTasks||(g.renderTasks=new Set)).add(S);const E=S.task;return Promise.all([g.displayReadyCapability.promise,o]).then(([C,R])=>{var I;if(this.destroyed){w();return}if((I=this._stats)==null||I.time("Rendering"),!(R.renderingIntent&p))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");S.initializeGraphics({transparency:C,optionalContentConfig:R}),S.operatorListChanged()}).catch(w),E}getOperatorList({intent:e="display",annotationMode:t=Ni.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var h;function n(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const r=this._transport.getRenderingIntent(e,t,s,i,!0);let o=this._intentStates.get(r.cacheKey);o||(o=Object.create(null),this._intentStates.set(r.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(h=this._stats)==null||h.time("Page Request"),this._pumpOperatorList(r)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>Lo.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,i){function n(){r.read().then(function({value:l,done:h}){if(h){s(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),n()},i)}const r=t.getReader(),o={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),m(this,oi,!1),Promise.all(e)}cleanup(e=!1){m(this,oi,!0);const t=y(this,ir,Ao).call(this);return e&&t&&this._stats&&(this._stats=new ju),t}_startRenderPage(e,t){var i,n;const s=this._intentStates.get(t);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(n=s.displayReadyCapability)==null||n.resolve(e))}_renderPageChunk(e,t){for(let s=0,i=e.length;s<i;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&y(this,ir,Ao).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:i}){const{map:n,transfer:r}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:n,modifiedIds:i},r).getReader(),h=this._intentStates.get(t);h.streamReader=l;const d=()=>{l.read().then(({value:u,done:f})=>{if(f){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,h),d())},u=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const f of h.renderTasks)f.operatorListChanged();y(this,ir,Ao).call(this)}if(h.displayReadyCapability)h.displayReadyCapability.reject(u);else if(h.opListReadCapability)h.opListReadCapability.reject(u);else throw u}})};d()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof Au){let i=ov;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new yn(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,n]of this._intentStates)if(n===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}oi=new WeakMap,ir=new WeakSet,Ao=function(){if(!a(this,oi)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),m(this,oi,!1),!0};var tn,os,li,nr,wc,rr,ar,ve,kh,gp,mp,wo,Ta,_h;const At=class At{constructor({name:e=null,port:t=null,verbosity:s=Kg()}={}){b(this,ve);b(this,tn,Promise.withResolvers());b(this,os,null);b(this,li,null);b(this,nr,null);if(this.name=e,this.destroyed=!1,this.verbosity=s,t){if(a(At,ar).has(t))throw new Error("Cannot use more than one PDFWorker per port.");a(At,ar).set(t,this),y(this,ve,gp).call(this,t)}else y(this,ve,mp).call(this)}get promise(){return a(this,tn).promise}get port(){return a(this,li)}get messageHandler(){return a(this,os)}destroy(){var e,t;this.destroyed=!0,(e=a(this,nr))==null||e.terminate(),m(this,nr,null),a(At,ar).delete(a(this,li)),m(this,li,null),(t=a(this,os))==null||t.destroy(),m(this,os,null)}static create(e){const t=a(this,ar).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new At(e)}static get workerSrc(){if($s.workerSrc)return $s.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return tt(this,"_setupFakeWorkerGlobal",(async()=>a(this,Ta,_h)?a(this,Ta,_h):(await import(this.workerSrc)).WorkerMessageHandler)())}};tn=new WeakMap,os=new WeakMap,li=new WeakMap,nr=new WeakMap,wc=new WeakMap,rr=new WeakMap,ar=new WeakMap,ve=new WeakSet,kh=function(){a(this,tn).resolve(),a(this,os).send("configure",{verbosity:this.verbosity})},gp=function(e){m(this,li,e),m(this,os,new go("main","worker",e)),a(this,os).on("ready",()=>{}),y(this,ve,kh).call(this)},mp=function(){if(a(At,rr)||a(At,Ta,_h)){y(this,ve,wo).call(this);return}let{workerSrc:e}=At;try{At._isSameOrigin(window.location,e)||(e=At._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new go("main","worker",t),i=()=>{n.abort(),s.destroy(),t.terminate(),this.destroyed?a(this,tn).reject(new Error("Worker was destroyed")):y(this,ve,wo).call(this)},n=new AbortController;t.addEventListener("error",()=>{a(this,nr)||i()},{signal:n.signal}),s.on("test",o=>{if(n.abort(),this.destroyed||!o){i();return}m(this,os,s),m(this,li,t),m(this,nr,t),y(this,ve,kh).call(this)}),s.on("ready",o=>{if(n.abort(),this.destroyed){i();return}try{r()}catch{y(this,ve,wo).call(this)}});const r=()=>{const o=new Uint8Array;s.send("test",o,[o.buffer])};r();return}catch{Dc("The worker has been disabled.")}y(this,ve,wo).call(this)},wo=function(){a(At,rr)||(Y("Setting up fake worker."),m(At,rr,!0)),At._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){a(this,tn).reject(new Error("Worker was destroyed"));return}const t=new Am;m(this,li,t);const s=`fake${he(At,wc)._++}`,i=new go(s+"_worker",s,t);e.setup(i,t),m(this,os,new go(s,s+"_worker",t)),y(this,ve,kh).call(this)}).catch(e=>{a(this,tn).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},Ta=new WeakSet,_h=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},b(At,Ta),b(At,wc,0),b(At,rr,!1),b(At,ar,new WeakMap),ge&&(m(At,rr,!0),$s.workerSrc||($s.workerSrc="./pdf.worker.mjs")),At._isSameOrigin=(e,t)=>{const s=URL.parse(e);if(!(s!=null&&s.origin)||s.origin==="null")return!1;const i=new URL(t,s);return s.origin===i.origin},At._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},At.fromPort=e=>{if(om("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return At.create(e)};let Oo=At;var hi,Ds,Ca,Ra,ci,or,Eo;class cv{constructor(e,t,s,i,n){b(this,or);b(this,hi,new Map);b(this,Ds,new Map);b(this,Ca,new Map);b(this,Ra,new Map);b(this,ci,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new hp,this.fontLoader=new pm({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return tt(this,"annotationStorage",new xu)}getRenderingIntent(e,t=Ni.ENABLE,s=null,i=!1,n=!1){let r=$e.DISPLAY,o=md;switch(e){case"any":r=$e.ANY;break;case"display":break;case"print":r=$e.PRINT;break;default:Y(`getRenderingIntent - invalid intent: ${e}`)}const l=r&$e.PRINT&&s instanceof Xf?s:this.annotationStorage;switch(t){case Ni.DISABLE:r+=$e.ANNOTATIONS_DISABLE;break;case Ni.ENABLE:break;case Ni.ENABLE_FORMS:r+=$e.ANNOTATIONS_FORMS;break;case Ni.ENABLE_STORAGE:r+=$e.ANNOTATIONS_STORAGE,o=l.serializable;break;default:Y(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(r+=$e.IS_EDITING),n&&(r+=$e.OPLIST);const{ids:h,hash:d}=l.modifiedIds,u=[r,o.hash,d];return{renderingIntent:r,cacheKey:u.join("_"),annotationStorageSerializable:o,modifiedIds:h}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=a(this,ci))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of a(this,Ds).values())e.push(i._destroy());a(this,Ds).clear(),a(this,Ca).clear(),a(this,Ra).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,n;this.commonObjs.clear(),this.fontLoader.clear(),a(this,hi).clear(),this.filterFactory.destroy(),Mo.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new yn("Worker was terminated.")),(n=this.messageHandler)==null||n.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,i)=>{Nt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},i.onPull=()=>{this._fullReader.read().then(function({value:n,done:r}){if(r){i.close();return}Nt(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{i.error(n)})},i.onCancel=n=>{this._fullReader.cancel(n),i.ready.catch(r=>{if(!this.destroyed)throw r})}}),e.on("ReaderHeadersReady",async s=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:n,contentLength:r}=this._fullReader;return(!i||!n)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var h;(h=t.onProgress)==null||h.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:i,isRangeSupported:n,contentLength:r}}),e.on("GetRangeReader",(s,i)=>{Nt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(s.begin,s.end);if(!n){i.close();return}i.onPull=()=>{n.read().then(function({value:r,done:o}){if(o){i.close();return}Nt(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{n.cancel(r),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new lv(s,this))}),e.on("DocException",s=>{t._capability.reject(Ae(s))}),e.on("PasswordRequest",s=>{m(this,ci,Promise.withResolvers());try{if(!t.onPassword)throw Ae(s);const i=n=>{n instanceof Error?a(this,ci).reject(n):a(this,ci).resolve({password:n})};t.onPassword(i,s.code)}catch(i){a(this,ci).reject(i)}return a(this,ci).promise}),e.on("DataLoaded",s=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;a(this,Ds).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,i,n])=>{var r;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in n){const d=n.error;Y(`Error during font loading: ${d}`),this.commonObjs.resolve(s,d);break}const o=this._params.pdfBug&&((r=globalThis.FontInspector)!=null&&r.enabled)?(d,u)=>globalThis.FontInspector.fontAdded(d,u):null,l=new gm(n,o);this.fontLoader.bind(l).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!l.fontExtraProperties&&l.data&&(l.data=null),this.commonObjs.resolve(s,l)});break;case"CopyLocalImage":const{imageRef:h}=n;Nt(h,"The imageRef must be defined.");for(const d of a(this,Ds).values())for(const[,u]of d.objs)if((u==null?void 0:u.ref)===h)return u.dataLen?(this.commonObjs.resolve(s,structuredClone(u)),u.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,n);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([s,i,n,r])=>{var l;if(this.destroyed)return;const o=a(this,Ds).get(i);if(!o.objs.has(s)){if(o._intentStates.size===0){(l=r==null?void 0:r.bitmap)==null||l.close();return}switch(n){case"Image":case"Pattern":o.objs.resolve(s,r);break;default:throw new Error(`Got unknown object type ${n}`)}}}),e.on("DocProgress",s=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:s.loaded,total:s.total})}),e.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&Y("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=this._fullReader)==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=a(this,Ca).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&a(this,Ra).set(n.refStr,e);const r=new hv(t,n,this,this._params.pdfBug);return a(this,Ds).set(t,r),r});return a(this,Ca).set(t,i),i}getPageIndex(e){return vd(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return y(this,or,Eo).call(this,"GetFieldObjects")}hasJSActions(){return y(this,or,Eo).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return y(this,or,Eo).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return y(this,or,Eo).call(this,"GetOptionalContentConfig").then(t=>new Um(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=a(this,hi).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(i=>{var n,r;return{info:i[0],metadata:i[1]?new $m(i[1]):null,contentDispositionFilename:((n=this._fullReader)==null?void 0:n.filename)??null,contentLength:((r=this._fullReader)==null?void 0:r.contentLength)??null}});return a(this,hi).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of a(this,Ds).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),a(this,hi).clear(),this.filterFactory.destroy(!0),Mo.cleanup()}}cachedPageNumber(e){if(!vd(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return a(this,Ra).get(t)??null}}hi=new WeakMap,Ds=new WeakMap,Ca=new WeakMap,Ra=new WeakMap,ci=new WeakMap,or=new WeakSet,Eo=function(e,t=null){const s=a(this,hi).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise(e,t);return a(this,hi).set(e,i),i};var en;class dv{constructor(e){b(this,en,null);O(this,"onContinue",null);O(this,"onError",null);m(this,en,e)}get promise(){return a(this,en).capability.promise}cancel(e=0){a(this,en).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=a(this,en).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=a(this,en);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}en=new WeakMap;var sn,lr;const In=class In{constructor({callback:e,params:t,objs:s,commonObjs:i,annotationCanvasMap:n,operatorList:r,pageIndex:o,canvasFactory:l,filterFactory:h,useRequestAnimationFrame:d=!1,pdfBug:u=!1,pageColors:f=null}){b(this,sn,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=h,this._pdfBug=u,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new dv(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var o,l;if(this.cancelled)return;if(this._canvas){if(a(In,lr).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");a(In,lr).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:s,viewport:i,transform:n,background:r}=this.params;this.gfx=new Qr(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:i,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var s,i,n;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),a(this,sn)&&(window.cancelAnimationFrame(a(this,sn)),m(this,sn,null)),a(In,lr).delete(this._canvas),e||(e=new Au(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(n=(i=this.task).onError)==null||n.call(i,e)}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?m(this,sn,window.requestAnimationFrame(()=>{m(this,sn,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),a(In,lr).delete(this._canvas),this.callback())))}};sn=new WeakMap,lr=new WeakMap,b(In,lr,new WeakSet);let Ld=In;const uv="5.3.31",fv="47ad820d9";nt(531);function nf(c){return Math.floor(Math.max(0,Math.min(1,c))*255).toString(16).padStart(2,"0")}function oo(c){return Math.max(0,Math.min(255,255*c))}class rf{static CMYK_G([e,t,s,i]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=oo(e),[e,e,e]}static G_HTML([e]){const t=nf(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(oo)}static RGB_HTML(e){return`#${e.map(nf).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,s+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,s,i]){return[oo(1-Math.min(1,e+i)),oo(1-Math.min(1,s+i)),oo(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const i=1-e,n=1-t,r=1-s,o=Math.min(i,n,r);return["CMYK",i,n,r,o]}}class pv{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){dt("Abstract method `_createSVG` called.")}}class rc extends pv{_createSVG(e){return document.createElementNS(zs,e)}}class vp{static setupStorage(e,t,s,i,n){const r=i.getValue(t,{value:null});switch(s.name){case"textarea":if(r.value!==null&&(e.textContent=r.value),n==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(r.value===s.attributes.xfaOn?e.setAttribute("checked",!0):r.value===s.attributes.xfaOff&&e.removeAttribute("checked"),n==="print")break;e.addEventListener("change",o=>{i.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&e.setAttribute("value",r.value),n==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})})}break;case"select":if(r.value!==null){e.setAttribute("value",r.value);for(const o of s.children)o.attributes.value===r.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const l=o.target.options,h=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:i,linkService:n}){const{attributes:r}=t,o=e instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${i}`);for(const[l,h]of Object.entries(r))if(h!=null)switch(l){case"class":h.length&&e.setAttribute(l,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!o||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,h)}o&&n.addLinkAttributes(e,r.href,r.newWindow),s&&r.dataId&&this.setupStorage(e,r.dataId,t,s)}static render(e){var u,f;const t=e.annotationStorage,s=e.linkService,i=e.xfaHtml,n=e.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:n,linkService:s});const o=n!=="richText",l=e.div;if(l.append(r),e.viewport){const p=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=p}o&&l.setAttribute("class","xfaLayer xfaFont");const h=[];if(i.children.length===0){if(i.value){const p=document.createTextNode(i.value);r.append(p),o&&Lo.shouldBuildText(i.name)&&h.push(p)}return{textDivs:h}}const d=[[i,-1,r]];for(;d.length>0;){const[p,v,g]=d.at(-1);if(v+1===p.children.length){d.pop();continue}const A=p.children[++d.at(-1)[1]];if(A===null)continue;const{name:w}=A;if(w==="#text"){const E=document.createTextNode(A.value);h.push(E),g.append(E);continue}const S=(u=A==null?void 0:A.attributes)!=null&&u.xmlns?document.createElementNS(A.attributes.xmlns,w):document.createElement(w);if(g.append(S),A.attributes&&this.setAttributes({html:S,element:A,storage:t,intent:n,linkService:s}),((f=A.children)==null?void 0:f.length)>0)d.push([A,-1,S]);else if(A.value){const E=document.createTextNode(A.value);o&&Lo.shouldBuildText(w)&&h.push(E),S.append(E)}}for(const p of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const dh=1e3,gv=9,_r=new WeakSet;class af{static create(e){switch(e.data.annotationType){case Ot.LINK:return new bp(e);case Ot.TEXT:return new mv(e);case Ot.WIDGET:switch(e.data.fieldType){case"Tx":return new vv(e);case"Btn":return e.data.radioButton?new wp(e):e.data.checkBox?new yv(e):new Av(e);case"Ch":return new wv(e);case"Sig":return new bv(e)}return new Hr(e);case Ot.POPUP:return new Dd(e);case Ot.FREETEXT:return new Cp(e);case Ot.LINE:return new Sv(e);case Ot.SQUARE:return new xv(e);case Ot.CIRCLE:return new Tv(e);case Ot.POLYLINE:return new Rp(e);case Ot.CARET:return new Rv(e);case Ot.INK:return new Ru(e);case Ot.POLYGON:return new Cv(e);case Ot.HIGHLIGHT:return new Ip(e);case Ot.UNDERLINE:return new Iv(e);case Ot.SQUIGGLY:return new Pv(e);case Ot.STRIKEOUT:return new Mv(e);case Ot.STAMP:return new Pp(e);case Ot.FILEATTACHMENT:return new Lv(e);default:return new Pt(e)}}}var hr,Ia,Pa,Tl,Od;const Du=class Du{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){b(this,Tl);b(this,hr,null);b(this,Ia,!1);b(this,Pa,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:s}){return!!(e!=null&&e.str||t!=null&&t.str||s!=null&&s.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Du._hasPopupData(this.data)}updateEdited(e){var s;if(!this.container)return;a(this,hr)||m(this,hr,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&y(this,Tl,Od).call(this,t),(s=a(this,Pa))==null||s.popup.updateEdited(e)}resetEdited(){var e;a(this,hr)&&(y(this,Tl,Od).call(this,a(this,hr).rect),(e=a(this,Pa))==null||e.popup.resetEdited(),m(this,hr,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:i}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",t.id),this instanceof Hr||(n.tabIndex=dh);const{style:r}=n;if(r.zIndex=this.parent.zIndex++,t.alternativeText&&(n.title=t.alternativeText),t.noRotate&&n.classList.add("norotate"),!t.rect||this instanceof Dd){const{rotation:g}=t;return!t.hasOwnCanvas&&g!==0&&this.setRotation(g,n),n}const{width:o,height:l}=this;if(!e&&t.borderStyle.width>0){r.borderWidth=`${t.borderStyle.width}px`;const g=t.borderStyle.horizontalCornerRadius,A=t.borderStyle.verticalCornerRadius;if(g>0||A>0){const S=`calc(${g}px * var(--total-scale-factor)) / calc(${A}px * var(--total-scale-factor))`;r.borderRadius=S}else if(this instanceof wp){const S=`calc(${o}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;r.borderRadius=S}switch(t.borderStyle.style){case $r.SOLID:r.borderStyle="solid";break;case $r.DASHED:r.borderStyle="dashed";break;case $r.BEVELED:Y("Unimplemented border style: beveled");break;case $r.INSET:Y("Unimplemented border style: inset");break;case $r.UNDERLINE:r.borderBottomStyle="solid";break}const w=t.borderColor||null;w?(m(this,Ia,!0),r.borderColor=V.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):r.borderWidth=0}const h=V.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:d,pageHeight:u,pageX:f,pageY:p}=i.rawDims;r.left=`${100*(h[0]-f)/d}%`,r.top=`${100*(h[1]-p)/u}%`;const{rotation:v}=t;return t.hasOwnCanvas||v===0?(r.width=`${100*o/d}%`,r.height=`${100*l/u}%`):this.setRotation(v,n),n}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:n,height:r}=this;e%180!==0&&([n,r]=[r,n]),t.style.width=`${100*n/s}%`,t.style.height=`${100*r/i}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,i)=>{const n=i.detail[t],r=n[0],o=n.slice(1);i.target.style[s]=rf[`${r}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[s]:rf[`${r}_rgb`](o)})};return tt(this,"_commonActions",{display:t=>{const{display:s}=t.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const i of Object.keys(t.detail)){const n=e[i]||s[i];n==null||n(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[i,n]of Object.entries(t)){const r=s[i];if(r){const o={detail:{[i]:n},target:e};r(o),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,i,n]=this.data.rect.map(g=>Math.fround(g));if(e.length===8){const[g,A,w,S]=e.subarray(2,6);if(i===g&&n===A&&t===w&&s===S)return}const{style:r}=this.container;let o;if(a(this,Ia)){const{borderColor:g,borderWidth:A}=r;r.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${A}">`],this.container.classList.add("hasBorder")}const l=i-t,h=n-s,{svgFactory:d}=this,u=d.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0);const f=d.createElement("defs");u.append(f);const p=d.createElement("clipPath"),v=`clippath_${this.data.id}`;p.setAttribute("id",v),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let g=2,A=e.length;g<A;g+=8){const w=e[g],S=e[g+1],E=e[g+2],T=e[g+3],x=d.createElement("rect"),C=(E-t)/l,R=(n-S)/h,I=(w-E)/l,P=(S-T)/h;x.setAttribute("x",C),x.setAttribute("y",R),x.setAttribute("width",I),x.setAttribute("height",P),p.append(x),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${C}" y="${R}" width="${I}" height="${P}"/>`)}a(this,Ia)&&(o.push("</g></svg>')"),r.backgroundImage=o.join("")),this.container.append(u),this.container.style.clipPath=`url(#${v})`}_createPopup(){const{data:e}=this,t=m(this,Pa,new Dd({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){dt("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:n,id:r,exportValues:o}of i){if(n===-1||r===t)continue;const l=typeof o=="string"?o:null,h=document.querySelector(`[data-element-id="${r}"]`);if(h&&!_r.has(h)){Y(`_getElementsByName - element not allowed: ${r}`);continue}s.push({id:r,exportValue:l,domElement:h})}return s}for(const i of document.getElementsByName(e)){const{exportValue:n}=i,r=i.getAttribute("data-element-id");r!==t&&_r.has(i)&&s.push({id:r,exportValue:n,domElement:i})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};hr=new WeakMap,Ia=new WeakMap,Pa=new WeakMap,Tl=new WeakSet,Od=function(e){const{container:{style:t},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:o,pageY:l}}}}=this;s==null||s.splice(0,4,...e),t.left=`${100*(e[0]-o)/n}%`,t.top=`${100*(r-e[3]+l)/r}%`,i===0?(t.width=`${100*(e[2]-e[0])/n}%`,t.height=`${100*(e[3]-e[1])/r}%`):this.setRotation(i)};let Pt=Du;var Ue,xn,yp,Ap;class bp extends Pt{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});b(this,Ue);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let n=!1;return t.url?(s.addLinkAttributes(i,t.url,t.newWindow),n=!0):t.action?(this._bindNamedAction(i,t.action),n=!0):t.attachment?(y(this,Ue,yp).call(this,i,t.attachment,t.attachmentDest),n=!0):t.setOCGState?(y(this,Ue,Ap).call(this,i,t.setOCGState),n=!0):t.dest?(this._bindLink(i,t.dest),n=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),n=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(i,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(i),this.container}_bindLink(t,s){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&y(this,Ue,xn).call(this)}_bindNamedAction(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),y(this,Ue,xn).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(s.actions)){const r=i.get(n);r&&(t[r]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:n}}),!1})}t.onclick||(t.onclick=()=>!1),y(this,Ue,xn).call(this)}_bindResetFormAction(t,s){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),y(this,Ue,xn).call(this),!this._fieldObjects){Y('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var u;i==null||i();const{fields:n,refs:r,include:o}=s,l=[];if(n.length!==0||r.length!==0){const f=new Set(r);for(const p of n){const v=this._fieldObjects[p]||[];for(const{id:g}of v)f.add(g)}for(const p of Object.values(this._fieldObjects))for(const v of p)f.has(v.id)===o&&l.push(v)}else for(const f of Object.values(this._fieldObjects))l.push(...f);const h=this.annotationStorage,d=[];for(const f of l){const{id:p}=f;switch(d.push(p),f.type){case"text":{const g=f.defaultValue||"";h.setValue(p,{value:g});break}case"checkbox":case"radiobutton":{const g=f.defaultValue===f.exportValues;h.setValue(p,{value:g});break}case"combobox":case"listbox":{const g=f.defaultValue||"";h.setValue(p,{value:g});break}default:continue}const v=document.querySelector(`[data-element-id="${p}"]`);if(v){if(!_r.has(v)){Y(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;v.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((u=this.linkService.eventBus)==null||u.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}})),!1}}}Ue=new WeakSet,xn=function(){this.container.setAttribute("data-internal-link","")},yp=function(t,s,i=null){t.href=this.linkService.getAnchorUrl(""),s.description&&(t.title=s.description),t.onclick=()=>{var n;return(n=this.downloadManager)==null||n.openOrDownloadData(s.content,s.filename,i),!1},y(this,Ue,xn).call(this)},Ap=function(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),y(this,Ue,xn).call(this)};class mv extends Pt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Hr extends Pt{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return ee.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,i,n){s.includes("mouse")?e.addEventListener(s,r=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):e.addEventListener(s,r=>{var o;if(s==="blur"){if(!t.focused||!r.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}n&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r)}}))})}_setEventListeners(e,t,s,i){var n,r,o;for(const[l,h]of s)(h==="Action"||(n=this.data.actions)!=null&&n[h])&&((h==="Focus"||h==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,h,i),h==="Focus"&&!((r=this.data.actions)!=null&&r.Blur)?this._setEventListener(e,t,"blur","Blur",null):h==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":V.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||gv,n=e.style;let r;const o=2,l=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o),d=Math.round(h/(Bc*i))||1,u=h/d;r=Math.min(i,l(u/Bc))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o);r=Math.min(i,l(h/Bc))}n.fontSize=`calc(${r}px * var(--total-scale-factor))`,n.color=V.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(n.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class vv extends Hr{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,i){const n=this.annotationStorage;for(const r of this._getElementsByName(e.name,e.id))r.domElement&&(r.domElement[t]=s),n.setValue(r.id,{[i]:s})}render(){var i,n;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const r=e.getValue(t,{value:this.data.fieldValue});let o=r.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let h=r.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const d={userValue:o,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=h??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",h??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),_r.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=dh,this._setRequired(s,this.data.required),l&&(s.maxLength=l),s.addEventListener("input",f=>{e.setValue(t,{value:f.target.value}),this.setPropertyOnSiblings(s,"value",f.target.value,"value"),d.formattedValue=null}),s.addEventListener("resetform",f=>{const p=this.data.defaultFieldValue??"";s.value=d.userValue=p,d.formattedValue=null});let u=f=>{const{formattedValue:p}=d;p!=null&&(f.target.value=p),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",p=>{var g;if(d.focused)return;const{target:v}=p;d.userValue&&(v.value=d.userValue),d.lastCommittedValue=v.value,d.commitKey=1,(g=this.data.actions)!=null&&g.Focus||(d.focused=!0)}),s.addEventListener("updatefromsandbox",p=>{this.showElementAndHideCanvas(p.target);const v={value(g){d.userValue=g.detail.value??"",e.setValue(t,{value:d.userValue.toString()}),g.target.value=d.userValue},formattedValue(g){const{formattedValue:A}=g.detail;d.formattedValue=A,A!=null&&g.target!==document.activeElement&&(g.target.value=A),e.setValue(t,{formattedValue:A})},selRange(g){g.target.setSelectionRange(...g.detail.selRange)},charLimit:g=>{var E;const{charLimit:A}=g.detail,{target:w}=g;if(A===0){w.removeAttribute("maxLength");return}w.setAttribute("maxLength",A);let S=d.userValue;!S||S.length<=A||(S=S.slice(0,A),w.value=d.userValue=S,e.setValue(t,{value:S}),(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:S,willCommit:!0,commitKey:1,selStart:w.selectionStart,selEnd:w.selectionEnd}}))}};this._dispatchEventFromSandbox(v,p)}),s.addEventListener("keydown",p=>{var A;d.commitKey=1;let v=-1;if(p.key==="Escape"?v=0:p.key==="Enter"&&!this.data.multiLine?v=2:p.key==="Tab"&&(d.commitKey=3),v===-1)return;const{value:g}=p.target;d.lastCommittedValue!==g&&(d.lastCommittedValue=g,d.userValue=g,(A=this.linkService.eventBus)==null||A.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:g,willCommit:!0,commitKey:v,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}}))});const f=u;u=null,s.addEventListener("blur",p=>{var g,A;if(!d.focused||!p.relatedTarget)return;(g=this.data.actions)!=null&&g.Blur||(d.focused=!1);const{value:v}=p.target;d.userValue=v,d.lastCommittedValue!==v&&((A=this.linkService.eventBus)==null||A.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,willCommit:!0,commitKey:d.commitKey,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}})),f(p)}),(n=this.data.actions)!=null&&n.Keystroke&&s.addEventListener("beforeinput",p=>{var x;d.lastCommittedValue=null;const{data:v,target:g}=p,{value:A,selectionStart:w,selectionEnd:S}=g;let E=w,T=S;switch(p.inputType){case"deleteWordBackward":{const C=A.substring(0,w).match(/\w*[^\w]*$/);C&&(E-=C[0].length);break}case"deleteWordForward":{const C=A.substring(w).match(/^[^\w]*\w*/);C&&(T+=C[0].length);break}case"deleteContentBackward":w===S&&(E-=1);break;case"deleteContentForward":w===S&&(T+=1);break}p.preventDefault(),(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:A,change:v||"",willCommit:!1,selStart:E,selEnd:T}})}),this._setEventListeners(s,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],p=>p.target.value)}if(u&&s.addEventListener("blur",u),this.data.comb){const p=(this.data.rect[2]-this.data.rect[0])/l;s.classList.add("comb"),s.style.letterSpacing=`calc(${p}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class bv extends Hr{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class yv extends Hr{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return _r.add(n),n.setAttribute("data-element-id",s),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=t.fieldName,i&&n.setAttribute("checked",!0),n.setAttribute("exportValue",t.exportValue),n.tabIndex=dh,n.addEventListener("change",r=>{const{name:o,checked:l}=r.target;for(const h of this._getElementsByName(o,s)){const d=l&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=d),e.setValue(h.id,{value:d})}e.setValue(s,{value:l})}),n.addEventListener("resetform",r=>{const o=t.defaultFieldValue||"Off";r.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",r=>{const o={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class wp extends Hr{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(s,{value:i})),i)for(const r of this._getElementsByName(t.fieldName,s))e.setValue(r.id,{value:!1});const n=document.createElement("input");if(_r.add(n),n.setAttribute("data-element-id",s),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=t.fieldName,i&&n.setAttribute("checked",!0),n.tabIndex=dh,n.addEventListener("change",r=>{const{name:o,checked:l}=r.target;for(const h of this._getElementsByName(o,s))e.setValue(h.id,{value:!1});e.setValue(s,{value:l})}),n.addEventListener("resetform",r=>{const o=t.defaultFieldValue;r.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const r=t.buttonValue;n.addEventListener("updatefromsandbox",o=>{const l={value:h=>{const d=r===h.detail.value;for(const u of this._getElementsByName(h.target.name)){const f=d&&u.id===s;u.domElement&&(u.domElement.checked=f),e.setValue(u.id,{value:f})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Av extends bp{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class wv extends Hr{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");_r.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=dh;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",d=>{const u=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===u});for(const d of this.data.options){const u=document.createElement("option");u.textContent=d.displayValue,u.value=d.exportValue,s.value.includes(d.exportValue)&&(u.setAttribute("selected",!0),n=!1),i.append(u)}let r=null;if(n){const d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),i.prepend(d),r=()=>{d.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}const o=d=>{const u=d?"value":"textContent",{options:f,multiple:p}=i;return p?Array.prototype.filter.call(f,v=>v.selected).map(v=>v[u]):f.selectedIndex===-1?null:f[f.selectedIndex][u]};let l=o(!1);const h=d=>{const u=d.target.options;return Array.prototype.map.call(u,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",d=>{const u={value(f){r==null||r();const p=f.detail.value,v=new Set(Array.isArray(p)?p:[p]);for(const g of i.options)g.selected=v.has(g.value);e.setValue(t,{value:o(!0)}),l=o(!1)},multipleSelection(f){i.multiple=!0},remove(f){const p=i.options,v=f.detail.remove;p[v].selected=!1,i.remove(v),p.length>0&&Array.prototype.findIndex.call(p,A=>A.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:o(!0),items:h(f)}),l=o(!1)},clear(f){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),l=o(!1)},insert(f){const{index:p,displayValue:v,exportValue:g}=f.detail.insert,A=i.children[p],w=document.createElement("option");w.textContent=v,w.value=g,A?A.before(w):i.append(w),e.setValue(t,{value:o(!0),items:h(f)}),l=o(!1)},items(f){const{items:p}=f.detail;for(;i.length!==0;)i.remove(0);for(const v of p){const{displayValue:g,exportValue:A}=v,w=document.createElement("option");w.textContent=g,w.value=A,i.append(w)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:o(!0),items:h(f)}),l=o(!1)},indices(f){const p=new Set(f.detail.indices);for(const v of f.target.options)v.selected=p.has(v.index);e.setValue(t,{value:o(!0)}),l=o(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(u,d)}),i.addEventListener("input",d=>{var p;const u=o(!0),f=o(!1);e.setValue(t,{value:u}),d.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:f,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):i.addEventListener("input",function(d){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Dd extends Pt{constructor(e){const{data:t,elements:s}=e;super(e,{isRenderable:Pt._hasPopupData(t)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new Ev({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",t.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(s=>`${yu}${s}`).join(",")),this.container}}var Ma,Ec,Sc,La,Oa,Tt,di,Da,Cl,Rl,Na,ui,ls,fi,Il,pi,Pl,cr,dr,ut,Bh,Nd,Ep,Sp,xp,Tp,Hh,$h,Fd;class Ev{constructor({container:e,color:t,elements:s,titleObj:i,modificationDate:n,contentsObj:r,richText:o,parent:l,rect:h,parentRect:d,open:u}){b(this,ut);b(this,Ma,y(this,ut,xp).bind(this));b(this,Ec,y(this,ut,Fd).bind(this));b(this,Sc,y(this,ut,$h).bind(this));b(this,La,y(this,ut,Hh).bind(this));b(this,Oa,null);b(this,Tt,null);b(this,di,null);b(this,Da,null);b(this,Cl,null);b(this,Rl,null);b(this,Na,null);b(this,ui,!1);b(this,ls,null);b(this,fi,null);b(this,Il,null);b(this,pi,null);b(this,Pl,null);b(this,cr,null);b(this,dr,!1);var f;m(this,Tt,e),m(this,Pl,i),m(this,di,r),m(this,pi,o),m(this,Rl,l),m(this,Oa,t),m(this,Il,h),m(this,Na,d),m(this,Cl,s),m(this,Da,Eu.toDateObject(n)),this.trigger=s.flatMap(p=>p.getElementsToTriggerPopup());for(const p of this.trigger)p.addEventListener("click",a(this,La)),p.addEventListener("mouseenter",a(this,Sc)),p.addEventListener("mouseleave",a(this,Ec)),p.classList.add("popupTriggerArea");for(const p of s)(f=p.container)==null||f.addEventListener("keydown",a(this,Ma));a(this,Tt).hidden=!0,u&&y(this,ut,Hh).call(this)}render(){if(a(this,ls))return;const e=m(this,ls,document.createElement("div"));if(e.className="popup",a(this,Oa)){const n=e.style.outlineColor=V.makeHexColor(...a(this,Oa));e.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const t=document.createElement("span");t.className="header";const s=document.createElement("h1");if(t.append(s),{dir:s.dir,str:s.textContent}=a(this,Pl),e.append(t),a(this,Da)){const n=document.createElement("span");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:a(this,Da).valueOf()})),t.append(n)}const i=a(this,ut,Bh);if(i)vp.render({xfaHtml:i,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const n=this._formatContents(a(this,di));e.append(n)}a(this,Tt).append(e)}_formatContents({str:e,dir:t}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=t;const i=e.split(/(?:\r\n?|\n)/);for(let n=0,r=i.length;n<r;++n){const o=i[n];s.append(document.createTextNode(o)),n<r-1&&s.append(document.createElement("br"))}return s}updateEdited({rect:e,popupContent:t}){var s;a(this,cr)||m(this,cr,{contentsObj:a(this,di),richText:a(this,pi)}),e&&m(this,fi,null),t&&(m(this,pi,y(this,ut,Sp).call(this,t)),m(this,di,null)),(s=a(this,ls))==null||s.remove(),m(this,ls,null)}resetEdited(){var e;a(this,cr)&&({contentsObj:he(this,di)._,richText:he(this,pi)._}=a(this,cr),m(this,cr,null),(e=a(this,ls))==null||e.remove(),m(this,ls,null),m(this,fi,null))}forceHide(){m(this,dr,this.isVisible),a(this,dr)&&(a(this,Tt).hidden=!0)}maybeShow(){a(this,dr)&&(a(this,ls)||y(this,ut,$h).call(this),m(this,dr,!1),a(this,Tt).hidden=!1)}get isVisible(){return a(this,Tt).hidden===!1}}Ma=new WeakMap,Ec=new WeakMap,Sc=new WeakMap,La=new WeakMap,Oa=new WeakMap,Tt=new WeakMap,di=new WeakMap,Da=new WeakMap,Cl=new WeakMap,Rl=new WeakMap,Na=new WeakMap,ui=new WeakMap,ls=new WeakMap,fi=new WeakMap,Il=new WeakMap,pi=new WeakMap,Pl=new WeakMap,cr=new WeakMap,dr=new WeakMap,ut=new WeakSet,Bh=function(){const e=a(this,pi),t=a(this,di);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&a(this,pi).html||null},Nd=function(){var e,t,s;return((s=(t=(e=a(this,ut,Bh))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},Ep=function(){var e,t,s;return((s=(t=(e=a(this,ut,Bh))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},Sp=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:a(this,ut,Ep),fontSize:a(this,ut,Nd)?`calc(${a(this,ut,Nd)}px * var(--total-scale-factor))`:""}};for(const n of e.split(`
`))t.push({name:"span",value:n,attributes:i});return s},xp=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&a(this,ui))&&y(this,ut,Hh).call(this)},Tp=function(){if(a(this,fi)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:i,pageY:n}}}=a(this,Rl);let r=!!a(this,Na),o=r?a(this,Na):a(this,Il);for(const v of a(this,Cl))if(!o||V.intersect(v.data.rect,o)!==null){o=v.data.rect,r=!0;break}const l=V.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),d=r?o[2]-o[0]+5:0,u=l[0]+d,f=l[1];m(this,fi,[100*(u-i)/t,100*(f-n)/s]);const{style:p}=a(this,Tt);p.left=`${a(this,fi)[0]}%`,p.top=`${a(this,fi)[1]}%`},Hh=function(){m(this,ui,!a(this,ui)),a(this,ui)?(y(this,ut,$h).call(this),a(this,Tt).addEventListener("click",a(this,La)),a(this,Tt).addEventListener("keydown",a(this,Ma))):(y(this,ut,Fd).call(this),a(this,Tt).removeEventListener("click",a(this,La)),a(this,Tt).removeEventListener("keydown",a(this,Ma)))},$h=function(){a(this,ls)||this.render(),this.isVisible?a(this,ui)&&a(this,Tt).classList.add("focused"):(y(this,ut,Tp).call(this),a(this,Tt).hidden=!1,a(this,Tt).style.zIndex=parseInt(a(this,Tt).style.zIndex)+1e3)},Fd=function(){a(this,Tt).classList.remove("focused"),!(a(this,ui)||!this.isVisible)&&(a(this,Tt).hidden=!0,a(this,Tt).style.zIndex=parseInt(a(this,Tt).style.zIndex)-1e3)};class Cp extends Pt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=K.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Ml;class Sv extends Pt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Ml,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),r=m(this,Ml,this.svgFactory.createElement("svg:line"));return r.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),r.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),r.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),r.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),r.setAttribute("stroke-width",t.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,Ml)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ml=new WeakMap;var Ll;class xv extends Pt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Ll,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),r=t.borderStyle.width,o=m(this,Ll,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",r/2),o.setAttribute("y",r/2),o.setAttribute("width",s-r),o.setAttribute("height",i-r),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,Ll)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ll=new WeakMap;var Ol;class Tv extends Pt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Ol,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),r=t.borderStyle.width,o=m(this,Ol,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",s/2),o.setAttribute("cy",i/2),o.setAttribute("rx",s/2-r/2),o.setAttribute("ry",i/2-r/2),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,Ol)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ol=new WeakMap;var Dl;class Rp extends Pt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Dl,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:i,popupRef:n},width:r,height:o}=this;if(!s)return this.container;const l=this.svgFactory.create(r,o,!0);let h=[];for(let u=0,f=s.length;u<f;u+=2){const p=s[u]-t[0],v=t[3]-s[u+1];h.push(`${p},${v}`)}h=h.join(" ");const d=m(this,Dl,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",h),d.setAttribute("stroke-width",i.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),l.append(d),this.container.append(l),!n&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,Dl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Dl=new WeakMap;class Cv extends Rp{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Rv extends Pt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var Nl,ur,Fl,kd;class Ru extends Pt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});b(this,Fl);b(this,Nl,null);b(this,ur,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?K.HIGHLIGHT:K.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:i,borderStyle:n,popupRef:r}}=this,{transform:o,width:l,height:h}=y(this,Fl,kd).call(this,s,t),d=this.svgFactory.create(l,h,!0),u=m(this,Nl,this.svgFactory.createElement("svg:g"));d.append(u),u.setAttribute("stroke-width",n.width||1),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("stroke-miterlimit",10),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),u.setAttribute("transform",o);for(let f=0,p=i.length;f<p;f++){const v=this.svgFactory.createElement(this.svgElementName);a(this,ur).push(v),v.setAttribute("points",i[f].join(",")),u.append(v)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:i,rect:n}=t,r=a(this,Nl);if(s>=0&&r.setAttribute("stroke-width",s||1),i)for(let o=0,l=a(this,ur).length;o<l;o++)a(this,ur)[o].setAttribute("points",i[o].join(","));if(n){const{transform:o,width:l,height:h}=y(this,Fl,kd).call(this,this.data.rotation,n);r.parentElement.setAttribute("viewBox",`0 0 ${l} ${h}`),r.setAttribute("transform",o)}}getElementsToTriggerPopup(){return a(this,ur)}addHighlightArea(){this.container.classList.add("highlightArea")}}Nl=new WeakMap,ur=new WeakMap,Fl=new WeakSet,kd=function(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class Ip extends Pt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=K.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class Iv extends Pt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Pv extends Pt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Mv extends Pt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Pp extends Pt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=K.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var kl,_l,_d;class Lv extends Pt{constructor(t){var i;super(t,{isRenderable:!0});b(this,_l);b(this,kl,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",y(this,_l,_d).bind(this)),m(this,kl,i);const{isMac:n}=ee.platform;return t.addEventListener("keydown",r=>{r.key==="Enter"&&(n?r.metaKey:r.ctrlKey)&&y(this,_l,_d).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return a(this,kl)}addHighlightArea(){this.container.classList.add("highlightArea")}}kl=new WeakMap,_l=new WeakSet,_d=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var Bl,fr,nn,Hl,Sn,Hd,$d;const Nu=class Nu{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:i,page:n,viewport:r,structTreeLayer:o}){b(this,Sn);b(this,Bl,null);b(this,fr,null);b(this,nn,new Map);b(this,Hl,null);this.div=e,m(this,Bl,t),m(this,fr,s),m(this,Hl,o||null),this.page=n,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return a(this,nn).size>0}async render(e){var r;const{annotations:t}=e,s=this.div;Fr(s,this.viewport);const i=new Map,n={data:null,layer:s,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new rc,annotationStorage:e.annotationStorage||new xu,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const l=o.annotationType===Ot.POPUP;if(l){const u=i.get(o.id);if(!u)continue;n.elements=u}else if(o.rect[2]===o.rect[0]||o.rect[3]===o.rect[1])continue;n.data=o;const h=af.create(n);if(!h.isRenderable)continue;if(!l&&o.popupRef){const u=i.get(o.popupRef);u?u.push(h):i.set(o.popupRef,[h])}const d=h.render();o.hidden&&(d.style.visibility="hidden"),await y(this,Sn,Hd).call(this,d,o.id),h._isEditable&&(a(this,nn).set(h.data.id,h),(r=this._annotationEditorUIManager)==null||r.renderAnnotationElement(h))}y(this,Sn,$d).call(this)}async addLinkAnnotations(e,t){const s={data:null,layer:this.div,linkService:t,svgFactory:new rc,parent:this};for(const i of e){i.borderStyle||(i.borderStyle=Nu._defaultBorderStyle),s.data=i;const n=af.create(s);if(!n.isRenderable)continue;const r=n.render();await y(this,Sn,Hd).call(this,r,i.id)}}update({viewport:e}){const t=this.div;this.viewport=e,Fr(t,{rotation:e.rotation}),y(this,Sn,$d).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(a(this,nn).values())}getEditableAnnotation(e){return a(this,nn).get(e)}static get _defaultBorderStyle(){return tt(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:$r.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};Bl=new WeakMap,fr=new WeakMap,nn=new WeakMap,Hl=new WeakMap,Sn=new WeakSet,Hd=async function(e,t){var r,o;const s=e.firstChild||e,i=s.id=`${yu}${t}`,n=await((r=a(this,Hl))==null?void 0:r.getAriaAttributes(i));if(n)for(const[l,h]of n)s.setAttribute(l,h);this.div.append(e),(o=a(this,Bl))==null||o.moveElementInDOM(this.div,e,s,!1)},$d=function(){var t;if(!a(this,fr))return;const e=this.div;for(const[s,i]of a(this,fr)){const n=e.querySelector(`[data-annotation-id="${s}"]`);if(!n)continue;i.className="annotationContent";const{firstChild:r}=n;r?r.nodeName==="CANVAS"?r.replaceWith(i):r.classList.contains("annotationContent")?r.after(i):r.before(i):n.append(i);const o=a(this,nn).get(s);o&&(o._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(s,n.id,i),o._hasNoCanvas=!1):o.canvas=i)}a(this,fr).clear()};let Bd=Nu;const wh=/\r\n?|\n/g;var hs,Le,$l,pr,Oe,Ft,Mp,Lp,Op,jh,Ci,Uh,zh,Dp,Ud,Np;const gt=class gt extends mt{constructor(t){super({...t,name:"freeTextEditor"});b(this,Ft);b(this,hs);b(this,Le,"");b(this,$l,`${this.id}-editor`);b(this,pr,null);b(this,Oe);m(this,hs,t.color||gt._defaultColor||mt._defaultLineColor),m(this,Oe,t.fontSize||gt._defaultFontSize)}static get _keyboardManager(){const t=gt.prototype,s=r=>r.isEmpty(),i=kr.TRANSLATE_SMALL,n=kr.TRANSLATE_BIG;return tt(this,"_keyboardManager",new hh([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[n,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,n],checker:s}]]))}static initialize(t,s){mt.initialize(t,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case et.FREETEXT_SIZE:gt._defaultFontSize=s;break;case et.FREETEXT_COLOR:gt._defaultColor=s;break}}updateParams(t,s){switch(t){case et.FREETEXT_SIZE:y(this,Ft,Mp).call(this,s);break;case et.FREETEXT_COLOR:y(this,Ft,Lp).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[et.FREETEXT_SIZE,gt._defaultFontSize],[et.FREETEXT_COLOR,gt._defaultColor||mt._defaultLineColor]]}get propertiesToUpdate(){return[[et.FREETEXT_SIZE,a(this,Oe)],[et.FREETEXT_COLOR,a(this,hs)]]}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-gt._internalPadding*t,-(gt._internalPadding+a(this,Oe))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),m(this,pr,new AbortController);const t=this._uiManager.combinedSignal(a(this,pr));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",a(this,$l)),this._isDraggable=!0,(t=a(this,pr))==null||t.abort(),m(this,pr,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var s;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=a(this,Le),s=m(this,Le,y(this,Ft,Op).call(this).trimEnd());if(t===s)return;const i=n=>{if(m(this,Le,n),!n){this.remove();return}y(this,Ft,zh).call(this),this._uiManager.rebuild(this),y(this,Ft,jh).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(t)},mustExec:!1}),y(this,Ft,jh).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){gt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,s;(this._isCopy||this.annotationElementId)&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",a(this,$l)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${a(this,Oe)}px * var(--total-scale-factor))`,i.color=a(this,hs),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[n,r]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,h]=this.getInitialTranslation();[l,h]=this.pageTranslationToScreen(l,h);const[d,u]=this.pageDimensions,[f,p]=this.pageTranslation;let v,g;switch(this.rotation){case 0:v=t+(o[0]-f)/d,g=s+this.height-(o[1]-p)/u;break;case 90:v=t+(o[0]-f)/d,g=s-(o[1]-p)/u,[l,h]=[h,-l];break;case 180:v=t-this.width+(o[0]-f)/d,g=s-(o[1]-p)/u,[l,h]=[-l,-h];break;case 270:v=t+(o[0]-f-this.height*u)/d,g=s+(o[1]-p-this.width*d)/u,[l,h]=[-h,l];break}this.setAt(v*n,g*r,l,h)}else this._moveAfterPaste(t,s);y(this,Ft,zh).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var v,g,A;const s=t.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const n=y(v=gt,Ci,Ud).call(v,s.getData("text")||"").replaceAll(wh,`
`);if(!n)return;const r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();const o=r.getRangeAt(0);if(!n.includes(`
`)){o.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),r.collapseToStart();return}const{startContainer:l,startOffset:h}=o,d=[],u=[];if(l.nodeType===Node.TEXT_NODE){const w=l.parentElement;if(u.push(l.nodeValue.slice(h).replaceAll(wh,"")),w!==this.editorDiv){let S=d;for(const E of this.editorDiv.childNodes){if(E===w){S=u;continue}S.push(y(g=gt,Ci,Uh).call(g,E))}}d.push(l.nodeValue.slice(0,h).replaceAll(wh,""))}else if(l===this.editorDiv){let w=d,S=0;for(const E of this.editorDiv.childNodes)S++===h&&(w=u),w.push(y(A=gt,Ci,Uh).call(A,E))}m(this,Le,`${d.join(`
`)}${n}${u.join(`
`)}`),y(this,Ft,zh).call(this);const f=new Range;let p=Math.sumPrecise(d.map(w=>w.length));for(const{firstChild:w}of this.editorDiv.childNodes)if(w.nodeType===Node.TEXT_NODE){const S=w.nodeValue.length;if(p<=S){f.setStart(w,p),f.setEnd(w,p);break}p-=S}r.removeAllRanges(),r.addRange(f)}get contentDiv(){return this.editorDiv}static async deserialize(t,s,i){var o;let n=null;if(t instanceof Cp){const{data:{defaultAppearanceData:{fontSize:l,fontColor:h},rect:d,rotation:u,id:f,popupRef:p},textContent:v,textPosition:g,parent:{page:{pageNumber:A}}}=t;if(!v||v.length===0)return null;n=t={annotationType:K.FREETEXT,color:Array.from(h),fontSize:l,value:v.join(`
`),position:g,pageIndex:A-1,rect:d.slice(0),rotation:u,id:f,deleted:!1,popupRef:p}}const r=await super.deserialize(t,s,i);return m(r,Oe,t.fontSize),m(r,hs,V.makeHexColor(...t.color)),m(r,Le,y(o=gt,Ci,Ud).call(o,t.value)),r.annotationElementId=t.id||null,r._initialData=n,r}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=gt._internalPadding*this.parentScale,i=this.getRect(s,s),n=mt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:a(this,hs)),r={annotationType:K.FREETEXT,color:n,fontSize:a(this,Oe),value:y(this,Ft,Dp).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(r.isCopy=!0,r):this.annotationElementId&&!y(this,Ft,Np).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(this.deleted)return s;const{style:i}=s;i.fontSize=`calc(${a(this,Oe)}px * var(--total-scale-factor))`,i.color=a(this,hs),s.replaceChildren();for(const r of a(this,Le).split(`
`)){const o=document.createElement("div");o.append(r?document.createTextNode(r):document.createElement("br")),s.append(o)}const n=gt._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(n,n),popupContent:a(this,Le)}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};hs=new WeakMap,Le=new WeakMap,$l=new WeakMap,pr=new WeakMap,Oe=new WeakMap,Ft=new WeakSet,Mp=function(t){const s=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--total-scale-factor))`,this.translate(0,-(n-a(this,Oe))*this.parentScale),m(this,Oe,n),y(this,Ft,jh).call(this)},i=a(this,Oe);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:et.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Lp=function(t){const s=n=>{m(this,hs,this.editorDiv.style.color=n)},i=a(this,hs);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:et.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Op=function(){var i;const t=[];this.editorDiv.normalize();let s=null;for(const n of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&n.nodeName==="BR"||(t.push(y(i=gt,Ci,Uh).call(i,n)),s=n);return t.join(`
`)},jh=function(){const[t,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:n,div:r}=this,o=r.style.display,l=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",n.div.append(this.div),i=r.getBoundingClientRect(),r.remove(),r.style.display=o,r.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/s):(this.width=i.height/t,this.height=i.width/s),this.fixAndSetPosition()},Ci=new WeakSet,Uh=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(wh,"")},zh=function(){if(this.editorDiv.replaceChildren(),!!a(this,Le))for(const t of a(this,Le).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},Dp=function(){return a(this,Le).replaceAll(" "," ")},Ud=function(t){return t.replaceAll(" "," ")},Np=function(t){const{value:s,fontSize:i,color:n,pageIndex:r}=this._initialData;return this._hasBeenMoved||t.value!==s||t.fontSize!==i||t.color.some((o,l)=>o!==n[l])||t.pageIndex!==r},b(gt,Ci),O(gt,"_freeTextDefaultContent",""),O(gt,"_internalPadding",0),O(gt,"_defaultColor",null),O(gt,"_defaultFontSize",10),O(gt,"_type","freetext"),O(gt,"_editorType",K.FREETEXT);let jd=gt;class H{toSVGPath(){dt("Abstract method `toSVGPath` must be implemented.")}get box(){dt("Abstract getter `box` must be implemented.")}serialize(e,t){dt("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,i,n,r){r||(r=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)r[o]=t+e[o]*i,r[o+1]=s+e[o+1]*n;return r}static _rescaleAndSwap(e,t,s,i,n,r){r||(r=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)r[o]=t+e[o+1]*i,r[o+1]=s+e[o]*n;return r}static _translate(e,t,s,i){i||(i=new Float32Array(e.length));for(let n=0,r=e.length;n<r;n+=2)i[n]=t+e[n],i[n+1]=s+e[n+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,i,n){switch(n){case 90:return[1-t/s,e/i];case 180:return[1-e/s,1-t/i];case 270:return[t/s,1-e/i];default:return[e/s,t/i]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,i,n,r){return[(e+5*s)/6,(t+5*i)/6,(5*s+n)/6,(5*i+r)/6,(s+n)/2,(i+r)/2]}}O(H,"PRECISION",1e-4);var De,cs,Fa,ka,Ns,q,gr,mr,jl,Ul,_a,Ba,rn,zl,xc,Tc,$t,So,Fp,kp,_p,Bp,Hp,$p;const Xs=class Xs{constructor({x:e,y:t},s,i,n,r,o=0){b(this,$t);b(this,De);b(this,cs,[]);b(this,Fa);b(this,ka);b(this,Ns,[]);b(this,q,new Float32Array(18));b(this,gr);b(this,mr);b(this,jl);b(this,Ul);b(this,_a);b(this,Ba);b(this,rn,[]);m(this,De,s),m(this,Ba,n*i),m(this,ka,r),a(this,q).set([NaN,NaN,NaN,NaN,e,t],6),m(this,Fa,o),m(this,Ul,a(Xs,zl)*i),m(this,jl,a(Xs,Tc)*i),m(this,_a,i),a(this,rn).push(e,t)}isEmpty(){return isNaN(a(this,q)[8])}add({x:e,y:t}){var P;m(this,gr,e),m(this,mr,t);const[s,i,n,r]=a(this,De);let[o,l,h,d]=a(this,q).subarray(8,12);const u=e-h,f=t-d,p=Math.hypot(u,f);if(p<a(this,jl))return!1;const v=p-a(this,Ul),g=v/p,A=g*u,w=g*f;let S=o,E=l;o=h,l=d,h+=A,d+=w,(P=a(this,rn))==null||P.push(e,t);const T=-w/v,x=A/v,C=T*a(this,Ba),R=x*a(this,Ba);return a(this,q).set(a(this,q).subarray(2,8),0),a(this,q).set([h+C,d+R],4),a(this,q).set(a(this,q).subarray(14,18),12),a(this,q).set([h-C,d-R],16),isNaN(a(this,q)[6])?(a(this,Ns).length===0&&(a(this,q).set([o+C,l+R],2),a(this,Ns).push(NaN,NaN,NaN,NaN,(o+C-s)/n,(l+R-i)/r),a(this,q).set([o-C,l-R],14),a(this,cs).push(NaN,NaN,NaN,NaN,(o-C-s)/n,(l-R-i)/r)),a(this,q).set([S,E,o,l,h,d],6),!this.isEmpty()):(a(this,q).set([S,E,o,l,h,d],6),Math.abs(Math.atan2(E-l,S-o)-Math.atan2(w,A))<Math.PI/2?([o,l,h,d]=a(this,q).subarray(2,6),a(this,Ns).push(NaN,NaN,NaN,NaN,((o+h)/2-s)/n,((l+d)/2-i)/r),[o,l,S,E]=a(this,q).subarray(14,18),a(this,cs).push(NaN,NaN,NaN,NaN,((S+o)/2-s)/n,((E+l)/2-i)/r),!0):([S,E,o,l,h,d]=a(this,q).subarray(0,6),a(this,Ns).push(((S+5*o)/6-s)/n,((E+5*l)/6-i)/r,((5*o+h)/6-s)/n,((5*l+d)/6-i)/r,((o+h)/2-s)/n,((l+d)/2-i)/r),[h,d,o,l,S,E]=a(this,q).subarray(12,18),a(this,cs).push(((S+5*o)/6-s)/n,((E+5*l)/6-i)/r,((5*o+h)/6-s)/n,((5*l+d)/6-i)/r,((o+h)/2-s)/n,((l+d)/2-i)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const e=a(this,Ns),t=a(this,cs);if(isNaN(a(this,q)[6])&&!this.isEmpty())return y(this,$t,Fp).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);y(this,$t,_p).call(this,s);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return y(this,$t,kp).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,i,n,r){return new jp(e,t,s,i,n,r)}getOutlines(){var u;const e=a(this,Ns),t=a(this,cs),s=a(this,q),[i,n,r,o]=a(this,De),l=new Float32Array((((u=a(this,rn))==null?void 0:u.length)??0)+2);for(let f=0,p=l.length-2;f<p;f+=2)l[f]=(a(this,rn)[f]-i)/r,l[f+1]=(a(this,rn)[f+1]-n)/o;if(l[l.length-2]=(a(this,gr)-i)/r,l[l.length-1]=(a(this,mr)-n)/o,isNaN(s[6])&&!this.isEmpty())return y(this,$t,Bp).call(this,l);const h=new Float32Array(a(this,Ns).length+24+a(this,cs).length);let d=e.length;for(let f=0;f<d;f+=2){if(isNaN(e[f])){h[f]=h[f+1]=NaN;continue}h[f]=e[f],h[f+1]=e[f+1]}d=y(this,$t,$p).call(this,h,d);for(let f=t.length-6;f>=6;f-=6)for(let p=0;p<6;p+=2){if(isNaN(t[f+p])){h[d]=h[d+1]=NaN,d+=2;continue}h[d]=t[f+p],h[d+1]=t[f+p+1],d+=2}return y(this,$t,Hp).call(this,h,d),this.newFreeDrawOutline(h,l,a(this,De),a(this,_a),a(this,Fa),a(this,ka))}};De=new WeakMap,cs=new WeakMap,Fa=new WeakMap,ka=new WeakMap,Ns=new WeakMap,q=new WeakMap,gr=new WeakMap,mr=new WeakMap,jl=new WeakMap,Ul=new WeakMap,_a=new WeakMap,Ba=new WeakMap,rn=new WeakMap,zl=new WeakMap,xc=new WeakMap,Tc=new WeakMap,$t=new WeakSet,So=function(){const e=a(this,q).subarray(4,6),t=a(this,q).subarray(16,18),[s,i,n,r]=a(this,De);return[(a(this,gr)+(e[0]-t[0])/2-s)/n,(a(this,mr)+(e[1]-t[1])/2-i)/r,(a(this,gr)+(t[0]-e[0])/2-s)/n,(a(this,mr)+(t[1]-e[1])/2-i)/r]},Fp=function(){const[e,t,s,i]=a(this,De),[n,r,o,l]=y(this,$t,So).call(this);return`M${(a(this,q)[2]-e)/s} ${(a(this,q)[3]-t)/i} L${(a(this,q)[4]-e)/s} ${(a(this,q)[5]-t)/i} L${n} ${r} L${o} ${l} L${(a(this,q)[16]-e)/s} ${(a(this,q)[17]-t)/i} L${(a(this,q)[14]-e)/s} ${(a(this,q)[15]-t)/i} Z`},kp=function(e){const t=a(this,cs);e.push(`L${t[4]} ${t[5]} Z`)},_p=function(e){const[t,s,i,n]=a(this,De),r=a(this,q).subarray(4,6),o=a(this,q).subarray(16,18),[l,h,d,u]=y(this,$t,So).call(this);e.push(`L${(r[0]-t)/i} ${(r[1]-s)/n} L${l} ${h} L${d} ${u} L${(o[0]-t)/i} ${(o[1]-s)/n}`)},Bp=function(e){const t=a(this,q),[s,i,n,r]=a(this,De),[o,l,h,d]=y(this,$t,So).call(this),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(t[2]-s)/n,(t[3]-i)/r,NaN,NaN,NaN,NaN,(t[4]-s)/n,(t[5]-i)/r,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,(t[16]-s)/n,(t[17]-i)/r,NaN,NaN,NaN,NaN,(t[14]-s)/n,(t[15]-i)/r],0),this.newFreeDrawOutline(u,e,a(this,De),a(this,_a),a(this,Fa),a(this,ka))},Hp=function(e,t){const s=a(this,cs);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},$p=function(e,t){const s=a(this,q).subarray(4,6),i=a(this,q).subarray(16,18),[n,r,o,l]=a(this,De),[h,d,u,f]=y(this,$t,So).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-n)/o,(s[1]-r)/l,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,u,f,NaN,NaN,NaN,NaN,(i[0]-n)/o,(i[1]-r)/l],t),t+=24},b(Xs,zl,8),b(Xs,xc,2),b(Xs,Tc,a(Xs,zl)+a(Xs,xc));let ac=Xs;var Ha,vr,gi,Gl,Ne,Vl,It,Cc,Up;class jp extends H{constructor(t,s,i,n,r,o){super();b(this,Cc);b(this,Ha);b(this,vr,new Float32Array(4));b(this,gi);b(this,Gl);b(this,Ne);b(this,Vl);b(this,It);m(this,It,t),m(this,Ne,s),m(this,Ha,i),m(this,Vl,n),m(this,gi,r),m(this,Gl,o),this.lastPoint=[NaN,NaN],y(this,Cc,Up).call(this,o);const[l,h,d,u]=a(this,vr);for(let f=0,p=t.length;f<p;f+=2)t[f]=(t[f]-l)/d,t[f+1]=(t[f+1]-h)/u;for(let f=0,p=s.length;f<p;f+=2)s[f]=(s[f]-l)/d,s[f+1]=(s[f+1]-h)/u}toSVGPath(){const t=[`M${a(this,It)[4]} ${a(this,It)[5]}`];for(let s=6,i=a(this,It).length;s<i;s+=6){if(isNaN(a(this,It)[s])){t.push(`L${a(this,It)[s+4]} ${a(this,It)[s+5]}`);continue}t.push(`C${a(this,It)[s]} ${a(this,It)[s+1]} ${a(this,It)[s+2]} ${a(this,It)[s+3]} ${a(this,It)[s+4]} ${a(this,It)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,i,n],r){const o=i-t,l=n-s;let h,d;switch(r){case 0:h=H._rescale(a(this,It),t,n,o,-l),d=H._rescale(a(this,Ne),t,n,o,-l);break;case 90:h=H._rescaleAndSwap(a(this,It),t,s,o,l),d=H._rescaleAndSwap(a(this,Ne),t,s,o,l);break;case 180:h=H._rescale(a(this,It),i,s,-o,l),d=H._rescale(a(this,Ne),i,s,-o,l);break;case 270:h=H._rescaleAndSwap(a(this,It),i,n,-o,-l),d=H._rescaleAndSwap(a(this,Ne),i,n,-o,-l);break}return{outline:Array.from(h),points:[Array.from(d)]}}get box(){return a(this,vr)}newOutliner(t,s,i,n,r,o=0){return new ac(t,s,i,n,r,o)}getNewOutline(t,s){const[i,n,r,o]=a(this,vr),[l,h,d,u]=a(this,Ha),f=r*d,p=o*u,v=i*d+l,g=n*u+h,A=this.newOutliner({x:a(this,Ne)[0]*f+v,y:a(this,Ne)[1]*p+g},a(this,Ha),a(this,Vl),t,a(this,Gl),s??a(this,gi));for(let w=2;w<a(this,Ne).length;w+=2)A.add({x:a(this,Ne)[w]*f+v,y:a(this,Ne)[w+1]*p+g});return A.getOutlines()}}Ha=new WeakMap,vr=new WeakMap,gi=new WeakMap,Gl=new WeakMap,Ne=new WeakMap,Vl=new WeakMap,It=new WeakMap,Cc=new WeakSet,Up=function(t){const s=a(this,It);let i=s[4],n=s[5];const r=[i,n,i,n];let o=i,l=n;const h=t?Math.max:Math.min;for(let u=6,f=s.length;u<f;u+=6){const p=s[u+4],v=s[u+5];if(isNaN(s[u]))V.pointBoundingBox(p,v,r),l<v?(o=p,l=v):l===v&&(o=h(o,p));else{const g=[1/0,1/0,-1/0,-1/0];V.bezierBoundingBox(i,n,...s.slice(u,u+6),g),V.rectBoundingBox(...g,r),l<g[3]?(o=g[2],l=g[3]):l===g[3]&&(o=h(o,g[2]))}i=p,n=v}const d=a(this,vr);d[0]=r[0]-a(this,gi),d[1]=r[1]-a(this,gi),d[2]=r[2]-r[0]+2*a(this,gi),d[3]=r[3]-r[1]+2*a(this,gi),this.lastPoint=[o,l]};var Wl,Xl,an,ds,be,zp,Gh,Gp,Vp,Gd;class zd{constructor(e,t=0,s=0,i=!0){b(this,be);b(this,Wl);b(this,Xl);b(this,an,[]);b(this,ds,[]);const n=[1/0,1/0,-1/0,-1/0],r=10**-4;for(const{x:p,y:v,width:g,height:A}of e){const w=Math.floor((p-t)/r)*r,S=Math.ceil((p+g+t)/r)*r,E=Math.floor((v-t)/r)*r,T=Math.ceil((v+A+t)/r)*r,x=[w,E,T,!0],C=[S,E,T,!1];a(this,an).push(x,C),V.rectBoundingBox(w,E,S,T,n)}const o=n[2]-n[0]+2*s,l=n[3]-n[1]+2*s,h=n[0]-s,d=n[1]-s,u=a(this,an).at(i?-1:-2),f=[u[0],u[2]];for(const p of a(this,an)){const[v,g,A]=p;p[0]=(v-h)/o,p[1]=(g-d)/l,p[2]=(A-d)/l}m(this,Wl,new Float32Array([h,d,o,l])),m(this,Xl,f)}getOutlines(){a(this,an).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of a(this,an))t[3]?(e.push(...y(this,be,Gd).call(this,t)),y(this,be,Gp).call(this,t)):(y(this,be,Vp).call(this,t),e.push(...y(this,be,Gd).call(this,t)));return y(this,be,zp).call(this,e)}}Wl=new WeakMap,Xl=new WeakMap,an=new WeakMap,ds=new WeakMap,be=new WeakSet,zp=function(e){const t=[],s=new Set;for(const r of e){const[o,l,h]=r;t.push([o,l,r],[o,h,r])}t.sort((r,o)=>r[1]-o[1]||r[0]-o[0]);for(let r=0,o=t.length;r<o;r+=2){const l=t[r][2],h=t[r+1][2];l.push(h),h.push(l),s.add(l),s.add(h)}const i=[];let n;for(;s.size>0;){const r=s.values().next().value;let[o,l,h,d,u]=r;s.delete(r);let f=o,p=l;for(n=[o,h],i.push(n);;){let v;if(s.has(d))v=d;else if(s.has(u))v=u;else break;s.delete(v),[o,l,h,d,u]=v,f!==o&&(n.push(f,p,o,p===l?l:h),f=o),p=p===l?h:l}n.push(f,p)}return new Ov(i,a(this,Wl),a(this,Xl))},Gh=function(e){const t=a(this,ds);let s=0,i=t.length-1;for(;s<=i;){const n=s+i>>1,r=t[n][0];if(r===e)return n;r<e?s=n+1:i=n-1}return i+1},Gp=function([,e,t]){const s=y(this,be,Gh).call(this,e);a(this,ds).splice(s,0,[e,t])},Vp=function([,e,t]){const s=y(this,be,Gh).call(this,e);for(let i=s;i<a(this,ds).length;i++){const[n,r]=a(this,ds)[i];if(n!==e)break;if(n===e&&r===t){a(this,ds).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[n,r]=a(this,ds)[i];if(n!==e)break;if(n===e&&r===t){a(this,ds).splice(i,1);return}}},Gd=function(e){const[t,s,i]=e,n=[[t,s,i]],r=y(this,be,Gh).call(this,i);for(let o=0;o<r;o++){const[l,h]=a(this,ds)[o];for(let d=0,u=n.length;d<u;d++){const[,f,p]=n[d];if(!(h<=f||p<=l)){if(f>=l){if(p>h)n[d][1]=h;else{if(u===1)return[];n.splice(d,1),d--,u--}continue}n[d][2]=l,p>h&&n.push([t,h,p])}}}return n};var Yl,$a;class Ov extends H{constructor(t,s,i){super();b(this,Yl);b(this,$a);m(this,$a,t),m(this,Yl,s),this.lastPoint=i}toSVGPath(){const t=[];for(const s of a(this,$a)){let[i,n]=s;t.push(`M${i} ${n}`);for(let r=2;r<s.length;r+=2){const o=s[r],l=s[r+1];o===i?(t.push(`V${l}`),n=l):l===n&&(t.push(`H${o}`),i=o)}t.push("Z")}return t.join(" ")}serialize([t,s,i,n],r){const o=[],l=i-t,h=n-s;for(const d of a(this,$a)){const u=new Array(d.length);for(let f=0;f<d.length;f+=2)u[f]=t+d[f]*l,u[f+1]=n-d[f+1]*h;o.push(u)}return o}get box(){return a(this,Yl)}get classNamesForOutlining(){return["highlightOutline"]}}Yl=new WeakMap,$a=new WeakMap;class Vd extends ac{newFreeDrawOutline(e,t,s,i,n,r){return new Dv(e,t,s,i,n,r)}}class Dv extends jp{newOutliner(e,t,s,i,n,r=0){return new Vd(e,t,s,i,n,r)}}var us,br,ja,Ht,Kl,Ua,Ql,Jl,on,fs,za,Zl,ct,Wd,Xd,Yd,Tn,Wp,Di;const we=class we{constructor({editor:e=null,uiManager:t=null}){b(this,ct);b(this,us,null);b(this,br,null);b(this,ja);b(this,Ht,null);b(this,Kl,!1);b(this,Ua,!1);b(this,Ql,null);b(this,Jl);b(this,on,null);b(this,fs,null);b(this,za);var s;e?(m(this,Ua,!1),m(this,za,et.HIGHLIGHT_COLOR),m(this,Ql,e)):(m(this,Ua,!0),m(this,za,et.HIGHLIGHT_DEFAULT_COLOR)),m(this,fs,(e==null?void 0:e._uiManager)||t),m(this,Jl,a(this,fs)._eventBus),m(this,ja,(e==null?void 0:e.color)||((s=a(this,fs))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),a(we,Zl)||m(we,Zl,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return tt(this,"_keyboardManager",new hh([[["Escape","mac+Escape"],we.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],we.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],we.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],we.prototype._moveToPrevious],[["Home","mac+Home"],we.prototype._moveToBeginning],[["End","mac+End"],we.prototype._moveToEnd]]))}renderButton(){const e=m(this,us,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=a(this,fs)._signal;e.addEventListener("click",y(this,ct,Tn).bind(this),{signal:t}),e.addEventListener("keydown",y(this,ct,Yd).bind(this),{signal:t});const s=m(this,br,document.createElement("span"));return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=a(this,ja),e.append(s),e}renderMainDropdown(){const e=m(this,Ht,y(this,ct,Wd).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===a(this,us)){y(this,ct,Tn).call(this,e);return}const t=e.target.getAttribute("data-color");t&&y(this,ct,Xd).call(this,t,e)}_moveToNext(e){var t,s;if(!a(this,ct,Di)){y(this,ct,Tn).call(this,e);return}if(e.target===a(this,us)){(t=a(this,Ht).firstChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=a(this,Ht))==null?void 0:t.firstChild)||e.target===a(this,us)){a(this,ct,Di)&&this._hideDropdownFromKeyboard();return}a(this,ct,Di)||y(this,ct,Tn).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!a(this,ct,Di)){y(this,ct,Tn).call(this,e);return}(t=a(this,Ht).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!a(this,ct,Di)){y(this,ct,Tn).call(this,e);return}(t=a(this,Ht).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=a(this,Ht))==null||e.classList.add("hidden"),(t=a(this,on))==null||t.abort(),m(this,on,null)}_hideDropdownFromKeyboard(){var e;if(!a(this,Ua)){if(!a(this,ct,Di)){(e=a(this,Ql))==null||e.unselect();return}this.hideDropdown(),a(this,us).focus({preventScroll:!0,focusVisible:a(this,Kl)})}}updateColor(e){if(a(this,br)&&(a(this,br).style.backgroundColor=e),!a(this,Ht))return;const t=a(this,fs).highlightColors.values();for(const s of a(this,Ht).children)s.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=a(this,us))==null||e.remove(),m(this,us,null),m(this,br,null),(t=a(this,Ht))==null||t.remove(),m(this,Ht,null)}};us=new WeakMap,br=new WeakMap,ja=new WeakMap,Ht=new WeakMap,Kl=new WeakMap,Ua=new WeakMap,Ql=new WeakMap,Jl=new WeakMap,on=new WeakMap,fs=new WeakMap,za=new WeakMap,Zl=new WeakMap,ct=new WeakSet,Wd=function(){const e=document.createElement("div"),t=a(this,fs)._signal;e.addEventListener("contextmenu",bs,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,i]of a(this,fs).highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",i),n.title=s,n.setAttribute("data-l10n-id",a(we,Zl)[s]);const r=document.createElement("span");n.append(r),r.className="swatch",r.style.backgroundColor=i,n.setAttribute("aria-selected",i===a(this,ja)),n.addEventListener("click",y(this,ct,Xd).bind(this,i),{signal:t}),e.append(n)}return e.addEventListener("keydown",y(this,ct,Yd).bind(this),{signal:t}),e},Xd=function(e,t){t.stopPropagation(),a(this,Jl).dispatch("switchannotationeditorparams",{source:this,type:a(this,za),value:e})},Yd=function(e){we._keyboardManager.exec(this,e)},Tn=function(e){if(a(this,ct,Di)){this.hideDropdown();return}if(m(this,Kl,e.detail===0),a(this,on)||(m(this,on,new AbortController),window.addEventListener("pointerdown",y(this,ct,Wp).bind(this),{signal:a(this,fs).combinedSignal(a(this,on))})),a(this,Ht)){a(this,Ht).classList.remove("hidden");return}const t=m(this,Ht,y(this,ct,Wd).call(this));a(this,us).append(t)},Wp=function(e){var t;(t=a(this,Ht))!=null&&t.contains(e.target)||this.hideDropdown()},Di=function(){return a(this,Ht)&&!a(this,Ht).classList.contains("hidden")},b(we,Zl,null);let oc=we;var Ga,ql,mi,yr,Va,xe,th,eh,Ar,Qe,Fe,Qt,Wa,vi,ae,Xa,Je,sh,Q,Kd,Vh,Xp,Yp,Kp,Qd,Cn,ts,Vr,Qp,Wh,xo,Jp,Zp,qp,tg,eg;const rt=class rt extends mt{constructor(t){super({...t,name:"highlightEditor"});b(this,Q);b(this,Ga,null);b(this,ql,0);b(this,mi);b(this,yr,null);b(this,Va,null);b(this,xe,null);b(this,th,null);b(this,eh,0);b(this,Ar,null);b(this,Qe,null);b(this,Fe,null);b(this,Qt,!1);b(this,Wa,null);b(this,vi);b(this,ae,null);b(this,Xa,"");b(this,Je);b(this,sh,"");this.color=t.color||rt._defaultColor,m(this,Je,t.thickness||rt._defaultThickness),m(this,vi,t.opacity||rt._defaultOpacity),m(this,mi,t.boxes||null),m(this,sh,t.methodOfCreation||""),m(this,Xa,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(m(this,Qt,!0),y(this,Q,Vh).call(this,t),y(this,Q,Cn).call(this)):a(this,mi)&&(m(this,Ga,t.anchorNode),m(this,ql,t.anchorOffset),m(this,th,t.focusNode),m(this,eh,t.focusOffset),y(this,Q,Kd).call(this),y(this,Q,Cn).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=rt.prototype;return tt(this,"_keyboardManager",new hh([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:a(this,Qt)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:a(this,Je),methodOfCreation:a(this,sh)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var i;mt.initialize(t,s),rt._defaultColor||(rt._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case et.HIGHLIGHT_DEFAULT_COLOR:rt._defaultColor=s;break;case et.HIGHLIGHT_THICKNESS:rt._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return a(this,Wa)}updateParams(t,s){switch(t){case et.HIGHLIGHT_COLOR:y(this,Q,Xp).call(this,s);break;case et.HIGHLIGHT_THICKNESS:y(this,Q,Yp).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[et.HIGHLIGHT_DEFAULT_COLOR,rt._defaultColor],[et.HIGHLIGHT_THICKNESS,rt._defaultThickness]]}get propertiesToUpdate(){return[[et.HIGHLIGHT_COLOR,this.color||rt._defaultColor],[et.HIGHLIGHT_THICKNESS,a(this,Je)||rt._defaultThickness],[et.HIGHLIGHT_FREE,a(this,Qt)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(m(this,Va,new oc({editor:this})),t.addColorPicker(a(this,Va))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(y(this,Q,xo).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,y(this,Q,xo).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){y(this,Q,Qd).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(y(this,Q,Cn).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?y(this,Q,Qd).call(this):t&&(y(this,Q,Cn).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var n,r,o;const{drawLayer:s}=this.parent;let i;a(this,Qt)?(t=(t-this.rotation+360)%360,i=y(n=rt,ts,Vr).call(n,a(this,Qe).box,t)):i=y(r=rt,ts,Vr).call(r,[this.x,this.y,this.width,this.height],t),s.updateProperties(a(this,Fe),{bbox:i,root:{"data-main-rotation":t}}),s.updateProperties(a(this,ae),{bbox:y(o=rt,ts,Vr).call(o,a(this,xe).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();a(this,Xa)&&(t.setAttribute("aria-label",a(this,Xa)),t.setAttribute("role","mark")),a(this,Qt)?t.classList.add("free"):this.div.addEventListener("keydown",y(this,Q,Qp).bind(this),{signal:this._uiManager._signal});const s=m(this,Ar,document.createElement("div"));t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=a(this,yr);const[i,n]=this.parentDimensions;return this.setDims(this.width*i,this.height*n),wf(this,a(this,Ar),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(a(this,ae),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(a(this,ae),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:y(this,Q,Wh).call(this,!0);break;case 1:case 3:y(this,Q,Wh).call(this,!1);break}}select(){var t;super.select(),a(this,ae)&&((t=this.parent)==null||t.drawLayer.updateProperties(a(this,ae),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),a(this,ae)&&((t=this.parent)==null||t.drawLayer.updateProperties(a(this,ae),{rootClass:{selected:!1}}),a(this,Qt)||y(this,Q,Wh).call(this,!1))}get _mustFixPosition(){return!a(this,Qt)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(a(this,Fe),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(a(this,ae),{rootClass:{hidden:!t}}))}static startHighlighting(t,s,{target:i,x:n,y:r}){const{x:o,y:l,width:h,height:d}=i.getBoundingClientRect(),u=new AbortController,f=t.combinedSignal(u),p=v=>{u.abort(),y(this,ts,tg).call(this,t,v)};window.addEventListener("blur",p,{signal:f}),window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("pointerdown",Dt,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",bs,{signal:f}),i.addEventListener("pointermove",y(this,ts,qp).bind(this,t),{signal:f}),this._freeHighlight=new Vd({x:n,y:r},[o,l,h,d],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,s,i){var g,A,w,S;let n=null;if(t instanceof Ip){const{data:{quadPoints:E,rect:T,rotation:x,id:C,color:R,opacity:I,popupRef:P},parent:{page:{pageNumber:M}}}=t;n=t={annotationType:K.HIGHLIGHT,color:Array.from(R),opacity:I,quadPoints:E,boxes:null,pageIndex:M-1,rect:T.slice(0),rotation:x,id:C,deleted:!1,popupRef:P}}else if(t instanceof Ru){const{data:{inkLists:E,rect:T,rotation:x,id:C,color:R,borderStyle:{rawWidth:I},popupRef:P},parent:{page:{pageNumber:M}}}=t;n=t={annotationType:K.HIGHLIGHT,color:Array.from(R),thickness:I,inkLists:E,boxes:null,pageIndex:M-1,rect:T.slice(0),rotation:x,id:C,deleted:!1,popupRef:P}}const{color:r,quadPoints:o,inkLists:l,opacity:h}=t,d=await super.deserialize(t,s,i);d.color=V.makeHexColor(...r),m(d,vi,h||1),l&&m(d,Je,t.thickness),d.annotationElementId=t.id||null,d._initialData=n;const[u,f]=d.pageDimensions,[p,v]=d.pageTranslation;if(o){const E=m(d,mi,[]);for(let T=0;T<o.length;T+=8)E.push({x:(o[T]-p)/u,y:1-(o[T+1]-v)/f,width:(o[T+2]-o[T])/u,height:(o[T+1]-o[T+5])/f});y(g=d,Q,Kd).call(g),y(A=d,Q,Cn).call(A),d.rotate(d.rotation)}else if(l){m(d,Qt,!0);const E=l[0],T={x:E[0]-p,y:f-(E[1]-v)},x=new Vd(T,[0,0,u,f],1,a(d,Je)/2,!0,.001);for(let I=0,P=E.length;I<P;I+=2)T.x=E[I]-p,T.y=f-(E[I+1]-v),x.add(T);const{id:C,clipPathId:R}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:x.toSVGPath()}},!0,!0);y(w=d,Q,Vh).call(w,{highlightOutlines:x.getOutlines(),highlightId:C,clipPathId:R}),y(S=d,Q,Cn).call(S),d.rotate(d.parentRotation)}return d}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=this.getRect(0,0),i=mt._colorManager.convert(this.color),n={annotationType:K.HIGHLIGHT,color:i,opacity:a(this,vi),thickness:a(this,Je),quadPoints:y(this,Q,Jp).call(this),outlines:y(this,Q,Zp).call(this,s),pageIndex:this.pageIndex,rect:s,rotation:y(this,Q,xo).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!y(this,Q,eg).call(this,n)?null:(n.id=this.annotationElementId,n)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Ga=new WeakMap,ql=new WeakMap,mi=new WeakMap,yr=new WeakMap,Va=new WeakMap,xe=new WeakMap,th=new WeakMap,eh=new WeakMap,Ar=new WeakMap,Qe=new WeakMap,Fe=new WeakMap,Qt=new WeakMap,Wa=new WeakMap,vi=new WeakMap,ae=new WeakMap,Xa=new WeakMap,Je=new WeakMap,sh=new WeakMap,Q=new WeakSet,Kd=function(){const t=new zd(a(this,mi),.001);m(this,Qe,t.getOutlines()),[this.x,this.y,this.width,this.height]=a(this,Qe).box;const s=new zd(a(this,mi),.0025,.001,this._uiManager.direction==="ltr");m(this,xe,s.getOutlines());const{lastPoint:i}=a(this,xe);m(this,Wa,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},Vh=function({highlightOutlines:t,highlightId:s,clipPathId:i}){var u,f;if(m(this,Qe,t),m(this,xe,t.getNewOutline(a(this,Je)/2+1.5,.0025)),s>=0)m(this,Fe,s),m(this,yr,i),this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}}),m(this,ae,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:a(this,xe).box,path:{d:a(this,xe).toSVGPath()}},!0));else if(this.parent){const p=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(a(this,Fe),{bbox:y(u=rt,ts,Vr).call(u,a(this,Qe).box,(p-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(a(this,ae),{bbox:y(f=rt,ts,Vr).call(f,a(this,xe).box,p),path:{d:a(this,xe).toSVGPath()}})}const[r,o,l,h]=t.box;switch(this.rotation){case 0:this.x=r,this.y=o,this.width=l,this.height=h;break;case 90:{const[p,v]=this.parentDimensions;this.x=o,this.y=1-r,this.width=l*v/p,this.height=h*p/v;break}case 180:this.x=1-r,this.y=1-o,this.width=l,this.height=h;break;case 270:{const[p,v]=this.parentDimensions;this.x=1-o,this.y=r,this.width=l*v/p,this.height=h*p/v;break}}const{lastPoint:d}=a(this,xe);m(this,Wa,[(d[0]-r)/l,(d[1]-o)/h])},Xp=function(t){const s=(r,o)=>{var l,h;this.color=r,m(this,vi,o),(l=this.parent)==null||l.drawLayer.updateProperties(a(this,Fe),{root:{fill:r,"fill-opacity":o}}),(h=a(this,Va))==null||h.updateColor(r)},i=this.color,n=a(this,vi);this.addCommands({cmd:s.bind(this,t,rt._defaultOpacity),undo:s.bind(this,i,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:et.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},Yp=function(t){const s=a(this,Je),i=n=>{m(this,Je,n),y(this,Q,Kp).call(this,n)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:et.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},Kp=function(t){if(!a(this,Qt))return;y(this,Q,Vh).call(this,{highlightOutlines:a(this,Qe).getNewOutline(t/2)}),this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)},Qd=function(){a(this,Fe)===null||!this.parent||(this.parent.drawLayer.remove(a(this,Fe)),m(this,Fe,null),this.parent.drawLayer.remove(a(this,ae)),m(this,ae,null))},Cn=function(t=this.parent){a(this,Fe)===null&&({id:he(this,Fe)._,clipPathId:he(this,yr)._}=t.drawLayer.draw({bbox:a(this,Qe).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":a(this,vi)},rootClass:{highlight:!0,free:a(this,Qt)},path:{d:a(this,Qe).toSVGPath()}},!1,!0),m(this,ae,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:a(this,Qt)},bbox:a(this,xe).box,path:{d:a(this,xe).toSVGPath()}},a(this,Qt))),a(this,Ar)&&(a(this,Ar).style.clipPath=a(this,yr)))},ts=new WeakSet,Vr=function([t,s,i,n],r){switch(r){case 90:return[1-s-n,t,n,i];case 180:return[1-t-i,1-s-n,i,n];case 270:return[s,1-t-i,n,i]}return[t,s,i,n]},Qp=function(t){rt._keyboardManager.exec(this,t)},Wh=function(t){if(!a(this,Ga))return;const s=window.getSelection();t?s.setPosition(a(this,Ga),a(this,ql)):s.setPosition(a(this,th),a(this,eh))},xo=function(){return a(this,Qt)?this.rotation:0},Jp=function(){if(a(this,Qt))return null;const[t,s]=this.pageDimensions,[i,n]=this.pageTranslation,r=a(this,mi),o=new Float32Array(r.length*8);let l=0;for(const{x:h,y:d,width:u,height:f}of r){const p=h*t+i,v=(1-d)*s+n;o[l]=o[l+4]=p,o[l+1]=o[l+3]=v,o[l+2]=o[l+6]=p+u*t,o[l+5]=o[l+7]=v-f*s,l+=8}return o},Zp=function(t){return a(this,Qe).serialize(t,y(this,Q,xo).call(this))},qp=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},tg=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},eg=function(t){const{color:s}=this._initialData;return t.color.some((i,n)=>i!==s[n])},b(rt,ts),O(rt,"_defaultColor",null),O(rt,"_defaultOpacity",1),O(rt,"_defaultThickness",12),O(rt,"_type","highlight"),O(rt,"_editorType",K.HIGHLIGHT),O(rt,"_freeHighlightId",-1),O(rt,"_freeHighlight",null),O(rt,"_freeHighlightClipId","");let lc=rt;var wr;class sg{constructor(){b(this,wr,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,s)}updateSVGProperty(e,t){a(this,wr)[e]=t}toSVGProperties(){const e=a(this,wr);return m(this,wr,Object.create(null)),{root:e}}reset(){m(this,wr,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){dt("Not implemented")}}wr=new WeakMap;var ke,Ya,zt,Er,Sr,ln,hn,cn,xr,st,Jd,Zd,qd,To,ig,Xh,Co,Wr;const $=class $ extends mt{constructor(t){super(t);b(this,st);b(this,ke,null);b(this,Ya);O(this,"_drawId",null);m(this,Ya,t.mustBeCommitted||!1),this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(y(this,st,Jd).call(this,t),y(this,st,To).call(this))}static _mergeSVGProperties(t,s){const i=new Set(Object.keys(t));for(const[n,r]of Object.entries(s))i.has(n)?Object.assign(t[n],r):t[n]=r;return t}static getDefaultDrawingOptions(t){dt("Not implemented")}static get typesMap(){dt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(a($,zt).updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,s)}static get defaultPropertiesToUpdate(){const t=[],s=this._defaultDrawingOptions;for(const[i,n]of this.typesMap)t.push([i,s[n]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:s}=this;for(const[i,n]of this.constructor.typesMap)t.push([i,s[n]]);return t}_updateProperty(t,s,i){const n=this._drawingOptions,r=n[s],o=l=>{var d;n.updateProperty(s,l);const h=a(this,ke).updateProperty(s,l);h&&y(this,st,Co).call(this,h),(d=this.parent)==null||d.drawLayer.updateProperties(this._drawId,n.toSVGProperties())};this.addCommands({cmd:o.bind(this,i),undo:o.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,$._mergeSVGProperties(a(this,ke).getPathResizingSVGProperties(y(this,st,Xh).call(this)),{bbox:y(this,st,Wr).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,$._mergeSVGProperties(a(this,ke).getPathResizedSVGProperties(y(this,st,Xh).call(this)),{bbox:y(this,st,Wr).call(this)}))}_onTranslating(t,s){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:y(this,st,Wr).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,$._mergeSVGProperties(a(this,ke).getPathTranslatedSVGProperties(y(this,st,Xh).call(this),this.parentDimensions),{bbox:y(this,st,Wr).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,a(this,Ya)&&(m(this,Ya,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){y(this,st,qd).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(y(this,st,To).call(this),y(this,st,Co).call(this,a(this,ke).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),y(this,st,qd).call(this)):t&&(this._uiManager.addShouldRescale(this),y(this,st,To).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,$._mergeSVGProperties({bbox:y(this,st,Wr).call(this)},a(this,ke).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&y(this,st,Co).call(this,a(this,ke).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,s;this._isCopy&&(t=this.x,s=this.y);const i=super.render();i.classList.add("draw");const n=document.createElement("div");i.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";const[r,o]=this.parentDimensions;return this.setDims(this.width*r,this.height*o),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,s),i}static createDrawerInstance(t,s,i,n,r){dt("Not implemented")}static startDrawing(t,s,i,n){var A;const{target:r,offsetX:o,offsetY:l,pointerId:h,pointerType:d}=n;if(a($,hn)&&a($,hn)!==d)return;const{viewport:{rotation:u}}=t,{width:f,height:p}=r.getBoundingClientRect(),v=m($,Er,new AbortController),g=t.combinedSignal(v);if(a($,ln)||m($,ln,h),a($,hn)??m($,hn,d),window.addEventListener("pointerup",w=>{var S;a($,ln)===w.pointerId?this._endDraw(w):(S=a($,cn))==null||S.delete(w.pointerId)},{signal:g}),window.addEventListener("pointercancel",w=>{var S;a($,ln)===w.pointerId?this._currentParent.endDrawingSession():(S=a($,cn))==null||S.delete(w.pointerId)},{signal:g}),window.addEventListener("pointerdown",w=>{a($,hn)===w.pointerType&&((a($,cn)||m($,cn,new Set)).add(w.pointerId),a($,zt).isCancellable()&&(a($,zt).removeLastElement(),a($,zt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",bs,{signal:g}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:g}),r.addEventListener("touchmove",w=>{w.timeStamp===a($,xr)&&Dt(w)},{signal:g}),t.toggleDrawing(),(A=s._editorUndoBar)==null||A.hide(),a($,zt)){t.drawLayer.updateProperties(this._currentDrawId,a($,zt).startNew(o,l,f,p,u));return}s.updateUIForDefaultProperties(this),m($,zt,this.createDrawerInstance(o,l,f,p,u)),m($,Sr,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(a($,Sr).toSVGProperties(),a($,zt).defaultSVGProperties),!0,!1)}static _drawMove(t){var r;if(m($,xr,-1),!a($,zt))return;const{offsetX:s,offsetY:i,pointerId:n}=t;if(a($,ln)===n){if(((r=a($,cn))==null?void 0:r.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,a($,zt).add(s,i)),m($,xr,t.timeStamp),Dt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,m($,zt,null),m($,Sr,null),m($,hn,null),m($,xr,NaN)),a($,Er)&&(a($,Er).abort(),m($,Er,null),m($,ln,NaN),m($,cn,null))}static _endDraw(t){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===s.div&&s.drawLayer.updateProperties(this._currentDrawId,a($,zt).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=a($,zt),n=this._currentDrawId,r=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(n,i.setLastElement(r))},undo:()=>{s.drawLayer.updateProperties(n,i.removeLastElement())},mustExec:!1,type:et.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(et.DRAW_STEP),!a($,zt).isEmpty()){const{pageDimensions:[i,n],scale:r}=s,o=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:a($,zt).getOutlines(i*r,n*r,r,this._INNER_MARGIN),drawingOptions:a($,Sr),mustBeCommitted:!t});return this._cleanup(!0),o}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,i,n,r,o){dt("Not implemented")}static async deserialize(t,s,i){var u,f;const{rawDims:{pageWidth:n,pageHeight:r,pageX:o,pageY:l}}=s.viewport,h=this.deserializeDraw(o,l,n,r,this._INNER_MARGIN,t),d=await super.deserialize(t,s,i);return d.createDrawingOptions(t),y(u=d,st,Jd).call(u,{drawOutlines:h}),y(f=d,st,To).call(f),d.onScaleChanging(),d.rotate(),d}serializeDraw(t){const[s,i]=this.pageTranslation,[n,r]=this.pageDimensions;return a(this,ke).serialize([s,i,n,r],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};ke=new WeakMap,Ya=new WeakMap,zt=new WeakMap,Er=new WeakMap,Sr=new WeakMap,ln=new WeakMap,hn=new WeakMap,cn=new WeakMap,xr=new WeakMap,st=new WeakSet,Jd=function({drawOutlines:t,drawId:s,drawingOptions:i}){m(this,ke,t),this._drawingOptions||(this._drawingOptions=i),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=y(this,st,Zd).call(this,t,this.parent),y(this,st,Co).call(this,t.box)},Zd=function(t,s){const{id:i}=s.drawLayer.draw($._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},qd=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},To=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=y(this,st,Zd).call(this,a(this,ke),t)}},ig=function([t,s,i,n]){const{parentDimensions:[r,o],rotation:l}=this;switch(l){case 90:return[s,1-t,i*(o/r),n*(r/o)];case 180:return[1-t,1-s,i,n];case 270:return[1-s,t,i*(o/r),n*(r/o)];default:return[t,s,i,n]}},Xh=function(){const{x:t,y:s,width:i,height:n,parentDimensions:[r,o],rotation:l}=this;switch(l){case 90:return[1-s,t,i*(r/o),n*(o/r)];case 180:return[1-t,1-s,i,n];case 270:return[s,1-t,i*(r/o),n*(o/r)];default:return[t,s,i,n]}},Co=function(t){if([this.x,this.y,this.width,this.height]=y(this,st,ig).call(this,t),this.div){this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)}this._onResized()},Wr=function(){const{x:t,y:s,width:i,height:n,rotation:r,parentRotation:o,parentDimensions:[l,h]}=this;switch((r*4+o)/90){case 1:return[1-s-n,t,n,i];case 2:return[1-t-i,1-s-n,i,n];case 3:return[s,1-t-i,n,i];case 4:return[t,s-i*(l/h),n*(h/l),i*(l/h)];case 5:return[1-s,t,i*(l/h),n*(h/l)];case 6:return[1-t-n*(h/l),1-s,n*(h/l),i*(l/h)];case 7:return[s-i*(l/h),1-t-n*(h/l),i*(l/h),n*(h/l)];case 8:return[t-i,s-n,i,n];case 9:return[1-s,t-i,n,i];case 10:return[1-t,1-s,i,n];case 11:return[s-n,1-t,n,i];case 12:return[t-n*(h/l),s,n*(h/l),i*(l/h)];case 13:return[1-s-i*(l/h),t-n*(h/l),i*(l/h),n*(h/l)];case 14:return[1-t,1-s-i*(l/h),n*(h/l),i*(l/h)];case 15:return[s,1-t,i*(l/h),n*(h/l)];default:return[t,s,i,n]}},O($,"_currentDrawId",-1),O($,"_currentParent",null),b($,zt,null),b($,Er,null),b($,Sr,null),b($,ln,NaN),b($,hn,null),b($,cn,null),b($,xr,NaN),O($,"_INNER_MARGIN",3);let hc=$;var Fs,Gt,Vt,Tr,Ka,ue,Jt,Ze,Cr,Rr,Ir,Qa,Yh;class Nv{constructor(e,t,s,i,n,r){b(this,Qa);b(this,Fs,new Float64Array(6));b(this,Gt);b(this,Vt);b(this,Tr);b(this,Ka);b(this,ue);b(this,Jt,"");b(this,Ze,0);b(this,Cr,new uh);b(this,Rr);b(this,Ir);m(this,Rr,s),m(this,Ir,i),m(this,Tr,n),m(this,Ka,r),[e,t]=y(this,Qa,Yh).call(this,e,t);const o=m(this,Gt,[NaN,NaN,NaN,NaN,e,t]);m(this,ue,[e,t]),m(this,Vt,[{line:o,points:a(this,ue)}]),a(this,Fs).set(o,0)}updateProperty(e,t){e==="stroke-width"&&m(this,Ka,t)}isEmpty(){return!a(this,Vt)||a(this,Vt).length===0}isCancellable(){return a(this,ue).length<=10}add(e,t){[e,t]=y(this,Qa,Yh).call(this,e,t);const[s,i,n,r]=a(this,Fs).subarray(2,6),o=e-n,l=t-r;return Math.hypot(a(this,Rr)*o,a(this,Ir)*l)<=2?null:(a(this,ue).push(e,t),isNaN(s)?(a(this,Fs).set([n,r,e,t],2),a(this,Gt).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(a(this,Fs)[0])&&a(this,Gt).splice(6,6),a(this,Fs).set([s,i,n,r,e,t],0),a(this,Gt).push(...H.createBezierPoints(s,i,n,r,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(a(this,ue).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,i,n){m(this,Rr,s),m(this,Ir,i),m(this,Tr,n),[e,t]=y(this,Qa,Yh).call(this,e,t);const r=m(this,Gt,[NaN,NaN,NaN,NaN,e,t]);m(this,ue,[e,t]);const o=a(this,Vt).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),a(this,Vt).push({line:r,points:a(this,ue)}),a(this,Fs).set(r,0),m(this,Ze,0),this.toSVGPath(),null}getLastElement(){return a(this,Vt).at(-1)}setLastElement(e){return a(this,Vt)?(a(this,Vt).push(e),m(this,Gt,e.line),m(this,ue,e.points),m(this,Ze,0),{path:{d:this.toSVGPath()}}):a(this,Cr).setLastElement(e)}removeLastElement(){if(!a(this,Vt))return a(this,Cr).removeLastElement();a(this,Vt).pop(),m(this,Jt,"");for(let e=0,t=a(this,Vt).length;e<t;e++){const{line:s,points:i}=a(this,Vt)[e];m(this,Gt,s),m(this,ue,i),m(this,Ze,0),this.toSVGPath()}return{path:{d:a(this,Jt)}}}toSVGPath(){const e=H.svgRound(a(this,Gt)[4]),t=H.svgRound(a(this,Gt)[5]);if(a(this,ue).length===2)return m(this,Jt,`${a(this,Jt)} M ${e} ${t} Z`),a(this,Jt);if(a(this,ue).length<=6){const i=a(this,Jt).lastIndexOf("M");m(this,Jt,`${a(this,Jt).slice(0,i)} M ${e} ${t}`),m(this,Ze,6)}if(a(this,ue).length===4){const i=H.svgRound(a(this,Gt)[10]),n=H.svgRound(a(this,Gt)[11]);return m(this,Jt,`${a(this,Jt)} L ${i} ${n}`),m(this,Ze,12),a(this,Jt)}const s=[];a(this,Ze)===0&&(s.push(`M ${e} ${t}`),m(this,Ze,6));for(let i=a(this,Ze),n=a(this,Gt).length;i<n;i+=6){const[r,o,l,h,d,u]=a(this,Gt).slice(i,i+6).map(H.svgRound);s.push(`C${r} ${o} ${l} ${h} ${d} ${u}`)}return m(this,Jt,a(this,Jt)+s.join(" ")),m(this,Ze,a(this,Gt).length),a(this,Jt)}getOutlines(e,t,s,i){const n=a(this,Vt).at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),a(this,Cr).build(a(this,Vt),e,t,s,a(this,Tr),a(this,Ka),i),m(this,Fs,null),m(this,Gt,null),m(this,Vt,null),m(this,Jt,null),a(this,Cr)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Fs=new WeakMap,Gt=new WeakMap,Vt=new WeakMap,Tr=new WeakMap,Ka=new WeakMap,ue=new WeakMap,Jt=new WeakMap,Ze=new WeakMap,Cr=new WeakMap,Rr=new WeakMap,Ir=new WeakMap,Qa=new WeakSet,Yh=function(e,t){return H._normalizePoint(e,t,a(this,Rr),a(this,Ir),a(this,Tr))};var fe,ih,nh,_e,ks,_s,Ja,Za,Pr,qt,Vs,ng,rg,ag;class uh extends H{constructor(){super(...arguments);b(this,qt);b(this,fe);b(this,ih,0);b(this,nh);b(this,_e);b(this,ks);b(this,_s);b(this,Ja);b(this,Za);b(this,Pr)}build(t,s,i,n,r,o,l){m(this,ks,s),m(this,_s,i),m(this,Ja,n),m(this,Za,r),m(this,Pr,o),m(this,nh,l??0),m(this,_e,t),y(this,qt,rg).call(this)}get thickness(){return a(this,Pr)}setLastElement(t){return a(this,_e).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return a(this,_e).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of a(this,_e)){if(t.push(`M${H.svgRound(s[4])} ${H.svgRound(s[5])}`),s.length===6){t.push("Z");continue}if(s.length===12&&isNaN(s[6])){t.push(`L${H.svgRound(s[10])} ${H.svgRound(s[11])}`);continue}for(let i=6,n=s.length;i<n;i+=6){const[r,o,l,h,d,u]=s.subarray(i,i+6).map(H.svgRound);t.push(`C${r} ${o} ${l} ${h} ${d} ${u}`)}}return t.join("")}serialize([t,s,i,n],r){const o=[],l=[],[h,d,u,f]=y(this,qt,ng).call(this);let p,v,g,A,w,S,E,T,x;switch(a(this,Za)){case 0:x=H._rescale,p=t,v=s+n,g=i,A=-n,w=t+h*i,S=s+(1-d-f)*n,E=t+(h+u)*i,T=s+(1-d)*n;break;case 90:x=H._rescaleAndSwap,p=t,v=s,g=i,A=n,w=t+d*i,S=s+h*n,E=t+(d+f)*i,T=s+(h+u)*n;break;case 180:x=H._rescale,p=t+i,v=s,g=-i,A=n,w=t+(1-h-u)*i,S=s+d*n,E=t+(1-h)*i,T=s+(d+f)*n;break;case 270:x=H._rescaleAndSwap,p=t+i,v=s+n,g=-i,A=-n,w=t+(1-d-f)*i,S=s+(1-h-u)*n,E=t+(1-d)*i,T=s+(1-h)*n;break}for(const{line:C,points:R}of a(this,_e))o.push(x(C,p,v,g,A,r?new Array(C.length):null)),l.push(x(R,p,v,g,A,r?new Array(R.length):null));return{lines:o,points:l,rect:[w,S,E,T]}}static deserialize(t,s,i,n,r,{paths:{lines:o,points:l},rotation:h,thickness:d}){const u=[];let f,p,v,g,A;switch(h){case 0:A=H._rescale,f=-t/i,p=s/n+1,v=1/i,g=-1/n;break;case 90:A=H._rescaleAndSwap,f=-s/n,p=-t/i,v=1/n,g=1/i;break;case 180:A=H._rescale,f=t/i+1,p=-s/n,v=-1/i,g=1/n;break;case 270:A=H._rescaleAndSwap,f=s/n+1,p=t/i+1,v=-1/n,g=-1/i;break}if(!o){o=[];for(const S of l){const E=S.length;if(E===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1]]));continue}if(E===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1],NaN,NaN,NaN,NaN,S[2],S[3]]));continue}const T=new Float32Array(3*(E-2));o.push(T);let[x,C,R,I]=S.subarray(0,4);T.set([NaN,NaN,NaN,NaN,x,C],0);for(let P=4;P<E;P+=2){const M=S[P],D=S[P+1];T.set(H.createBezierPoints(x,C,R,I,M,D),(P-2)*3),[x,C,R,I]=[R,I,M,D]}}}for(let S=0,E=o.length;S<E;S++)u.push({line:A(o[S].map(T=>T??NaN),f,p,v,g),points:A(l[S].map(T=>T??NaN),f,p,v,g)});const w=new this.prototype.constructor;return w.build(u,i,n,1,h,d,r),w}get box(){return a(this,fe)}updateProperty(t,s){return t==="stroke-width"?y(this,qt,ag).call(this,s):null}updateParentDimensions([t,s],i){const[n,r]=y(this,qt,Vs).call(this);m(this,ks,t),m(this,_s,s),m(this,Ja,i);const[o,l]=y(this,qt,Vs).call(this),h=o-n,d=l-r,u=a(this,fe);return u[0]-=h,u[1]-=d,u[2]+=2*h,u[3]+=2*d,u}updateRotation(t){return m(this,ih,t),{path:{transform:this.rotationTransform}}}get viewBox(){return a(this,fe).map(H.svgRound).join(" ")}get defaultProperties(){const[t,s]=a(this,fe);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=a(this,fe);let i=0,n=0,r=0,o=0,l=0,h=0;switch(a(this,ih)){case 90:n=s/t,r=-t/s,l=t;break;case 180:i=-1,o=-1,l=t,h=s;break;case 270:n=-s/t,r=t/s,h=s;break;default:return""}return`matrix(${i} ${n} ${r} ${o} ${H.svgRound(l)} ${H.svgRound(h)})`}getPathResizingSVGProperties([t,s,i,n]){const[r,o]=y(this,qt,Vs).call(this),[l,h,d,u]=a(this,fe);if(Math.abs(d-r)<=H.PRECISION||Math.abs(u-o)<=H.PRECISION){const A=t+i/2-(l+d/2),w=s+n/2-(h+u/2);return{path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(s)}`,transform:`${this.rotationTransform} translate(${A} ${w})`}}}const f=(i-2*r)/(d-2*r),p=(n-2*o)/(u-2*o),v=d/i,g=u/n;return{path:{"transform-origin":`${H.svgRound(l)} ${H.svgRound(h)}`,transform:`${this.rotationTransform} scale(${v} ${g}) translate(${H.svgRound(r)} ${H.svgRound(o)}) scale(${f} ${p}) translate(${H.svgRound(-r)} ${H.svgRound(-o)})`}}}getPathResizedSVGProperties([t,s,i,n]){const[r,o]=y(this,qt,Vs).call(this),l=a(this,fe),[h,d,u,f]=l;if(l[0]=t,l[1]=s,l[2]=i,l[3]=n,Math.abs(u-r)<=H.PRECISION||Math.abs(f-o)<=H.PRECISION){const w=t+i/2-(h+u/2),S=s+n/2-(d+f/2);for(const{line:E,points:T}of a(this,_e))H._translate(E,w,S,E),H._translate(T,w,S,T);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(i-2*r)/(u-2*r),v=(n-2*o)/(f-2*o),g=-p*(h+r)+t+r,A=-v*(d+o)+s+o;if(p!==1||v!==1||g!==0||A!==0)for(const{line:w,points:S}of a(this,_e))H._rescale(w,g,A,p,v,w),H._rescale(S,g,A,p,v,S);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(t)} ${H.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],i){const[n,r]=i,o=a(this,fe),l=t-o[0],h=s-o[1];if(a(this,ks)===n&&a(this,_s)===r)for(const{line:d,points:u}of a(this,_e))H._translate(d,l,h,d),H._translate(u,l,h,u);else{const d=a(this,ks)/n,u=a(this,_s)/r;m(this,ks,n),m(this,_s,r);for(const{line:f,points:p}of a(this,_e))H._rescale(f,l,h,d,u,f),H._rescale(p,l,h,d,u,p);o[2]*=d,o[3]*=u}return o[0]=t,o[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${H.svgRound(t)} ${H.svgRound(s)}`}}}get defaultSVGProperties(){const t=a(this,fe);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${H.svgRound(t[0])} ${H.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}fe=new WeakMap,ih=new WeakMap,nh=new WeakMap,_e=new WeakMap,ks=new WeakMap,_s=new WeakMap,Ja=new WeakMap,Za=new WeakMap,Pr=new WeakMap,qt=new WeakSet,Vs=function(t=a(this,Pr)){const s=a(this,nh)+t/2*a(this,Ja);return a(this,Za)%180===0?[s/a(this,ks),s/a(this,_s)]:[s/a(this,_s),s/a(this,ks)]},ng=function(){const[t,s,i,n]=a(this,fe),[r,o]=y(this,qt,Vs).call(this,0);return[t+r,s+o,i-2*r,n-2*o]},rg=function(){const t=m(this,fe,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:n}of a(this,_e)){if(n.length<=12){for(let l=4,h=n.length;l<h;l+=6)V.pointBoundingBox(n[l],n[l+1],t);continue}let r=n[4],o=n[5];for(let l=6,h=n.length;l<h;l+=6){const[d,u,f,p,v,g]=n.subarray(l,l+6);V.bezierBoundingBox(r,o,d,u,f,p,v,g,t),r=v,o=g}}const[s,i]=y(this,qt,Vs).call(this);t[0]=me(t[0]-s,0,1),t[1]=me(t[1]-i,0,1),t[2]=me(t[2]+s,0,1),t[3]=me(t[3]+i,0,1),t[2]-=t[0],t[3]-=t[1]},ag=function(t){const[s,i]=y(this,qt,Vs).call(this);m(this,Pr,t);const[n,r]=y(this,qt,Vs).call(this),[o,l]=[n-s,r-i],h=a(this,fe);return h[0]-=o,h[1]-=l,h[2]+=2*o,h[3]+=2*l,h};class kc extends sg{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:mt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new kc(this._viewParameters);return e.updateAll(this),e}}var Rc,og;const Kr=class Kr extends hc{constructor(t){super({...t,name:"inkEditor"});b(this,Rc);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,s){mt.initialize(t,s),this._defaultDrawingOptions=new kc(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return tt(this,"typesMap",new Map([[et.INK_THICKNESS,"stroke-width"],[et.INK_COLOR,"stroke"],[et.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,i,n,r){return new Nv(t,s,i,n,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,i,n,r,o){return uh.deserialize(t,s,i,n,r,o)}static async deserialize(t,s,i){let n=null;if(t instanceof Ru){const{data:{inkLists:o,rect:l,rotation:h,id:d,color:u,opacity:f,borderStyle:{rawWidth:p},popupRef:v},parent:{page:{pageNumber:g}}}=t;n=t={annotationType:K.INK,color:Array.from(u),thickness:p,opacity:f,paths:{points:o},boxes:null,pageIndex:g-1,rect:l.slice(0),rotation:h,id:d,deleted:!1,popupRef:v}}const r=await super.deserialize(t,s,i);return r.annotationElementId=t.id||null,r._initialData=n,r}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:i}=this;s.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:s,opacity:i}){this._drawingOptions=Kr.getDefaultDrawingOptions({stroke:V.makeHexColor(...t),"stroke-width":s,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:i,rect:n}=this.serializeDraw(t),{_drawingOptions:{stroke:r,"stroke-opacity":o,"stroke-width":l}}=this,h={annotationType:K.INK,color:mt._colorManager.convert(r),opacity:o,thickness:l,paths:{lines:s,points:i},pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(h.isCopy=!0,h):this.annotationElementId&&!y(this,Rc,og).call(this,h)?null:(h.id=this.annotationElementId,h)}renderAnnotationElement(t){const{points:s,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:s}),null}};Rc=new WeakSet,og=function(t){const{color:s,thickness:i,opacity:n,pageIndex:r}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((o,l)=>o!==s[l])||t.thickness!==i||t.opacity!==n||t.pageIndex!==r},O(Kr,"_type","ink"),O(Kr,"_editorType",K.INK),O(Kr,"_defaultDrawingOptions",null);let tu=Kr;class eu extends uh{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const Eh=8,lo=3;var Mr,ot,su,ps,lg,hg,iu,Kh,cg,dg,ug,nu,ru,fg;class xi{static extractContoursFromText(e,{fontFamily:t,fontStyle:s,fontWeight:i},n,r,o,l){let h=new OffscreenCanvas(1,1),d=h.getContext("2d",{alpha:!1});const u=200,f=d.font=`${s} ${i} ${u}px ${t}`,{actualBoundingBoxLeft:p,actualBoundingBoxRight:v,actualBoundingBoxAscent:g,actualBoundingBoxDescent:A,fontBoundingBoxAscent:w,fontBoundingBoxDescent:S,width:E}=d.measureText(e),T=1.5,x=Math.ceil(Math.max(Math.abs(p)+Math.abs(v)||0,E)*T),C=Math.ceil(Math.max(Math.abs(g)+Math.abs(A)||u,Math.abs(w)+Math.abs(S)||u)*T);h=new OffscreenCanvas(x,C),d=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),d.font=f,d.filter="grayscale(1)",d.fillStyle="white",d.fillRect(0,0,x,C),d.fillStyle="black",d.fillText(e,x*(T-1)/2,C*(3-T)/2);const R=y(this,ot,nu).call(this,d.getImageData(0,0,x,C).data),I=y(this,ot,ug).call(this,R),P=y(this,ot,ru).call(this,I),M=y(this,ot,iu).call(this,R,x,C,P);return this.processDrawnLines({lines:{curves:M,width:x,height:C},pageWidth:n,pageHeight:r,rotation:o,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(e,t,s,i,n){const[r,o,l]=y(this,ot,fg).call(this,e),[h,d]=y(this,ot,dg).call(this,r,o,l,Math.hypot(o,l)*a(this,Mr).sigmaSFactor,a(this,Mr).sigmaR,a(this,Mr).kernelSize),u=y(this,ot,ru).call(this,d),f=y(this,ot,iu).call(this,h,o,l,u);return this.processDrawnLines({lines:{curves:f,width:o,height:l},pageWidth:t,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:r,areContours:o}){i%180!==0&&([t,s]=[s,t]);const{curves:l,width:h,height:d}=e,u=e.thickness??0,f=[],p=Math.min(t/h,s/d),v=p/t,g=p/s,A=[];for(const{points:S}of l){const E=r?y(this,ot,cg).call(this,S):S;if(!E)continue;A.push(E);const T=E.length,x=new Float32Array(T),C=new Float32Array(3*(T===2?2:T-2));if(f.push({line:C,points:x}),T===2){x[0]=E[0]*v,x[1]=E[1]*g,C.set([NaN,NaN,NaN,NaN,x[0],x[1]],0);continue}let[R,I,P,M]=E;R*=v,I*=g,P*=v,M*=g,x.set([R,I,P,M],0),C.set([NaN,NaN,NaN,NaN,R,I],0);for(let D=4;D<T;D+=2){const G=x[D]=E[D]*v,U=x[D+1]=E[D+1]*g;C.set(H.createBezierPoints(R,I,P,M,G,U),(D-2)*3),[R,I,P,M]=[P,M,G,U]}}if(f.length===0)return null;const w=o?new eu:new uh;return w.build(f,t,s,1,i,o?0:u,n),{outline:w,newCurves:A,areContours:o,thickness:u,width:h,height:d}}static async compressSignature({outlines:e,areContours:t,thickness:s,width:i,height:n}){let r=1/0,o=-1/0,l=0;for(const E of e){l+=E.length;for(let T=2,x=E.length;T<x;T++){const C=E[T]-E[T-2];r=Math.min(r,C),o=Math.max(o,C)}}let h;r>=-128&&o<=127?h=Int8Array:r>=-32768&&o<=32767?h=Int16Array:h=Int32Array;const d=e.length,u=Eh+lo*d,f=new Uint32Array(u);let p=0;f[p++]=u*Uint32Array.BYTES_PER_ELEMENT+(l-2*d)*h.BYTES_PER_ELEMENT,f[p++]=0,f[p++]=i,f[p++]=n,f[p++]=t?0:1,f[p++]=Math.max(0,Math.floor(s??0)),f[p++]=d,f[p++]=h.BYTES_PER_ELEMENT;for(const E of e)f[p++]=E.length-2,f[p++]=E[0],f[p++]=E[1];const v=new CompressionStream("deflate-raw"),g=v.writable.getWriter();await g.ready,g.write(f);const A=h.prototype.constructor;for(const E of e){const T=new A(E.length-2);for(let x=2,C=E.length;x<C;x++)T[x-2]=E[x]-E[x-2];g.write(T)}g.close();const w=await new Response(v.readable).arrayBuffer(),S=new Uint8Array(w);return ff(S)}static async decompressSignature(e){try{const t=nm(e),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),n=i.getWriter();await n.ready,n.write(t).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let r=null,o=0;for await(const E of s)r||(r=new Uint8Array(new Uint32Array(E.buffer,0,4)[0])),r.set(E,o),o+=E.length;const l=new Uint32Array(r.buffer,0,r.length>>2),h=l[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const d=l[2],u=l[3],f=l[4]===0,p=l[5],v=l[6],g=l[7],A=[],w=(Eh+lo*v)*Uint32Array.BYTES_PER_ELEMENT;let S;switch(g){case Int8Array.BYTES_PER_ELEMENT:S=new Int8Array(r.buffer,w);break;case Int16Array.BYTES_PER_ELEMENT:S=new Int16Array(r.buffer,w);break;case Int32Array.BYTES_PER_ELEMENT:S=new Int32Array(r.buffer,w);break}o=0;for(let E=0;E<v;E++){const T=l[lo*E+Eh],x=new Float32Array(T+2);A.push(x);for(let C=0;C<lo-1;C++)x[C]=l[lo*E+Eh+C+1];for(let C=0;C<T;C++)x[C+2]=x[C]+S[o++]}return{areContours:f,thickness:p,outlines:A,width:d,height:u}}catch(t){return Y(`decompressSignature: ${t}`),null}}}Mr=new WeakMap,ot=new WeakSet,su=function(e,t,s,i){return s-=e,i-=t,s===0?i>0?0:4:s===1?i+6:2-i},ps=new WeakMap,lg=function(e,t,s,i,n,r,o){const l=y(this,ot,su).call(this,s,i,n,r);for(let h=0;h<8;h++){const d=(-h+l-o+16)%8,u=a(this,ps)[2*d],f=a(this,ps)[2*d+1];if(e[(s+u)*t+(i+f)]!==0)return d}return-1},hg=function(e,t,s,i,n,r,o){const l=y(this,ot,su).call(this,s,i,n,r);for(let h=0;h<8;h++){const d=(h+l+o+16)%8,u=a(this,ps)[2*d],f=a(this,ps)[2*d+1];if(e[(s+u)*t+(i+f)]!==0)return d}return-1},iu=function(e,t,s,i){const n=e.length,r=new Int32Array(n);for(let d=0;d<n;d++)r[d]=e[d]<=i?1:0;for(let d=1;d<s-1;d++)r[d*t]=r[d*t+t-1]=0;for(let d=0;d<t;d++)r[d]=r[t*s-1-d]=0;let o=1,l;const h=[];for(let d=1;d<s-1;d++){l=1;for(let u=1;u<t-1;u++){const f=d*t+u,p=r[f];if(p===0)continue;let v=d,g=u;if(p===1&&r[f-1]===0)o+=1,g-=1;else if(p>=1&&r[f+1]===0)o+=1,g+=1,p>1&&(l=p);else{p!==1&&(l=Math.abs(p));continue}const A=[u,d],w=g===u+1,S={isHole:w,points:A,id:o,parent:0};h.push(S);let E;for(const D of h)if(D.id===l){E=D;break}E?E.isHole?S.parent=w?E.parent:l:S.parent=w?l:E.parent:S.parent=w?l:0;const T=y(this,ot,lg).call(this,r,t,d,u,v,g,0);if(T===-1){r[f]=-o,r[f]!==1&&(l=Math.abs(r[f]));continue}let x=a(this,ps)[2*T],C=a(this,ps)[2*T+1];const R=d+x,I=u+C;v=R,g=I;let P=d,M=u;for(;;){const D=y(this,ot,hg).call(this,r,t,P,M,v,g,1);x=a(this,ps)[2*D],C=a(this,ps)[2*D+1];const G=P+x,U=M+C;A.push(U,G);const W=P*t+M;if(r[W+1]===0?r[W]=-o:r[W]===1&&(r[W]=o),G===d&&U===u&&P===R&&M===I){r[f]!==1&&(l=Math.abs(r[f]));break}else v=P,g=M,P=G,M=U}}}return h},Kh=function(e,t,s,i){if(s-t<=4){for(let R=t;R<s-2;R+=2)i.push(e[R],e[R+1]);return}const n=e[t],r=e[t+1],o=e[s-4]-n,l=e[s-3]-r,h=Math.hypot(o,l),d=o/h,u=l/h,f=d*r-u*n,p=l/o,v=1/h,g=Math.atan(p),A=Math.cos(g),w=Math.sin(g),S=v*(Math.abs(A)+Math.abs(w)),E=v*(1-S+S**2),T=Math.max(Math.atan(Math.abs(w+A)*E),Math.atan(Math.abs(w-A)*E));let x=0,C=t;for(let R=t+2;R<s-2;R+=2){const I=Math.abs(f-d*e[R+1]+u*e[R]);I>x&&(C=R,x=I)}x>(h*T)**2?(y(this,ot,Kh).call(this,e,t,C+2,i),y(this,ot,Kh).call(this,e,C,s,i)):i.push(n,r)},cg=function(e){const t=[],s=e.length;return y(this,ot,Kh).call(this,e,0,s,t),t.push(e[s-2],e[s-1]),t.length<=4?null:t},dg=function(e,t,s,i,n,r){const o=new Float32Array(r**2),l=-2*i**2,h=r>>1;for(let g=0;g<r;g++){const A=(g-h)**2;for(let w=0;w<r;w++)o[g*r+w]=Math.exp((A+(w-h)**2)/l)}const d=new Float32Array(256),u=-2*n**2;for(let g=0;g<256;g++)d[g]=Math.exp(g**2/u);const f=e.length,p=new Uint8Array(f),v=new Uint32Array(256);for(let g=0;g<s;g++)for(let A=0;A<t;A++){const w=g*t+A,S=e[w];let E=0,T=0;for(let C=0;C<r;C++){const R=g+C-h;if(!(R<0||R>=s))for(let I=0;I<r;I++){const P=A+I-h;if(P<0||P>=t)continue;const M=e[R*t+P],D=o[C*r+I]*d[Math.abs(M-S)];E+=M*D,T+=D}}const x=p[w]=Math.round(E/T);v[x]++}return[p,v]},ug=function(e){const t=new Uint32Array(256);for(const s of e)t[s]++;return t},nu=function(e){const t=e.length,s=new Uint8ClampedArray(t>>2);let i=-1/0,n=1/0;for(let o=0,l=s.length;o<l;o++){if(e[(o<<2)+3]===0){i=s[o]=255;continue}const d=s[o]=e[o<<2];d>i&&(i=d),d<n&&(n=d)}const r=255/(i-n);for(let o=0;o<t;o++)s[o]=(s[o]-n)*r;return s},ru=function(e){let t,s=-1/0,i=-1/0;const n=e.findIndex(l=>l!==0);let r=n,o=n;for(t=n;t<256;t++){const l=e[t];l>s&&(t-r>i&&(i=t-r,o=t-1),s=l,r=t)}for(t=o-1;t>=0&&!(e[t]>e[t+1]);t--);return t},fg=function(e){const t=e,{width:s,height:i}=e,{maxDim:n}=a(this,Mr);let r=s,o=i;if(s>n||i>n){let f=s,p=i,v=Math.log2(Math.max(s,i)/n);const g=Math.floor(v);v=v===g?g-1:g;for(let w=0;w<v;w++){r=Math.ceil(f/2),o=Math.ceil(p/2);const S=new OffscreenCanvas(r,o);S.getContext("2d").drawImage(e,0,0,f,p,0,0,r,o),f=r,p=o,e!==t&&e.close(),e=S.transferToImageBitmap()}const A=Math.min(n/r,n/o);r=Math.round(r*A),o=Math.round(o*A)}const h=new OffscreenCanvas(r,o).getContext("2d",{willReadFrequently:!0});h.filter="grayscale(1)",h.drawImage(e,0,0,e.width,e.height,0,0,r,o);const d=h.getImageData(0,0,r,o).data;return[y(this,ot,nu).call(this,d),r,o]},b(xi,ot),b(xi,Mr,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),b(xi,ps,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class Iu extends sg{constructor(){super(),super.updateProperties({fill:mt._defaultLineColor,"stroke-width":0})}clone(){const e=new Iu;return e.updateAll(this),e}}class Pu extends kc{constructor(e){super(e),super.updateProperties({stroke:mt._defaultLineColor,"stroke-width":1})}clone(){const e=new Pu(this._viewParameters);return e.updateAll(this),e}}var dn,Be,un,fn;const Ce=class Ce extends hc{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});b(this,dn,!1);b(this,Be,null);b(this,un,null);b(this,fn,null);this._willKeepAspectRatio=!0,m(this,un,t.signatureData||null),m(this,Be,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,s){mt.initialize(t,s),this._defaultDrawingOptions=new Iu,this._defaultDrawnSignatureOptions=new Pu(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!1}static get typesMap(){return tt(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!a(this,Be)}}static computeTelemetryFinalData(t){const s=t.get("hasDescription");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,s;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,t=this.x,s=this.y),super.render(),this._drawId===null)if(a(this,un)){const{lines:n,mustSmooth:r,areContours:o,description:l,uuid:h,heightInPage:d}=a(this,un),{rawDims:{pageWidth:u,pageHeight:f},rotation:p}=this.parent.viewport,v=xi.processDrawnLines({lines:n,pageWidth:u,pageHeight:f,rotation:p,innerMargin:Ce._INNER_MARGIN,mustSmooth:r,areContours:o});this.addSignature(v,d,l,h)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);return i&&(this._isCopy=!0,this._moveAfterPaste(t,s)),this.div}setUuid(t){m(this,fn,t),this.addEditToolbar()}getUuid(){return a(this,fn)}get description(){return a(this,Be)}set description(t){m(this,Be,t),super.addEditToolbar().then(s=>{s==null||s.updateEditSignatureButton(t)})}getSignaturePreview(){const{newCurves:t,areContours:s,thickness:i,width:n,height:r}=a(this,un),o=Math.max(n,r),l=xi.processDrawnLines({lines:{curves:t.map(h=>({points:h})),thickness:i,width:n,height:r},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:s});return{areContours:s,outline:l.outline}}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.signatureManager&&a(this,Be)!==null&&(await t.addEditSignatureButton(this._uiManager.signatureManager,a(this,fn),a(this,Be)),t.show()),t):null}addSignature(t,s,i,n){const{x:r,y:o}=this,{outline:l}=m(this,un,t);m(this,dn,l instanceof eu),m(this,Be,i),this.div.setAttribute("data-l10n-args",JSON.stringify({description:i}));let h;a(this,dn)?h=Ce.getDefaultDrawingOptions():(h=Ce._defaultDrawnSignatureOptions.clone(),h.updateProperties({"stroke-width":l.thickness})),this._addOutlines({drawOutlines:l,drawingOptions:h});const[d,u]=this.parentDimensions,[,f]=this.pageDimensions;let p=s/f;p=p>=1?.5:p,this.width*=p/this.height,this.width>=1&&(p*=.9/this.width,this.width=.9),this.height=p,this.setDims(d*this.width,u*this.height),this.x=r,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(n),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!n,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return xi.process(t,s,i,n,Ce._INNER_MARGIN)}getFromText(t,s){const{rawDims:{pageWidth:i,pageHeight:n},rotation:r}=this.parent.viewport;return xi.extractContoursFromText(t,s,i,n,r,Ce._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return xi.processDrawnLines({lines:t,pageWidth:s,pageHeight:i,rotation:n,innerMargin:Ce._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:s}){t?this._drawingOptions=Ce.getDefaultDrawingOptions():(this._drawingOptions=Ce._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":s}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:s,points:i,rect:n}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":r}}=this,o={annotationType:K.SIGNATURE,isSignature:!0,areContours:a(this,dn),color:[0,0,0],thickness:a(this,dn)?0:r,pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(o.paths={lines:s,points:i},o.uuid=a(this,fn),o.isCopy=!0):o.lines=s,a(this,Be)&&(o.accessibilityData={type:"Figure",alt:a(this,Be)}),o}static deserializeDraw(t,s,i,n,r,o){return o.areContours?eu.deserialize(t,s,i,n,r,o):uh.deserialize(t,s,i,n,r,o)}static async deserialize(t,s,i){var r;const n=await super.deserialize(t,s,i);return m(n,dn,t.areContours),m(n,Be,((r=t.accessibilityData)==null?void 0:r.alt)||""),m(n,fn,t.uuid),n}};dn=new WeakMap,Be=new WeakMap,un=new WeakMap,fn=new WeakMap,O(Ce,"_type","signature"),O(Ce,"_editorType",K.SIGNATURE),O(Ce,"_defaultDrawingOptions",null);let au=Ce;var wt,Wt,pn,bi,gn,qa,yi,Lr,Bs,He,to,it,Ro,Io,Qh,Jh,Zh,lu,qh,pg;class ou extends mt{constructor(t){super({...t,name:"stampEditor"});b(this,it);b(this,wt,null);b(this,Wt,null);b(this,pn,null);b(this,bi,null);b(this,gn,null);b(this,qa,"");b(this,yi,null);b(this,Lr,!1);b(this,Bs,null);b(this,He,!1);b(this,to,!1);m(this,bi,t.bitmapUrl),m(this,gn,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,s){mt.initialize(t,s)}static isHandlingMimeForPasting(t){return qc.includes(t)}static paste(t,s){s.pasteEditor({mode:K.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:r,height:o}=t||this.copyCanvas(null,null,!0).imageData,l=await i.guess({name:"altText",request:{data:n,width:r,height:o,channels:n.length/(r*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const h=l.output;return await this.setGuessedAltText(h),s&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){var t;a(this,Wt)&&(m(this,wt,null),this._uiManager.imageManager.deleteId(a(this,Wt)),(t=a(this,yi))==null||t.remove(),m(this,yi,null),a(this,Bs)&&(clearTimeout(a(this,Bs)),m(this,Bs,null))),super.remove()}rebuild(){if(!this.parent){a(this,Wt)&&y(this,it,Qh).call(this);return}super.rebuild(),this.div!==null&&(a(this,Wt)&&a(this,yi)===null&&y(this,it,Qh).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(a(this,pn)||a(this,wt)||a(this,bi)||a(this,gn)||a(this,Wt)||a(this,Lr))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;return this._isCopy&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),a(this,Lr)||(a(this,wt)?y(this,it,Jh).call(this):y(this,it,Qh).call(this)),this._isCopy&&this._moveAfterPaste(t,s),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,s){const{id:i,bitmap:n}=this._uiManager.imageManager.getFromCanvas(t,s);s.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(m(this,Wt,i),n&&m(this,wt,n),m(this,Lr,!1),y(this,it,Jh).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;a(this,Bs)!==null&&clearTimeout(a(this,Bs)),m(this,Bs,setTimeout(()=>{m(this,Bs,null),y(this,it,lu).call(this)},200))}copyCanvas(t,s,i=!1){var p;t||(t=224);const{width:n,height:r}=a(this,wt),o=new js;let l=a(this,wt),h=n,d=r,u=null;if(s){if(n>s||r>s){const I=Math.min(s/n,s/r);h=Math.floor(n*I),d=Math.floor(r*I)}u=document.createElement("canvas");const v=u.width=Math.ceil(h*o.sx),g=u.height=Math.ceil(d*o.sy);a(this,He)||(l=y(this,it,Zh).call(this,v,g));const A=u.getContext("2d");A.filter=this._uiManager.hcmFilter;let w="white",S="#cfcfd8";this._uiManager.hcmFilter!=="none"?S="black":(p=window.matchMedia)!=null&&p.call(window,"(prefers-color-scheme: dark)").matches&&(w="#8f8f9d",S="#42414d");const E=15,T=E*o.sx,x=E*o.sy,C=new OffscreenCanvas(T*2,x*2),R=C.getContext("2d");R.fillStyle=w,R.fillRect(0,0,T*2,x*2),R.fillStyle=S,R.fillRect(0,0,T,x),R.fillRect(T,x,T,x),A.fillStyle=A.createPattern(C,"repeat"),A.fillRect(0,0,v,g),A.drawImage(l,0,0,l.width,l.height,0,0,v,g)}let f=null;if(i){let v,g;if(o.symmetric&&l.width<t&&l.height<t)v=l.width,g=l.height;else if(l=a(this,wt),n>t||r>t){const S=Math.min(t/n,t/r);v=Math.floor(n*S),g=Math.floor(r*S),a(this,He)||(l=y(this,it,Zh).call(this,v,g))}const w=new OffscreenCanvas(v,g).getContext("2d",{willReadFrequently:!0});w.drawImage(l,0,0,l.width,l.height,0,0,v,g),f={width:v,height:g,data:w.getImageData(0,0,v,g).data}}return{canvas:u,width:h,height:d,imageData:f}}static async deserialize(t,s,i){var A;let n=null,r=!1;if(t instanceof Pp){const{data:{rect:w,rotation:S,id:E,structParent:T,popupRef:x},container:C,parent:{page:{pageNumber:R}},canvas:I}=t;let P,M;I?(delete t.canvas,{id:P,bitmap:M}=i.imageManager.getFromCanvas(C.id,I),I.remove()):(r=!0,t._hasNoCanvas=!0);const D=((A=await s._structTree.getAriaAttributes(`${yu}${E}`))==null?void 0:A.get("aria-label"))||"";n=t={annotationType:K.STAMP,bitmapId:P,bitmap:M,pageIndex:R-1,rect:w.slice(0),rotation:S,id:E,deleted:!1,accessibilityData:{decorative:!1,altText:D},isSvg:!1,structParent:T,popupRef:x}}const o=await super.deserialize(t,s,i),{rect:l,bitmap:h,bitmapUrl:d,bitmapId:u,isSvg:f,accessibilityData:p}=t;r?(i.addMissingCanvas(t.id,o),m(o,Lr,!0)):u&&i.imageManager.isValidId(u)?(m(o,Wt,u),h&&m(o,wt,h)):m(o,bi,d),m(o,He,f);const[v,g]=o.pageDimensions;return o.width=(l[2]-l[0])/v,o.height=(l[3]-l[1])/g,o.annotationElementId=t.id||null,p&&(o.altTextData=p),o._initialData=n,m(o,to,!!n),o}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i={annotationType:K.STAMP,bitmapId:a(this,Wt),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:a(this,He),structTreeParentId:this._structTreeParentId};if(t)return i.bitmapUrl=y(this,it,qh).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:n,altText:r}=this.serializeAltText(!1);if(!n&&r&&(i.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){const l=y(this,it,pg).call(this,i);if(l.isSame)return null;l.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,s===null)return i;s.stamps||(s.stamps=new Map);const o=a(this,He)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(a(this,Wt)))s.stamps.set(a(this,Wt),{area:o,serialized:i}),i.bitmap=y(this,it,qh).call(this,!1);else if(a(this,He)){const l=s.stamps.get(a(this,Wt));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=y(this,it,qh).call(this,!1))}return i}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}}wt=new WeakMap,Wt=new WeakMap,pn=new WeakMap,bi=new WeakMap,gn=new WeakMap,qa=new WeakMap,yi=new WeakMap,Lr=new WeakMap,Bs=new WeakMap,He=new WeakMap,to=new WeakMap,it=new WeakSet,Ro=function(t,s=!1){if(!t){this.remove();return}m(this,wt,t.bitmap),s||(m(this,Wt,t.id),m(this,He,t.isSvg)),t.file&&m(this,qa,t.file.name),y(this,it,Jh).call(this)},Io=function(){if(m(this,pn,null),this._uiManager.enableWaiting(!1),!!a(this,yi)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,wt)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,wt)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Qh=function(){if(a(this,Wt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(a(this,Wt)).then(i=>y(this,it,Ro).call(this,i,!0)).finally(()=>y(this,it,Io).call(this));return}if(a(this,bi)){const i=a(this,bi);m(this,bi,null),this._uiManager.enableWaiting(!0),m(this,pn,this._uiManager.imageManager.getFromUrl(i).then(n=>y(this,it,Ro).call(this,n)).finally(()=>y(this,it,Io).call(this)));return}if(a(this,gn)){const i=a(this,gn);m(this,gn,null),this._uiManager.enableWaiting(!0),m(this,pn,this._uiManager.imageManager.getFromFile(i).then(n=>y(this,it,Ro).call(this,n)).finally(()=>y(this,it,Io).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=qc.join(",");const s=this._uiManager._signal;m(this,pn,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),y(this,it,Ro).call(this,n)}i()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>y(this,it,Io).call(this))),t.click()},Jh=function(){var u;const{div:t}=this;let{width:s,height:i}=a(this,wt);const[n,r]=this.pageDimensions,o=.75;if(this.width)s=this.width*n,i=this.height*r;else if(s>o*n||i>o*r){const f=Math.min(o*n/s,o*r/i);s*=f,i*=f}const[l,h]=this.parentDimensions;this.setDims(s*l/n,i*h/r),this._uiManager.enableWaiting(!1);const d=m(this,yi,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=s/n,this.height=i/r,(u=this._initialOptions)!=null&&u.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),y(this,it,lu).call(this),a(this,to)||(this.parent.addUndoableEditor(this),m(this,to,!0)),this._reportTelemetry({action:"inserted_image"}),a(this,qa)&&this.div.setAttribute("aria-description",a(this,qa))},Zh=function(t,s){const{width:i,height:n}=a(this,wt);let r=i,o=n,l=a(this,wt);for(;r>2*t||o>2*s;){const h=r,d=o;r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),o>2*s&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const u=new OffscreenCanvas(r,o);u.getContext("2d").drawImage(l,0,0,h,d,0,0,r,o),l=u.transferToImageBitmap()}return l},lu=function(){const[t,s]=this.parentDimensions,{width:i,height:n}=this,r=new js,o=Math.ceil(i*t*r.sx),l=Math.ceil(n*s*r.sy),h=a(this,yi);if(!h||h.width===o&&h.height===l)return;h.width=o,h.height=l;const d=a(this,He)?a(this,wt):y(this,it,Zh).call(this,o,l),u=h.getContext("2d");u.filter=this._uiManager.hcmFilter,u.drawImage(d,0,0,d.width,d.height,0,0,o,l)},qh=function(t){if(t){if(a(this,He)){const n=this._uiManager.imageManager.getSvgUrl(a(this,Wt));if(n)return n}const s=document.createElement("canvas");return{width:s.width,height:s.height}=a(this,wt),s.getContext("2d").drawImage(a(this,wt),0,0),s.toDataURL()}if(a(this,He)){const[s,i]=this.pageDimensions,n=Math.round(this.width*s*An.PDF_TO_CSS_UNITS),r=Math.round(this.height*i*An.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(n,r);return o.getContext("2d").drawImage(a(this,wt),0,0,a(this,wt).width,a(this,wt).height,0,0,n,r),o.transferToImageBitmap()}return structuredClone(a(this,wt))},pg=function(t){var o;const{pageIndex:s,accessibilityData:{altText:i}}=this._initialData,n=t.pageIndex===s,r=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&n&&r,isSameAltText:r}},O(ou,"_type","stamp"),O(ou,"_editorType",K.STAMP);var Or,eo,Hs,mn,Ai,qe,vn,so,Dr,gs,wi,oe,Ei,z,bn,Et,gg,Ss,cu,du,tc;const is=class is{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:i,accessibilityManager:n,annotationLayer:r,drawLayer:o,textLayer:l,viewport:h,l10n:d}){b(this,Et);b(this,Or);b(this,eo,!1);b(this,Hs,null);b(this,mn,null);b(this,Ai,null);b(this,qe,new Map);b(this,vn,!1);b(this,so,!1);b(this,Dr,!1);b(this,gs,null);b(this,wi,null);b(this,oe,null);b(this,Ei,null);b(this,z);const u=[...a(is,bn).values()];if(!is._initialized){is._initialized=!0;for(const f of u)f.initialize(d,e)}e.registerEditorTypes(u),m(this,z,e),this.pageIndex=t,this.div=s,m(this,Or,n),m(this,Hs,r),this.viewport=h,m(this,oe,l),this.drawLayer=o,this._structTree=i,a(this,z).addLayer(this)}get isEmpty(){return a(this,qe).size===0}get isInvisible(){return this.isEmpty&&a(this,z).getMode()===K.NONE}updateToolbar(e){a(this,z).updateToolbar(e)}updateMode(e=a(this,z).getMode()){switch(y(this,Et,tc).call(this),e){case K.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case K.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case K.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const s of a(is,bn).values())t.toggle(`${s._type}Editing`,e===s._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=a(this,oe))==null?void 0:t.div)}setEditingState(e){a(this,z).setEditingState(e)}addCommands(e){a(this,z).addCommands(e)}cleanUndoStack(e){a(this,z).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=a(this,Hs))==null||t.div.classList.toggle("disabled",!e)}async enable(){m(this,Dr,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const s of a(this,qe).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(a(this,z).removeChangedExistingAnnotation(s),e.add(s.annotationElementId));if(!a(this,Hs)){m(this,Dr,!1);return}const t=a(this,Hs).getEditableAnnotations();for(const s of t){if(s.hide(),a(this,z).isDeletedAnnotationElement(s.data.id)||e.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}m(this,Dr,!1)}disable(){var i;m(this,so,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const n of a(this,qe).values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){e.set(n.annotationElementId,n);continue}else t.set(n.annotationElementId,n);(i=this.getEditableAnnotation(n.annotationElementId))==null||i.show(),n.remove()}if(a(this,Hs)){const n=a(this,Hs).getEditableAnnotations();for(const r of n){const{id:o}=r.data;if(a(this,z).isDeletedAnnotationElement(o))continue;let l=t.get(o);if(l){l.resetAnnotationElement(r),l.show(!1),r.show();continue}l=e.get(o),l&&(a(this,z).addChangedExistingAnnotation(l),l.renderAnnotationElement(r)&&l.show(!1)),r.show()}}y(this,Et,tc).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const n of a(is,bn).values())s.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),m(this,so,!1)}getEditableAnnotation(e){var t;return((t=a(this,Hs))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){a(this,z).getActive()!==e&&a(this,z).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=a(this,oe))!=null&&e.div&&!a(this,Ei)){m(this,Ei,new AbortController);const t=a(this,z).combinedSignal(a(this,Ei));a(this,oe).div.addEventListener("pointerdown",y(this,Et,gg).bind(this),{signal:t}),a(this,oe).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=a(this,oe))!=null&&e.div&&a(this,Ei)&&(a(this,Ei).abort(),m(this,Ei,null),a(this,oe).div.classList.remove("highlighting"))}enableClick(){if(a(this,mn))return;m(this,mn,new AbortController);const e=a(this,z).combinedSignal(a(this,mn));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=a(this,mn))==null||e.abort(),m(this,mn,null)}attach(e){a(this,qe).set(e.id,e);const{annotationElementId:t}=e;t&&a(this,z).isDeletedAnnotationElement(t)&&a(this,z).removeDeletedAnnotationElement(e)}detach(e){var t;a(this,qe).delete(e.id),(t=a(this,Or))==null||t.removePointerInTextLayer(e.contentDiv),!a(this,so)&&e.annotationElementId&&a(this,z).addDeletedAnnotationElement(e)}remove(e){this.detach(e),a(this,z).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(a(this,z).addDeletedAnnotationElement(e.annotationElementId),mt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),a(this,z).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!a(this,Dr)),a(this,z).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!a(this,Ai)&&(e._focusEventsAllowed=!1,m(this,Ai,setTimeout(()=>{m(this,Ai,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:a(this,z)._signal}),t.focus())},0))),e._structTreeParentId=(s=a(this,Or))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getNextId(){return a(this,z).getId()}combinedSignal(e){return a(this,z).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=a(this,Et,Ss))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await a(this,z).updateMode(e.mode);const{offsetX:s,offsetY:i}=y(this,Et,du).call(this),n=this.getNextId(),r=y(this,Et,cu).call(this,{parent:this,id:n,x:s,y:i,uiManager:a(this,z),isCentered:!0,...t});r&&this.add(r)}async deserialize(e){var t;return await((t=a(is,bn).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,a(this,z)))||null}createAndAddNewEditor(e,t,s={}){const i=this.getNextId(),n=y(this,Et,cu).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:a(this,z),isCentered:t,...s});return n&&this.add(n),n}addNewEditor(e={}){this.createAndAddNewEditor(y(this,Et,du).call(this),!0,e)}setSelected(e){a(this,z).setSelected(e)}toggleSelected(e){a(this,z).toggleSelected(e)}unselect(e){a(this,z).unselect(e)}pointerup(e){var i;const{isMac:t}=ee.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!a(this,vn)||(m(this,vn,!1),(i=a(this,Et,Ss))!=null&&i.isDrawer&&a(this,Et,Ss).supportMultipleDrawings))return;if(!a(this,eo)){m(this,eo,!0);return}const s=a(this,z).getMode();if(s===K.STAMP||s===K.SIGNATURE){a(this,z).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var i;if(a(this,z).getMode()===K.HIGHLIGHT&&this.enableTextSelection(),a(this,vn)){m(this,vn,!1);return}const{isMac:t}=ee.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(m(this,vn,!0),(i=a(this,Et,Ss))!=null&&i.isDrawer){this.startDrawingSession(e);return}const s=a(this,z).getActive();m(this,eo,!s||s.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),a(this,gs)){a(this,Et,Ss).startDrawing(this,a(this,z),!1,e);return}a(this,z).setCurrentDrawingSession(this),m(this,gs,new AbortController);const t=a(this,z).combinedSignal(a(this,gs));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(m(this,wi,null),this.commitOrRemove())},{signal:t}),a(this,Et,Ss).startDrawing(this,a(this,z),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&m(this,wi,t);return}a(this,wi)&&setTimeout(()=>{var t;(t=a(this,wi))==null||t.focus(),m(this,wi,null)},0)}endDrawingSession(e=!1){return a(this,gs)?(a(this,z).setCurrentDrawingSession(null),a(this,gs).abort(),m(this,gs,null),m(this,wi,null),a(this,Et,Ss).endDrawing(e)):null}findNewParent(e,t,s){const i=a(this,z).findParent(t,s);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return a(this,gs)?(this.endDrawingSession(),!0):!1}onScaleChanging(){a(this,gs)&&a(this,Et,Ss).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=a(this,z).getActive())==null?void 0:e.parent)===this&&(a(this,z).commitOrRemove(),a(this,z).setActiveEditor(null)),a(this,Ai)&&(clearTimeout(a(this,Ai)),m(this,Ai,null));for(const s of a(this,qe).values())(t=a(this,Or))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,a(this,qe).clear(),a(this,z).removeLayer(this)}render({viewport:e}){this.viewport=e,Fr(this.div,e);for(const t of a(this,z).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){a(this,z).commitOrRemove(),y(this,Et,tc).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,Fr(this.div,{rotation:s}),t!==s)for(const i of a(this,qe).values())i.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return a(this,z).viewParameters.realScale}};Or=new WeakMap,eo=new WeakMap,Hs=new WeakMap,mn=new WeakMap,Ai=new WeakMap,qe=new WeakMap,vn=new WeakMap,so=new WeakMap,Dr=new WeakMap,gs=new WeakMap,wi=new WeakMap,oe=new WeakMap,Ei=new WeakMap,z=new WeakMap,bn=new WeakMap,Et=new WeakSet,gg=function(e){a(this,z).unselectAll();const{target:t}=e;if(t===a(this,oe).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&a(this,oe).div.contains(t)){const{isMac:s}=ee.platform;if(e.button!==0||e.ctrlKey&&s)return;a(this,z).showAllEditors("highlight",!0,!0),a(this,oe).div.classList.add("free"),this.toggleDrawing(),lc.startHighlighting(this,a(this,z).direction==="ltr",{target:a(this,oe).div,x:e.x,y:e.y}),a(this,oe).div.addEventListener("pointerup",()=>{a(this,oe).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:a(this,z)._signal}),e.preventDefault()}},Ss=function(){return a(is,bn).get(a(this,z).getMode())},cu=function(e){const t=a(this,Et,Ss);return t?new t.prototype.constructor(e):null},du=function(){const{x:e,y:t,width:s,height:i}=this.div.getBoundingClientRect(),n=Math.max(0,e),r=Math.max(0,t),o=Math.min(window.innerWidth,e+s),l=Math.min(window.innerHeight,t+i),h=(n+o)/2-e,d=(r+l)/2-t,[u,f]=this.viewport.rotation%180===0?[h,d]:[d,h];return{offsetX:u,offsetY:f}},tc=function(){for(const e of a(this,qe).values())e.isEmpty()&&e.remove()},O(is,"_initialized",!1),b(is,bn,new Map([jd,tu,ou,lc,au].map(e=>[e._editorType,e])));let hu=is;var ms,pe,Nr,rh,Ic,mg,Us,fu,vg,pu;const _t=class _t{constructor({pageIndex:e}){b(this,Us);b(this,ms,null);b(this,pe,new Map);b(this,Nr,new Map);this.pageIndex=e}setParent(e){if(!a(this,ms)){m(this,ms,e);return}if(a(this,ms)!==e){if(a(this,pe).size>0)for(const t of a(this,pe).values())t.remove(),e.append(t);m(this,ms,e)}}static get _svgFactory(){return tt(this,"_svgFactory",new rc)}draw(e,t=!1,s=!1){const i=he(_t,rh)._++,n=y(this,Us,fu).call(this),r=_t._svgFactory.createElement("defs");n.append(r);const o=_t._svgFactory.createElement("path");r.append(o);const l=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),t&&a(this,Nr).set(i,o);const h=s?y(this,Us,vg).call(this,r,l):null,d=_t._svgFactory.createElement("use");return n.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(n,e),a(this,pe).set(i,n),{id:i,clipPathId:`url(#${h})`}}drawOutline(e,t){const s=he(_t,rh)._++,i=y(this,Us,fu).call(this),n=_t._svgFactory.createElement("defs");i.append(n);const r=_t._svgFactory.createElement("path");n.append(r);const o=`path_p${this.pageIndex}_${s}`;r.setAttribute("id",o),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const u=_t._svgFactory.createElement("mask");n.append(u),l=`mask_p${this.pageIndex}_${s}`,u.setAttribute("id",l),u.setAttribute("maskUnits","objectBoundingBox");const f=_t._svgFactory.createElement("rect");u.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const p=_t._svgFactory.createElement("use");u.append(p),p.setAttribute("href",`#${o}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const h=_t._svgFactory.createElement("use");i.append(h),h.setAttribute("href",`#${o}`),l&&h.setAttribute("mask",`url(#${l})`);const d=h.cloneNode();return i.append(d),h.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(i,e),a(this,pe).set(s,i),s}finalizeDraw(e,t){a(this,Nr).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:s,bbox:i,rootClass:n,path:r}=t,o=typeof e=="number"?a(this,pe).get(e):e;if(o){if(s&&y(this,Us,pu).call(this,o,s),i&&y(l=_t,Ic,mg).call(l,o,i),n){const{classList:h}=o;for(const[d,u]of Object.entries(n))h.toggle(d,u)}if(r){const d=o.firstChild.firstChild;y(this,Us,pu).call(this,d,r)}}}updateParent(e,t){if(t===this)return;const s=a(this,pe).get(e);s&&(a(t,ms).append(s),a(this,pe).delete(e),a(t,pe).set(e,s))}remove(e){a(this,Nr).delete(e),a(this,ms)!==null&&(a(this,pe).get(e).remove(),a(this,pe).delete(e))}destroy(){m(this,ms,null);for(const e of a(this,pe).values())e.remove();a(this,pe).clear(),a(this,Nr).clear()}};ms=new WeakMap,pe=new WeakMap,Nr=new WeakMap,rh=new WeakMap,Ic=new WeakSet,mg=function(e,[t,s,i,n]){const{style:r}=e;r.top=`${100*s}%`,r.left=`${100*t}%`,r.width=`${100*i}%`,r.height=`${100*n}%`},Us=new WeakSet,fu=function(){const e=_t._svgFactory.create(1,1,!0);return a(this,ms).append(e),e.setAttribute("aria-hidden",!0),e},vg=function(e,t){const s=_t._svgFactory.createElement("clipPath");e.append(s);const i=`clip_${t}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const n=_t._svgFactory.createElement("use");return s.append(n),n.setAttribute("href",`#${t}`),n.classList.add("clip"),i},pu=function(e,t){for(const[s,i]of Object.entries(t))i===null?e.removeAttribute(s):e.setAttribute(s,i)},b(_t,Ic),b(_t,rh,0);let uu=_t;globalThis._pdfjsTestingUtils={HighlightOutliner:zd};globalThis.pdfjsLib={AbortException:yn,AnnotationEditorLayer:hu,AnnotationEditorParamsType:et,AnnotationEditorType:K,AnnotationEditorUIManager:kr,AnnotationLayer:Bd,AnnotationMode:Ni,AnnotationType:Ot,build:fv,ColorPicker:oc,createValidAbsoluteUrl:hf,DOMSVGFactory:rc,DrawLayer:uu,FeatureTest:ee,fetchData:oh,getDocument:Pd,getFilenameFromUrl:rm,getPdfFilenameFromUrl:am,getUuid:uf,getXfaPageViewport:lm,GlobalWorkerOptions:$s,ImageKind:xh,InvalidPDFException:Jc,isDataScheme:Nc,isPdfFile:wu,isValidExplicitDest:ym,MathClamp:me,noContextMenu:bs,normalizeUnicode:sm,OPS:ec,OutputScale:js,PasswordResponses:Xg,PDFDataRangeTransport:pp,PDFDateString:Eu,PDFWorker:Oo,PermissionFlag:Wg,PixelsPerInch:An,RenderingCancelledException:Au,ResponseException:sc,setLayerDimensions:Fr,shadow:tt,SignatureExtractor:xi,stopEvent:Dt,SupportedImageMimeTypes:qc,TextLayer:Mo,TouchManager:nc,updateUrlHash:cf,Util:V,VerbosityLevel:Lc,version:uv,XfaLayer:vp};$s.workerSrc="/blackmetal/pdf.worker.min.js";const Fv=Ii(Mc)({width:"100%",maxWidth:"680px",margin:"0 auto",background:"#fff",borderRadius:0,overflow:"hidden",boxShadow:"0 2px 12px rgba(0,0,0,0.08)"}),kv=Ii(Mc)({height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",width:"100%",background:"transparent"}),_v=Ii("canvas")({maxWidth:"100%",maxHeight:"100%",background:"#fff",borderRadius:4}),Bv=Ii(Mc)({background:"#2D7A84",display:"flex",alignItems:"center",height:48,padding:"0 16px",gap:8,position:"relative",zIndex:2}),Hv=Ii($g)({flex:1,height:6,borderRadius:3,background:"#2D7A84","& .MuiLinearProgress-bar":{background:"#fff"}}),$v=()=>{const[c,e]=Oi.useState(0),[t,s]=Oi.useState(1),[i,n]=Oi.useState(!0),r=Oi.useRef(null),o=Oi.useRef(null);Oi.useEffect(()=>{n(!0),Pd("/blackmetal/presentation.pdf").promise.then(f=>{e(f.numPages),n(!1),l(f,t)})},[]),Oi.useEffect(()=>{c>0&&Pd("/blackmetal/presentation.pdf").promise.then(f=>{l(f,t)})},[t,c]);const l=(f,p)=>{f.getPage(p).then(v=>{const g=v.getViewport({scale:1.5,rotation:0}),A=r.current;if(!A)return;const w=A.getContext("2d");A.height=g.height,A.width=g.width,v.render({canvasContext:w,viewport:g})})},h=()=>s(f=>f>1?f-1:c),d=()=>s(f=>f<c?f+1:1),u=()=>{const f=o.current;f&&(f.requestFullscreen?f.requestFullscreen():f.webkitRequestFullscreen?f.webkitRequestFullscreen():f.msRequestFullscreen&&f.msRequestFullscreen())};return ft.jsxs(Fv,{ref:o,children:[ft.jsx(kv,{children:i?ft.jsx(Sh,{color:"#fff",children:"Загрузка..."}):ft.jsx(_v,{ref:r})}),ft.jsxs(Bv,{children:[ft.jsx(gh,{onClick:h,sx:{color:"#fff"},children:ft.jsx(jg,{})}),ft.jsx(gh,{onClick:d,sx:{color:"#fff",ml:.5},children:ft.jsx(Ug,{})}),ft.jsx(Sh,{sx:{color:"#fff",minWidth:32,textAlign:"center",fontWeight:500,ml:2},children:t}),ft.jsx(Hv,{variant:"determinate",value:c?t/c*100:0}),ft.jsx(Sh,{sx:{color:"#fff",minWidth:32,textAlign:"center",fontWeight:500},children:c}),ft.jsx(gh,{sx:{color:"#fff"},children:ft.jsx(Pg,{})}),ft.jsx(gh,{sx:{color:"#fff"},onClick:u,children:ft.jsx(zg,{})})]})]})},bg=()=>{const{data:c}=_u("developments");return _u("news"),c?ft.jsx(Mg,{maxWidth:"lg",sx:{py:6},children:ft.jsxs(Mc,{children:[ft.jsx(Sh,{variant:"h3",fontWeight:"bold",sx:{textAlign:"center",mb:{xs:3,sm:4,md:5},fontSize:{xxs:"2.5rem",sm:"2.2rem",md:"2.5rem"}},children:c.title}),ft.jsx($v,{})]})}):null},Vv=Object.freeze(Object.defineProperty({__proto__:null,default:bg},Symbol.toStringTag,{value:"Module"})),Wv=Object.freeze(Object.defineProperty({__proto__:null,default:bg},Symbol.toStringTag,{value:"Module"}));export{Vv as D,Wv as i};
